var cg=Object.defineProperty;var Pu=f=>{throw TypeError(f)};var dg=(f,e,t)=>e in f?cg(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var ut=(f,e,t)=>dg(f,typeof e!="symbol"?e+"":e,t),Bc=(f,e,t)=>e.has(f)||Pu("Cannot "+t);var a=(f,e,t)=>(Bc(f,e,"read from private field"),t?t.call(f):e.get(f)),S=(f,e,t)=>e.has(f)?Pu("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(f):e.set(f,t),v=(f,e,t,i)=>(Bc(f,e,"write to private field"),i?i.call(f,t):e.set(f,t),t),E=(f,e,t)=>(Bc(f,e,"access private method"),t);var ke=(f,e,t,i)=>({set _(s){v(f,e,s,t)},get _(){return a(f,e,i)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var vh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ug(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}function wh(f){throw new Error('Could not dynamically require "'+f+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var zc={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Ru;function fg(){return Ru||(Ru=1,(function(f,e){(function(t){f.exports=t()})(function(){return(function t(i,s,n){function r(h,c){if(!s[h]){if(!i[h]){var d=typeof wh=="function"&&wh;if(!c&&d)return d(h,!0);if(o)return o(h,!0);var u=new Error("Cannot find module '"+h+"'");throw u.code="MODULE_NOT_FOUND",u}var p=s[h]={exports:{}};i[h][0].call(p.exports,function(m){var g=i[h][1][m];return r(g||m)},p,p.exports,t,i,s,n)}return s[h].exports}for(var o=typeof wh=="function"&&wh,l=0;l<n.length;l++)r(n[l]);return r})({1:[function(t,i,s){var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(l){for(var h,c,d,u,p,m,g,y=[],b=0,_=l.length,x=_,C=n.getTypeOf(l)!=="string";b<l.length;)x=_-b,d=C?(h=l[b++],c=b<_?l[b++]:0,b<_?l[b++]:0):(h=l.charCodeAt(b++),c=b<_?l.charCodeAt(b++):0,b<_?l.charCodeAt(b++):0),u=h>>2,p=(3&h)<<4|c>>4,m=1<x?(15&c)<<2|d>>6:64,g=2<x?63&d:64,y.push(o.charAt(u)+o.charAt(p)+o.charAt(m)+o.charAt(g));return y.join("")},s.decode=function(l){var h,c,d,u,p,m,g=0,y=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var _,x=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&x--,l.charAt(l.length-2)===o.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=r.uint8array?new Uint8Array(0|x):new Array(0|x);g<l.length;)h=o.indexOf(l.charAt(g++))<<2|(u=o.indexOf(l.charAt(g++)))>>4,c=(15&u)<<4|(p=o.indexOf(l.charAt(g++)))>>2,d=(3&p)<<6|(m=o.indexOf(l.charAt(g++))),_[y++]=h,p!==64&&(_[y++]=c),m!==64&&(_[y++]=d);return _}},{"./support":30,"./utils":32}],2:[function(t,i,s){var n=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function h(c,d,u,p,m){this.compressedSize=c,this.uncompressedSize=d,this.crc32=u,this.compression=p,this.compressedContent=m}h.prototype={getContentWorker:function(){var c=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(c,d,u){return c.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(u)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,s){var n=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,s){var n=t("./utils"),r=(function(){for(var o,l=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;l[h]=o}return l})();i.exports=function(o,l){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?(function(h,c,d,u){var p=r,m=u+d;h^=-1;for(var g=u;g<m;g++)h=h>>>8^p[255&(h^c[g])];return-1^h})(0|l,o,o.length,0):(function(h,c,d,u){var p=r,m=u+d;h^=-1;for(var g=u;g<m;g++)h=h>>>8^p[255&(h^c.charCodeAt(g))];return-1^h})(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,i,s){var n=null;n=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:n}},{lie:37}],7:[function(t,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),h=n?"uint8array":"array";function c(d,u){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=u,this.meta={}}s.magic="\b\0",o.inherits(c,l),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,d.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(u){d.push({data:u,meta:d.meta})}},s.compressWorker=function(d){return new c("Deflate",d)},s.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,s){function n(p,m){var g,y="";for(g=0;g<m;g++)y+=String.fromCharCode(255&p),p>>>=8;return y}function r(p,m,g,y,b,_){var x,C,k=p.file,M=p.compression,L=_!==h.utf8encode,N=o.transformTo("string",_(k.name)),D=o.transformTo("string",h.utf8encode(k.name)),G=k.comment,Z=o.transformTo("string",_(G)),R=o.transformTo("string",h.utf8encode(G)),U=D.length!==k.name.length,A=R.length!==G.length,j="",V="",H="",ct=k.dir,Y=k.date,ot={crc32:0,compressedSize:0,uncompressedSize:0};m&&!g||(ot.crc32=p.crc32,ot.compressedSize=p.compressedSize,ot.uncompressedSize=p.uncompressedSize);var B=0;m&&(B|=8),L||!U&&!A||(B|=2048);var O=0,W=0;ct&&(O|=16),b==="UNIX"?(W=798,O|=(function(J,_t){var mt=J;return J||(mt=_t?16893:33204),(65535&mt)<<16})(k.unixPermissions,ct)):(W=20,O|=(function(J){return 63&(J||0)})(k.dosPermissions)),x=Y.getUTCHours(),x<<=6,x|=Y.getUTCMinutes(),x<<=5,x|=Y.getUTCSeconds()/2,C=Y.getUTCFullYear()-1980,C<<=4,C|=Y.getUTCMonth()+1,C<<=5,C|=Y.getUTCDate(),U&&(V=n(1,1)+n(c(N),4)+D,j+="up"+n(V.length,2)+V),A&&(H=n(1,1)+n(c(Z),4)+R,j+="uc"+n(H.length,2)+H);var K="";return K+=`
\0`,K+=n(B,2),K+=M.magic,K+=n(x,2),K+=n(C,2),K+=n(ot.crc32,4),K+=n(ot.compressedSize,4),K+=n(ot.uncompressedSize,4),K+=n(N.length,2),K+=n(j.length,2),{fileRecord:d.LOCAL_FILE_HEADER+K+N+j,dirRecord:d.CENTRAL_FILE_HEADER+n(W,2)+K+n(Z.length,2)+"\0\0\0\0"+n(O,4)+n(y,4)+N+j+Z}}var o=t("../utils"),l=t("../stream/GenericWorker"),h=t("../utf8"),c=t("../crc32"),d=t("../signature");function u(p,m,g,y){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=g,this.encodeFileName=y,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(u,l),u.prototype.push=function(p){var m=p.meta.percent||0,g=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:g?(m+100*(g-y-1))/g:100}}))},u.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var m=this.streamFiles&&!p.file.dir;if(m){var g=r(p,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(p){this.accumulate=!1;var m=this.streamFiles&&!p.file.dir,g=r(p,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),m)this.push({data:(function(y){return d.DATA_DESCRIPTOR+n(y.crc32,4)+n(y.compressedSize,4)+n(y.uncompressedSize,4)})(p),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var p=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var g=this.bytesWritten-p,y=(function(b,_,x,C,k){var M=o.transformTo("string",k(C));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(b,2)+n(b,2)+n(_,4)+n(x,4)+n(M.length,2)+M})(this.dirRecords.length,g,p,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(p){this._sources.push(p);var m=this;return p.on("data",function(g){m.processChunk(g)}),p.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),p.on("error",function(g){m.error(g)}),this},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(p){var m=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var g=0;g<m.length;g++)try{m[g].error(p)}catch{}return!0},u.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,m=0;m<p.length;m++)p[m].lock()},i.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,s){var n=t("../compressions"),r=t("./ZipFileWorker");s.generateWorker=function(o,l,h){var c=new r(l.streamFiles,h,l.platform,l.encodeFileName),d=0;try{o.forEach(function(u,p){d++;var m=(function(_,x){var C=_||x,k=n[C];if(!k)throw new Error(C+" is not a valid compression method !");return k})(p.options.compression,l.compression),g=p.options.compressionOptions||l.compressionOptions||{},y=p.dir,b=p.date;p._compressWorker(m,g).withStreamInfo("file",{name:u,dir:y,date:b,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(c)}),c.entriesCount=d}catch(u){c.error(u)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,s){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=t("./external"),i.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,s){var n=t("./utils"),r=t("./external"),o=t("./utf8"),l=t("./zipEntries"),h=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function d(u){return new r.Promise(function(p,m){var g=u.decompressed.getContentWorker().pipe(new h);g.on("error",function(y){m(y)}).on("end",function(){g.streamInfo.crc32!==u.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}i.exports=function(u,p){var m=this;return p=n.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(u)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",u,!0,p.optimizedBinaryString,p.base64).then(function(g){var y=new l(p);return y.load(g),y}).then(function(g){var y=[r.Promise.resolve(g)],b=g.files;if(p.checkCRC32)for(var _=0;_<b.length;_++)y.push(d(b[_]));return r.Promise.all(y)}).then(function(g){for(var y=g.shift(),b=y.files,_=0;_<b.length;_++){var x=b[_],C=x.fileNameStr,k=n.resolve(x.fileNameStr);m.file(k,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:p.createFolders}),x.dir||(m.file(k).unsafeOriginalName=C)}return y.zipComment.length&&(m.comment=y.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,s){var n=t("../utils"),r=t("../stream/GenericWorker");function o(l,h){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}n.inherits(o,r),o.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,s){var n=t("readable-stream").Readable;function r(o,l,h){n.call(this,l),this._helper=o;var c=this;o.on("data",function(d,u){c.push(d)||c._helper.pause(),h&&h(u)}).on("error",function(d){c.emit("error",d)}).on("end",function(){c.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},i.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,i,s){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,i,s){function n(k,M,L){var N,D=o.getTypeOf(M),G=o.extend(L||{},c);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(k=b(k)),G.createFolders&&(N=y(k))&&_.call(this,N,!0);var Z=D==="string"&&G.binary===!1&&G.base64===!1;L&&L.binary!==void 0||(G.binary=!Z),(M instanceof d&&M.uncompressedSize===0||G.dir||!M||M.length===0)&&(G.base64=!1,G.binary=!0,M="",G.compression="STORE",D="string");var R=null;R=M instanceof d||M instanceof l?M:m.isNode&&m.isStream(M)?new g(k,M):o.prepareContent(k,M,G.binary,G.optimizedBinaryString,G.base64);var U=new u(k,R,G);this.files[k]=U}var r=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),c=t("./defaults"),d=t("./compressedObject"),u=t("./zipObject"),p=t("./generate"),m=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),y=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var M=k.lastIndexOf("/");return 0<M?k.substring(0,M):""},b=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},_=function(k,M){return M=M!==void 0?M:c.createFolders,k=b(k),this.files[k]||n.call(this,k,null,{dir:!0,createFolders:M}),this.files[k]};function x(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var M,L,N;for(M in this.files)N=this.files[M],(L=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&k(L,N)},filter:function(k){var M=[];return this.forEach(function(L,N){k(L,N)&&M.push(N)}),M},file:function(k,M,L){if(arguments.length!==1)return k=this.root+k,n.call(this,k,M,L),this;if(x(k)){var N=k;return this.filter(function(G,Z){return!Z.dir&&N.test(G)})}var D=this.files[this.root+k];return D&&!D.dir?D:null},folder:function(k){if(!k)return this;if(x(k))return this.filter(function(D,G){return G.dir&&k.test(D)});var M=this.root+k,L=_.call(this,M),N=this.clone();return N.root=L.name,N},remove:function(k){k=this.root+k;var M=this.files[k];if(M||(k.slice(-1)!=="/"&&(k+="/"),M=this.files[k]),M&&!M.dir)delete this.files[k];else for(var L=this.filter(function(D,G){return G.name.slice(0,k.length)===k}),N=0;N<L.length;N++)delete this.files[L[N].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var M,L={};try{if((L=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");o.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var N=L.comment||this.comment||"";M=p.generateWorker(this,L,N)}catch(D){(M=new l("error")).error(D)}return new h(M,L.type||"string",L.mimeType)},generateAsync:function(k,M){return this.generateInternalStream(k).accumulate(M)},generateNodeStream:function(k,M){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(M)}};i.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,s){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,s){var n=t("./DataReader");function r(o){n.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===l&&this.data[u+1]===h&&this.data[u+2]===c&&this.data[u+3]===d)return u-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),u=this.readData(4);return l===u[0]&&h===u[1]&&c===u[2]&&d===u[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,i,s){var n=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,h=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=o,h},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},i.exports=r},{"../utils":32}],19:[function(t,i,s){var n=t("./Uint8ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,s){var n=t("./DataReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,i,s){var n=t("./ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,s){var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),h=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");i.exports=function(d){var u=n.getTypeOf(d);return n.checkSupport(u),u!=="string"||r.uint8array?u==="nodebuffer"?new h(d):r.uint8array?new c(n.transformTo("uint8array",d)):new o(n.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,s){var n=t("./GenericWorker"),r=t("../utils");function o(l){n.call(this,"ConvertWorker to "+l),this.destType=l}r.inherits(o,n),o.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,s){var n=t("./GenericWorker"),r=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,s){var n=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}n.inherits(o,r),o.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}r.prototype.processChunk.call(this,l)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,s){var n=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=n.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,s){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(l){o.processChunk(l)}),r.on("end",function(){o.end()}),r.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},i.exports=n},{}],29:[function(t,i,s){var n=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),h=t("../support"),c=t("../external"),d=null;if(h.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(m,g){return new c.Promise(function(y,b){var _=[],x=m._internalType,C=m._outputType,k=m._mimeType;m.on("data",function(M,L){_.push(M),g&&g(L)}).on("error",function(M){_=[],b(M)}).on("end",function(){try{var M=(function(L,N,D){switch(L){case"blob":return n.newBlob(n.transformTo("arraybuffer",N),D);case"base64":return l.encode(N);default:return n.transformTo(L,N)}})(C,(function(L,N){var D,G=0,Z=null,R=0;for(D=0;D<N.length;D++)R+=N[D].length;switch(L){case"string":return N.join("");case"array":return Array.prototype.concat.apply([],N);case"uint8array":for(Z=new Uint8Array(R),D=0;D<N.length;D++)Z.set(N[D],G),G+=N[D].length;return Z;case"nodebuffer":return Buffer.concat(N);default:throw new Error("concat : unsupported type '"+L+"'")}})(x,_),k);y(M)}catch(L){b(L)}_=[]}).resume()})}function p(m,g,y){var b=g;switch(g){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=g,this._mimeType=y,n.checkSupport(b),this._worker=m.pipe(new r(b)),m.lock()}catch(_){this._worker=new o("error"),this._worker.error(_)}}p.prototype={accumulate:function(m){return u(this,m)},on:function(m,g){var y=this;return m==="data"?this._worker.on(m,function(b){g.call(y,b.data,b.meta)}):this._worker.on(m,function(){n.delay(g,arguments,y)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},i.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var n=new ArrayBuffer(0);try{s.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),s.blob=r.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!t("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,s){for(var n=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function u(){l.call(this,"utf-8 encode")}s.utf8encode=function(p){return r.nodebuffer?o.newBufferFrom(p,"utf-8"):(function(m){var g,y,b,_,x,C=m.length,k=0;for(_=0;_<C;_++)(64512&(y=m.charCodeAt(_)))==55296&&_+1<C&&(64512&(b=m.charCodeAt(_+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),_++),k+=y<128?1:y<2048?2:y<65536?3:4;for(g=r.uint8array?new Uint8Array(k):new Array(k),_=x=0;x<k;_++)(64512&(y=m.charCodeAt(_)))==55296&&_+1<C&&(64512&(b=m.charCodeAt(_+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),_++),y<128?g[x++]=y:(y<2048?g[x++]=192|y>>>6:(y<65536?g[x++]=224|y>>>12:(g[x++]=240|y>>>18,g[x++]=128|y>>>12&63),g[x++]=128|y>>>6&63),g[x++]=128|63&y);return g})(p)},s.utf8decode=function(p){return r.nodebuffer?n.transformTo("nodebuffer",p).toString("utf-8"):(function(m){var g,y,b,_,x=m.length,C=new Array(2*x);for(g=y=0;g<x;)if((b=m[g++])<128)C[y++]=b;else if(4<(_=h[b]))C[y++]=65533,g+=_-1;else{for(b&=_===2?31:_===3?15:7;1<_&&g<x;)b=b<<6|63&m[g++],_--;1<_?C[y++]=65533:b<65536?C[y++]=b:(b-=65536,C[y++]=55296|b>>10&1023,C[y++]=56320|1023&b)}return C.length!==y&&(C.subarray?C=C.subarray(0,y):C.length=y),n.applyFromCharCode(C)})(p=n.transformTo(r.uint8array?"uint8array":"array",p))},n.inherits(d,l),d.prototype.processChunk=function(p){var m=n.transformTo(r.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var g=m;(m=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),m.set(g,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var y=(function(_,x){var C;for((x=x||_.length)>_.length&&(x=_.length),C=x-1;0<=C&&(192&_[C])==128;)C--;return C<0||C===0?x:C+h[_[C]]>x?C:x})(m),b=m;y!==m.length&&(r.uint8array?(b=m.subarray(0,y),this.leftOver=m.subarray(y,m.length)):(b=m.slice(0,y),this.leftOver=m.slice(y,m.length))),this.push({data:s.utf8decode(b),meta:p.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=d,n.inherits(u,l),u.prototype.processChunk=function(p){this.push({data:s.utf8encode(p.data),meta:p.meta})},s.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,s){var n=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function h(g){return g}function c(g,y){for(var b=0;b<g.length;++b)y[b]=255&g.charCodeAt(b);return y}t("setimmediate"),s.newBlob=function(g,y){s.checkSupport("blob");try{return new Blob([g],{type:y})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(g),b.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(g,y,b){var _=[],x=0,C=g.length;if(C<=b)return String.fromCharCode.apply(null,g);for(;x<C;)y==="array"||y==="nodebuffer"?_.push(String.fromCharCode.apply(null,g.slice(x,Math.min(x+b,C)))):_.push(String.fromCharCode.apply(null,g.subarray(x,Math.min(x+b,C)))),x+=b;return _.join("")},stringifyByChar:function(g){for(var y="",b=0;b<g.length;b++)y+=String.fromCharCode(g[b]);return y},applyCanBeUsed:{uint8array:(function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function u(g){var y=65536,b=s.getTypeOf(g),_=!0;if(b==="uint8array"?_=d.applyCanBeUsed.uint8array:b==="nodebuffer"&&(_=d.applyCanBeUsed.nodebuffer),_)for(;1<y;)try{return d.stringifyByChunk(g,b,y)}catch{y=Math.floor(y/2)}return d.stringifyByChar(g)}function p(g,y){for(var b=0;b<g.length;b++)y[b]=g[b];return y}s.applyFromCharCode=u;var m={};m.string={string:h,array:function(g){return c(g,new Array(g.length))},arraybuffer:function(g){return m.string.uint8array(g).buffer},uint8array:function(g){return c(g,new Uint8Array(g.length))},nodebuffer:function(g){return c(g,o.allocBuffer(g.length))}},m.array={string:u,array:h,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},m.arraybuffer={string:function(g){return u(new Uint8Array(g))},array:function(g){return p(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:h,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},m.uint8array={string:u,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:h,nodebuffer:function(g){return o.newBufferFrom(g)}},m.nodebuffer={string:u,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return m.nodebuffer.uint8array(g).buffer},uint8array:function(g){return p(g,new Uint8Array(g.length))},nodebuffer:h},s.transformTo=function(g,y){if(y=y||"",!g)return y;s.checkSupport(g);var b=s.getTypeOf(y);return m[b][g](y)},s.resolve=function(g){for(var y=g.split("/"),b=[],_=0;_<y.length;_++){var x=y[_];x==="."||x===""&&_!==0&&_!==y.length-1||(x===".."?b.pop():b.push(x))}return b.join("/")},s.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(g)?"nodebuffer":n.uint8array&&g instanceof Uint8Array?"uint8array":n.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(g){if(!n[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(g){var y,b,_="";for(b=0;b<(g||"").length;b++)_+="\\x"+((y=g.charCodeAt(b))<16?"0":"")+y.toString(16).toUpperCase();return _},s.delay=function(g,y,b){setImmediate(function(){g.apply(b||null,y||[])})},s.inherits=function(g,y){function b(){}b.prototype=y.prototype,g.prototype=new b},s.extend=function(){var g,y,b={};for(g=0;g<arguments.length;g++)for(y in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],y)&&b[y]===void 0&&(b[y]=arguments[g][y]);return b},s.prepareContent=function(g,y,b,_,x){return l.Promise.resolve(y).then(function(C){return n.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new l.Promise(function(k,M){var L=new FileReader;L.onload=function(N){k(N.target.result)},L.onerror=function(N){M(N.target.error)},L.readAsArrayBuffer(C)}):C}).then(function(C){var k=s.getTypeOf(C);return k?(k==="arraybuffer"?C=s.transformTo("uint8array",C):k==="string"&&(x?C=r.decode(C):b&&_!==!0&&(C=(function(M){return c(M,n.uint8array?new Uint8Array(M.length):new Array(M.length))})(C))),C):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,s){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),l=t("./zipEntry"),h=t("./support");function c(d){this.files=[],this.loadOptions=d}c.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(u)+", expected "+r.pretty(d)+")")}},isSignature:function(d,u){var p=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===u;return this.reader.setIndex(p),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),u=h.uint8array?"uint8array":"array",p=r.transformTo(u,d);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,u,p,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),u=this.reader.readInt(4),p=this.reader.readData(u),this.zip64ExtensibleData[d]={id:d,length:u,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,u;for(d=0;d<this.files.length;d++)u=this.files[d],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var u=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var m=u-p;if(0<m)this.isSignature(u,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=n(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,s){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),h=t("./utf8"),c=t("./compressions"),d=t("./support");function u(p,m){this.options=p,this.loadOptions=m}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var m,g;if(p.skip(22),this.fileNameLength=p.readInt(2),g=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=(function(y){for(var b in c)if(Object.prototype.hasOwnProperty.call(c,b)&&c[b].magic===y)return c[b];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var m=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(m),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var m,g,y,b=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<b;)m=p.readInt(2),g=p.readInt(2),y=p.readData(g),this.extraFields[m]={id:m,length:g,value:y};p.setIndex(b)},handleUTF8:function(){var p=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var g=r.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var b=r.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var m=n(p.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:h.utf8decode(m.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var m=n(p.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:h.utf8decode(m.readData(p.length-5))}return null}},i.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,s){function n(m,g,y){this.name=m,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=g,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),h=t("./compressedObject"),c=t("./stream/GenericWorker");n.prototype={internalStream:function(m){var g=null,y="string";try{if(!m)throw new Error("No output type specified.");var b=(y=m.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),g=this._decompressWorker();var _=!this._dataBinary;_&&!b&&(g=g.pipe(new l.Utf8EncodeWorker)),!_&&b&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(x){(g=new c("error")).error(x)}return new r(g,y,"")},async:function(m,g){return this.internalStream(m).accumulate(g)},nodeStream:function(m,g){return this.internalStream(m||"nodebuffer").toNodejsStream(g)},_compressWorker:function(m,g){if(this._data instanceof h&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(y,m,g)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<d.length;p++)n.prototype[d[p]]=u;i.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,s){(function(n){var r,o,l=n.MutationObserver||n.WebKitMutationObserver;if(l){var h=0,c=new l(m),d=n.document.createTextNode("");c.observe(d,{characterData:!0}),r=function(){d.data=h=++h%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var g=n.document.createElement("script");g.onreadystatechange=function(){m(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},n.document.documentElement.appendChild(g)}:function(){setTimeout(m,0)};else{var u=new n.MessageChannel;u.port1.onmessage=m,r=function(){u.port2.postMessage(0)}}var p=[];function m(){var g,y;o=!0;for(var b=p.length;b;){for(y=p,p=[],g=-1;++g<b;)y[g]();b=p.length}o=!1}i.exports=function(g){p.push(g)!==1||o||r()}}).call(this,typeof vh<"u"?vh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,s){var n=t("immediate");function r(){}var o={},l=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function d(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,b!==r&&g(this,b)}function u(b,_,x){this.promise=b,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function p(b,_,x){n(function(){var C;try{C=_(x)}catch(k){return o.reject(b,k)}C===b?o.reject(b,new TypeError("Cannot resolve promise with itself")):o.resolve(b,C)})}function m(b){var _=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof _=="function")return function(){_.apply(b,arguments)}}function g(b,_){var x=!1;function C(L){x||(x=!0,o.reject(b,L))}function k(L){x||(x=!0,o.resolve(b,L))}var M=y(function(){_(k,C)});M.status==="error"&&C(M.value)}function y(b,_){var x={};try{x.value=b(_),x.status="success"}catch(C){x.status="error",x.value=C}return x}(i.exports=d).prototype.finally=function(b){if(typeof b!="function")return this;var _=this.constructor;return this.then(function(x){return _.resolve(b()).then(function(){return x})},function(x){return _.resolve(b()).then(function(){throw x})})},d.prototype.catch=function(b){return this.then(null,b)},d.prototype.then=function(b,_){if(typeof b!="function"&&this.state===h||typeof _!="function"&&this.state===l)return this;var x=new this.constructor(r);return this.state!==c?p(x,this.state===h?b:_,this.outcome):this.queue.push(new u(x,b,_)),x},u.prototype.callFulfilled=function(b){o.resolve(this.promise,b)},u.prototype.otherCallFulfilled=function(b){p(this.promise,this.onFulfilled,b)},u.prototype.callRejected=function(b){o.reject(this.promise,b)},u.prototype.otherCallRejected=function(b){p(this.promise,this.onRejected,b)},o.resolve=function(b,_){var x=y(m,_);if(x.status==="error")return o.reject(b,x.value);var C=x.value;if(C)g(b,C);else{b.state=h,b.outcome=_;for(var k=-1,M=b.queue.length;++k<M;)b.queue[k].callFulfilled(_)}return b},o.reject=function(b,_){b.state=l,b.outcome=_;for(var x=-1,C=b.queue.length;++x<C;)b.queue[x].callRejected(_);return b},d.resolve=function(b){return b instanceof this?b:o.resolve(new this(r),b)},d.reject=function(b){var _=new this(r);return o.reject(_,b)},d.all=function(b){var _=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=b.length,C=!1;if(!x)return this.resolve([]);for(var k=new Array(x),M=0,L=-1,N=new this(r);++L<x;)D(b[L],L);return N;function D(G,Z){_.resolve(G).then(function(R){k[Z]=R,++M!==x||C||(C=!0,o.resolve(N,k))},function(R){C||(C=!0,o.reject(N,R))})}},d.race=function(b){var _=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=b.length,C=!1;if(!x)return this.resolve([]);for(var k=-1,M=new this(r);++k<x;)L=b[k],_.resolve(L).then(function(N){C||(C=!0,o.resolve(M,N))},function(N){C||(C=!0,o.reject(M,N))});var L;return M}},{immediate:36}],38:[function(t,i,s){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,s){var n=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,d=0,u=-1,p=0,m=8;function g(b){if(!(this instanceof g))return new g(b);this.options=r.assign({level:u,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},b||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var x=n.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(x!==d)throw new Error(l[x]);if(_.header&&n.deflateSetHeader(this.strm,_.header),_.dictionary){var C;if(C=typeof _.dictionary=="string"?o.string2buf(_.dictionary):c.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(x=n.deflateSetDictionary(this.strm,C))!==d)throw new Error(l[x]);this._dict_set=!0}}function y(b,_){var x=new g(_);if(x.push(b,!0),x.err)throw x.msg||l[x.err];return x.result}g.prototype.push=function(b,_){var x,C,k=this.strm,M=this.options.chunkSize;if(this.ended)return!1;C=_===~~_?_:_===!0?4:0,typeof b=="string"?k.input=o.string2buf(b):c.call(b)==="[object ArrayBuffer]"?k.input=new Uint8Array(b):k.input=b,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new r.Buf8(M),k.next_out=0,k.avail_out=M),(x=n.deflate(k,C))!==1&&x!==d)return this.onEnd(x),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(k.output,k.next_out))):this.onData(r.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&x!==1);return C===4?(x=n.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===d):C!==2||(this.onEnd(d),!(k.avail_out=0))},g.prototype.onData=function(b){this.chunks.push(b)},g.prototype.onEnd=function(b){b===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},s.Deflate=g,s.deflate=y,s.deflateRaw=function(b,_){return(_=_||{}).raw=!0,y(b,_)},s.gzip=function(b,_){return(_=_||{}).gzip=!0,y(b,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,s){var n=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),u=Object.prototype.toString;function p(g){if(!(this instanceof p))return new p(g);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},g||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||g&&g.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&(15&y.windowBits)==0&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var b=n.inflateInit2(this.strm,y.windowBits);if(b!==l.Z_OK)throw new Error(h[b]);this.header=new d,n.inflateGetHeader(this.strm,this.header)}function m(g,y){var b=new p(y);if(b.push(g,!0),b.err)throw b.msg||h[b.err];return b.result}p.prototype.push=function(g,y){var b,_,x,C,k,M,L=this.strm,N=this.options.chunkSize,D=this.options.dictionary,G=!1;if(this.ended)return!1;_=y===~~y?y:y===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?L.input=o.binstring2buf(g):u.call(g)==="[object ArrayBuffer]"?L.input=new Uint8Array(g):L.input=g,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new r.Buf8(N),L.next_out=0,L.avail_out=N),(b=n.inflate(L,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&D&&(M=typeof D=="string"?o.string2buf(D):u.call(D)==="[object ArrayBuffer]"?new Uint8Array(D):D,b=n.inflateSetDictionary(this.strm,M)),b===l.Z_BUF_ERROR&&G===!0&&(b=l.Z_OK,G=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&b!==l.Z_STREAM_END&&(L.avail_in!==0||_!==l.Z_FINISH&&_!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=o.utf8border(L.output,L.next_out),C=L.next_out-x,k=o.buf2string(L.output,x),L.next_out=C,L.avail_out=N-C,C&&r.arraySet(L.output,L.output,x,C,0),this.onData(k)):this.onData(r.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(G=!0)}while((0<L.avail_in||L.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(_=l.Z_FINISH),_===l.Z_FINISH?(b=n.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):_!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(L.avail_out=0))},p.prototype.onData=function(g){this.chunks.push(g)},p.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},s.Inflate=p,s.inflate=m,s.inflateRaw=function(g,y){return(y=y||{}).raw=!0,m(g,y)},s.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(l[d]=c[d])}}return l},s.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var r={arraySet:function(l,h,c,d,u){if(h.subarray&&l.subarray)l.set(h.subarray(c,c+d),u);else for(var p=0;p<d;p++)l[u+p]=h[c+p]},flattenChunks:function(l){var h,c,d,u,p,m;for(h=d=0,c=l.length;h<c;h++)d+=l[h].length;for(m=new Uint8Array(d),h=u=0,c=l.length;h<c;h++)p=l[h],m.set(p,u),u+=p.length;return m}},o={arraySet:function(l,h,c,d,u){for(var p=0;p<d;p++)l[u+p]=h[c+p]},flattenChunks:function(l){return[].concat.apply([],l)}};s.setTyped=function(l){l?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,r)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,o))},s.setTyped(n)},{}],42:[function(t,i,s){var n=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new n.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(d,u){if(u<65537&&(d.subarray&&o||!d.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(d,u));for(var p="",m=0;m<u;m++)p+=String.fromCharCode(d[m]);return p}l[254]=l[254]=1,s.string2buf=function(d){var u,p,m,g,y,b=d.length,_=0;for(g=0;g<b;g++)(64512&(p=d.charCodeAt(g)))==55296&&g+1<b&&(64512&(m=d.charCodeAt(g+1)))==56320&&(p=65536+(p-55296<<10)+(m-56320),g++),_+=p<128?1:p<2048?2:p<65536?3:4;for(u=new n.Buf8(_),g=y=0;y<_;g++)(64512&(p=d.charCodeAt(g)))==55296&&g+1<b&&(64512&(m=d.charCodeAt(g+1)))==56320&&(p=65536+(p-55296<<10)+(m-56320),g++),p<128?u[y++]=p:(p<2048?u[y++]=192|p>>>6:(p<65536?u[y++]=224|p>>>12:(u[y++]=240|p>>>18,u[y++]=128|p>>>12&63),u[y++]=128|p>>>6&63),u[y++]=128|63&p);return u},s.buf2binstring=function(d){return c(d,d.length)},s.binstring2buf=function(d){for(var u=new n.Buf8(d.length),p=0,m=u.length;p<m;p++)u[p]=d.charCodeAt(p);return u},s.buf2string=function(d,u){var p,m,g,y,b=u||d.length,_=new Array(2*b);for(p=m=0;p<b;)if((g=d[p++])<128)_[m++]=g;else if(4<(y=l[g]))_[m++]=65533,p+=y-1;else{for(g&=y===2?31:y===3?15:7;1<y&&p<b;)g=g<<6|63&d[p++],y--;1<y?_[m++]=65533:g<65536?_[m++]=g:(g-=65536,_[m++]=55296|g>>10&1023,_[m++]=56320|1023&g)}return c(_,m)},s.utf8border=function(d,u){var p;for((u=u||d.length)>d.length&&(u=d.length),p=u-1;0<=p&&(192&d[p])==128;)p--;return p<0||p===0?u:p+l[d[p]]>u?p:u}},{"./common":41}],43:[function(t,i,s){i.exports=function(n,r,o,l){for(var h=65535&n|0,c=n>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;c=c+(h=h+r[l++]|0)|0,--d;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(t,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,s){var n=(function(){for(var r,o=[],l=0;l<256;l++){r=l;for(var h=0;h<8;h++)r=1&r?3988292384^r>>>1:r>>>1;o[l]=r}return o})();i.exports=function(r,o,l,h){var c=n,d=h+l;r^=-1;for(var u=h;u<d;u++)r=r>>>8^c[255&(r^o[u])];return-1^r}},{}],46:[function(t,i,s){var n,r=t("../utils/common"),o=t("./trees"),l=t("./adler32"),h=t("./crc32"),c=t("./messages"),d=0,u=4,p=0,m=-2,g=-1,y=4,b=2,_=8,x=9,C=286,k=30,M=19,L=2*C+1,N=15,D=3,G=258,Z=G+D+1,R=42,U=113,A=1,j=2,V=3,H=4;function ct(w,q){return w.msg=c[q],q}function Y(w){return(w<<1)-(4<w?9:0)}function ot(w){for(var q=w.length;0<=--q;)w[q]=0}function B(w){var q=w.state,$=q.pending;$>w.avail_out&&($=w.avail_out),$!==0&&(r.arraySet(w.output,q.pending_buf,q.pending_out,$,w.next_out),w.next_out+=$,q.pending_out+=$,w.total_out+=$,w.avail_out-=$,q.pending-=$,q.pending===0&&(q.pending_out=0))}function O(w,q){o._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,q),w.block_start=w.strstart,B(w.strm)}function W(w,q){w.pending_buf[w.pending++]=q}function K(w,q){w.pending_buf[w.pending++]=q>>>8&255,w.pending_buf[w.pending++]=255&q}function J(w,q){var $,P,T=w.max_chain_length,F=w.strstart,X=w.prev_length,Q=w.nice_match,z=w.strstart>w.w_size-Z?w.strstart-(w.w_size-Z):0,tt=w.window,nt=w.w_mask,et=w.prev,dt=w.strstart+G,Ot=tt[F+X-1],xt=tt[F+X];w.prev_length>=w.good_match&&(T>>=2),Q>w.lookahead&&(Q=w.lookahead);do if(tt[($=q)+X]===xt&&tt[$+X-1]===Ot&&tt[$]===tt[F]&&tt[++$]===tt[F+1]){F+=2,$++;do;while(tt[++F]===tt[++$]&&tt[++F]===tt[++$]&&tt[++F]===tt[++$]&&tt[++F]===tt[++$]&&tt[++F]===tt[++$]&&tt[++F]===tt[++$]&&tt[++F]===tt[++$]&&tt[++F]===tt[++$]&&F<dt);if(P=G-(dt-F),F=dt-G,X<P){if(w.match_start=q,Q<=(X=P))break;Ot=tt[F+X-1],xt=tt[F+X]}}while((q=et[q&nt])>z&&--T!=0);return X<=w.lookahead?X:w.lookahead}function _t(w){var q,$,P,T,F,X,Q,z,tt,nt,et=w.w_size;do{if(T=w.window_size-w.lookahead-w.strstart,w.strstart>=et+(et-Z)){for(r.arraySet(w.window,w.window,et,et,0),w.match_start-=et,w.strstart-=et,w.block_start-=et,q=$=w.hash_size;P=w.head[--q],w.head[q]=et<=P?P-et:0,--$;);for(q=$=et;P=w.prev[--q],w.prev[q]=et<=P?P-et:0,--$;);T+=et}if(w.strm.avail_in===0)break;if(X=w.strm,Q=w.window,z=w.strstart+w.lookahead,tt=T,nt=void 0,nt=X.avail_in,tt<nt&&(nt=tt),$=nt===0?0:(X.avail_in-=nt,r.arraySet(Q,X.input,X.next_in,nt,z),X.state.wrap===1?X.adler=l(X.adler,Q,nt,z):X.state.wrap===2&&(X.adler=h(X.adler,Q,nt,z)),X.next_in+=nt,X.total_in+=nt,nt),w.lookahead+=$,w.lookahead+w.insert>=D)for(F=w.strstart-w.insert,w.ins_h=w.window[F],w.ins_h=(w.ins_h<<w.hash_shift^w.window[F+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[F+D-1])&w.hash_mask,w.prev[F&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=F,F++,w.insert--,!(w.lookahead+w.insert<D)););}while(w.lookahead<Z&&w.strm.avail_in!==0)}function mt(w,q){for(var $,P;;){if(w.lookahead<Z){if(_t(w),w.lookahead<Z&&q===d)return A;if(w.lookahead===0)break}if($=0,w.lookahead>=D&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+D-1])&w.hash_mask,$=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),$!==0&&w.strstart-$<=w.w_size-Z&&(w.match_length=J(w,$)),w.match_length>=D)if(P=o._tr_tally(w,w.strstart-w.match_start,w.match_length-D),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=D){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+D-1])&w.hash_mask,$=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else P=o._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(P&&(O(w,!1),w.strm.avail_out===0))return A}return w.insert=w.strstart<D-1?w.strstart:D-1,q===u?(O(w,!0),w.strm.avail_out===0?V:H):w.last_lit&&(O(w,!1),w.strm.avail_out===0)?A:j}function bt(w,q){for(var $,P,T;;){if(w.lookahead<Z){if(_t(w),w.lookahead<Z&&q===d)return A;if(w.lookahead===0)break}if($=0,w.lookahead>=D&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+D-1])&w.hash_mask,$=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=D-1,$!==0&&w.prev_length<w.max_lazy_match&&w.strstart-$<=w.w_size-Z&&(w.match_length=J(w,$),w.match_length<=5&&(w.strategy===1||w.match_length===D&&4096<w.strstart-w.match_start)&&(w.match_length=D-1)),w.prev_length>=D&&w.match_length<=w.prev_length){for(T=w.strstart+w.lookahead-D,P=o._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-D),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=T&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+D-1])&w.hash_mask,$=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=D-1,w.strstart++,P&&(O(w,!1),w.strm.avail_out===0))return A}else if(w.match_available){if((P=o._tr_tally(w,0,w.window[w.strstart-1]))&&O(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return A}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(P=o._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<D-1?w.strstart:D-1,q===u?(O(w,!0),w.strm.avail_out===0?V:H):w.last_lit&&(O(w,!1),w.strm.avail_out===0)?A:j}function Ct(w,q,$,P,T){this.good_length=w,this.max_lazy=q,this.nice_length=$,this.max_chain=P,this.func=T}function Zt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*L),this.dyn_dtree=new r.Buf16(2*(2*k+1)),this.bl_tree=new r.Buf16(2*(2*M+1)),ot(this.dyn_ltree),ot(this.dyn_dtree),ot(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(N+1),this.heap=new r.Buf16(2*C+1),ot(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*C+1),ot(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function qt(w){var q;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=b,(q=w.state).pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?R:U,w.adler=q.wrap===2?0:1,q.last_flush=d,o._tr_init(q),p):ct(w,m)}function Hi(w){var q=qt(w);return q===p&&(function($){$.window_size=2*$.w_size,ot($.head),$.max_lazy_match=n[$.level].max_lazy,$.good_match=n[$.level].good_length,$.nice_match=n[$.level].nice_length,$.max_chain_length=n[$.level].max_chain,$.strstart=0,$.block_start=0,$.lookahead=0,$.insert=0,$.match_length=$.prev_length=D-1,$.match_available=0,$.ins_h=0})(w.state),q}function _i(w,q,$,P,T,F){if(!w)return m;var X=1;if(q===g&&(q=6),P<0?(X=0,P=-P):15<P&&(X=2,P-=16),T<1||x<T||$!==_||P<8||15<P||q<0||9<q||F<0||y<F)return ct(w,m);P===8&&(P=9);var Q=new Zt;return(w.state=Q).strm=w,Q.wrap=X,Q.gzhead=null,Q.w_bits=P,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=T+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+D-1)/D),Q.window=new r.Buf8(2*Q.w_size),Q.head=new r.Buf16(Q.hash_size),Q.prev=new r.Buf16(Q.w_size),Q.lit_bufsize=1<<T+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new r.Buf8(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=q,Q.strategy=F,Q.method=$,Hi(w)}n=[new Ct(0,0,0,0,function(w,q){var $=65535;for($>w.pending_buf_size-5&&($=w.pending_buf_size-5);;){if(w.lookahead<=1){if(_t(w),w.lookahead===0&&q===d)return A;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var P=w.block_start+$;if((w.strstart===0||w.strstart>=P)&&(w.lookahead=w.strstart-P,w.strstart=P,O(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-Z&&(O(w,!1),w.strm.avail_out===0))return A}return w.insert=0,q===u?(O(w,!0),w.strm.avail_out===0?V:H):(w.strstart>w.block_start&&(O(w,!1),w.strm.avail_out),A)}),new Ct(4,4,8,4,mt),new Ct(4,5,16,8,mt),new Ct(4,6,32,32,mt),new Ct(4,4,16,16,bt),new Ct(8,16,32,32,bt),new Ct(8,16,128,128,bt),new Ct(8,32,128,256,bt),new Ct(32,128,258,1024,bt),new Ct(32,258,258,4096,bt)],s.deflateInit=function(w,q){return _i(w,q,_,15,8,0)},s.deflateInit2=_i,s.deflateReset=Hi,s.deflateResetKeep=qt,s.deflateSetHeader=function(w,q){return w&&w.state?w.state.wrap!==2?m:(w.state.gzhead=q,p):m},s.deflate=function(w,q){var $,P,T,F;if(!w||!w.state||5<q||q<0)return w?ct(w,m):m;if(P=w.state,!w.output||!w.input&&w.avail_in!==0||P.status===666&&q!==u)return ct(w,w.avail_out===0?-5:m);if(P.strm=w,$=P.last_flush,P.last_flush=q,P.status===R)if(P.wrap===2)w.adler=0,W(P,31),W(P,139),W(P,8),P.gzhead?(W(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),W(P,255&P.gzhead.time),W(P,P.gzhead.time>>8&255),W(P,P.gzhead.time>>16&255),W(P,P.gzhead.time>>24&255),W(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),W(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(W(P,255&P.gzhead.extra.length),W(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(w.adler=h(w.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(W(P,0),W(P,0),W(P,0),W(P,0),W(P,0),W(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),W(P,3),P.status=U);else{var X=_+(P.w_bits-8<<4)<<8;X|=(2<=P.strategy||P.level<2?0:P.level<6?1:P.level===6?2:3)<<6,P.strstart!==0&&(X|=32),X+=31-X%31,P.status=U,K(P,X),P.strstart!==0&&(K(P,w.adler>>>16),K(P,65535&w.adler)),w.adler=1}if(P.status===69)if(P.gzhead.extra){for(T=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>T&&(w.adler=h(w.adler,P.pending_buf,P.pending-T,T)),B(w),T=P.pending,P.pending!==P.pending_buf_size));)W(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>T&&(w.adler=h(w.adler,P.pending_buf,P.pending-T,T)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(P.status===73)if(P.gzhead.name){T=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>T&&(w.adler=h(w.adler,P.pending_buf,P.pending-T,T)),B(w),T=P.pending,P.pending===P.pending_buf_size)){F=1;break}F=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,W(P,F)}while(F!==0);P.gzhead.hcrc&&P.pending>T&&(w.adler=h(w.adler,P.pending_buf,P.pending-T,T)),F===0&&(P.gzindex=0,P.status=91)}else P.status=91;if(P.status===91)if(P.gzhead.comment){T=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>T&&(w.adler=h(w.adler,P.pending_buf,P.pending-T,T)),B(w),T=P.pending,P.pending===P.pending_buf_size)){F=1;break}F=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,W(P,F)}while(F!==0);P.gzhead.hcrc&&P.pending>T&&(w.adler=h(w.adler,P.pending_buf,P.pending-T,T)),F===0&&(P.status=103)}else P.status=103;if(P.status===103&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&B(w),P.pending+2<=P.pending_buf_size&&(W(P,255&w.adler),W(P,w.adler>>8&255),w.adler=0,P.status=U)):P.status=U),P.pending!==0){if(B(w),w.avail_out===0)return P.last_flush=-1,p}else if(w.avail_in===0&&Y(q)<=Y($)&&q!==u)return ct(w,-5);if(P.status===666&&w.avail_in!==0)return ct(w,-5);if(w.avail_in!==0||P.lookahead!==0||q!==d&&P.status!==666){var Q=P.strategy===2?(function(z,tt){for(var nt;;){if(z.lookahead===0&&(_t(z),z.lookahead===0)){if(tt===d)return A;break}if(z.match_length=0,nt=o._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,nt&&(O(z,!1),z.strm.avail_out===0))return A}return z.insert=0,tt===u?(O(z,!0),z.strm.avail_out===0?V:H):z.last_lit&&(O(z,!1),z.strm.avail_out===0)?A:j})(P,q):P.strategy===3?(function(z,tt){for(var nt,et,dt,Ot,xt=z.window;;){if(z.lookahead<=G){if(_t(z),z.lookahead<=G&&tt===d)return A;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=D&&0<z.strstart&&(et=xt[dt=z.strstart-1])===xt[++dt]&&et===xt[++dt]&&et===xt[++dt]){Ot=z.strstart+G;do;while(et===xt[++dt]&&et===xt[++dt]&&et===xt[++dt]&&et===xt[++dt]&&et===xt[++dt]&&et===xt[++dt]&&et===xt[++dt]&&et===xt[++dt]&&dt<Ot);z.match_length=G-(Ot-dt),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=D?(nt=o._tr_tally(z,1,z.match_length-D),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(nt=o._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),nt&&(O(z,!1),z.strm.avail_out===0))return A}return z.insert=0,tt===u?(O(z,!0),z.strm.avail_out===0?V:H):z.last_lit&&(O(z,!1),z.strm.avail_out===0)?A:j})(P,q):n[P.level].func(P,q);if(Q!==V&&Q!==H||(P.status=666),Q===A||Q===V)return w.avail_out===0&&(P.last_flush=-1),p;if(Q===j&&(q===1?o._tr_align(P):q!==5&&(o._tr_stored_block(P,0,0,!1),q===3&&(ot(P.head),P.lookahead===0&&(P.strstart=0,P.block_start=0,P.insert=0))),B(w),w.avail_out===0))return P.last_flush=-1,p}return q!==u?p:P.wrap<=0?1:(P.wrap===2?(W(P,255&w.adler),W(P,w.adler>>8&255),W(P,w.adler>>16&255),W(P,w.adler>>24&255),W(P,255&w.total_in),W(P,w.total_in>>8&255),W(P,w.total_in>>16&255),W(P,w.total_in>>24&255)):(K(P,w.adler>>>16),K(P,65535&w.adler)),B(w),0<P.wrap&&(P.wrap=-P.wrap),P.pending!==0?p:1)},s.deflateEnd=function(w){var q;return w&&w.state?(q=w.state.status)!==R&&q!==69&&q!==73&&q!==91&&q!==103&&q!==U&&q!==666?ct(w,m):(w.state=null,q===U?ct(w,-3):p):m},s.deflateSetDictionary=function(w,q){var $,P,T,F,X,Q,z,tt,nt=q.length;if(!w||!w.state||(F=($=w.state).wrap)===2||F===1&&$.status!==R||$.lookahead)return m;for(F===1&&(w.adler=l(w.adler,q,nt,0)),$.wrap=0,nt>=$.w_size&&(F===0&&(ot($.head),$.strstart=0,$.block_start=0,$.insert=0),tt=new r.Buf8($.w_size),r.arraySet(tt,q,nt-$.w_size,$.w_size,0),q=tt,nt=$.w_size),X=w.avail_in,Q=w.next_in,z=w.input,w.avail_in=nt,w.next_in=0,w.input=q,_t($);$.lookahead>=D;){for(P=$.strstart,T=$.lookahead-(D-1);$.ins_h=($.ins_h<<$.hash_shift^$.window[P+D-1])&$.hash_mask,$.prev[P&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=P,P++,--T;);$.strstart=P,$.lookahead=D-1,_t($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=D-1,$.match_available=0,w.next_in=Q,w.input=z,w.avail_in=X,$.wrap=F,p},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,s){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,s){i.exports=function(n,r){var o,l,h,c,d,u,p,m,g,y,b,_,x,C,k,M,L,N,D,G,Z,R,U,A,j;o=n.state,l=n.next_in,A=n.input,h=l+(n.avail_in-5),c=n.next_out,j=n.output,d=c-(r-n.avail_out),u=c+(n.avail_out-257),p=o.dmax,m=o.wsize,g=o.whave,y=o.wnext,b=o.window,_=o.hold,x=o.bits,C=o.lencode,k=o.distcode,M=(1<<o.lenbits)-1,L=(1<<o.distbits)-1;t:do{x<15&&(_+=A[l++]<<x,x+=8,_+=A[l++]<<x,x+=8),N=C[_&M];e:for(;;){if(_>>>=D=N>>>24,x-=D,(D=N>>>16&255)===0)j[c++]=65535&N;else{if(!(16&D)){if((64&D)==0){N=C[(65535&N)+(_&(1<<D)-1)];continue e}if(32&D){o.mode=12;break t}n.msg="invalid literal/length code",o.mode=30;break t}G=65535&N,(D&=15)&&(x<D&&(_+=A[l++]<<x,x+=8),G+=_&(1<<D)-1,_>>>=D,x-=D),x<15&&(_+=A[l++]<<x,x+=8,_+=A[l++]<<x,x+=8),N=k[_&L];i:for(;;){if(_>>>=D=N>>>24,x-=D,!(16&(D=N>>>16&255))){if((64&D)==0){N=k[(65535&N)+(_&(1<<D)-1)];continue i}n.msg="invalid distance code",o.mode=30;break t}if(Z=65535&N,x<(D&=15)&&(_+=A[l++]<<x,(x+=8)<D&&(_+=A[l++]<<x,x+=8)),p<(Z+=_&(1<<D)-1)){n.msg="invalid distance too far back",o.mode=30;break t}if(_>>>=D,x-=D,(D=c-d)<Z){if(g<(D=Z-D)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break t}if(U=b,(R=0)===y){if(R+=m-D,D<G){for(G-=D;j[c++]=b[R++],--D;);R=c-Z,U=j}}else if(y<D){if(R+=m+y-D,(D-=y)<G){for(G-=D;j[c++]=b[R++],--D;);if(R=0,y<G){for(G-=D=y;j[c++]=b[R++],--D;);R=c-Z,U=j}}}else if(R+=y-D,D<G){for(G-=D;j[c++]=b[R++],--D;);R=c-Z,U=j}for(;2<G;)j[c++]=U[R++],j[c++]=U[R++],j[c++]=U[R++],G-=3;G&&(j[c++]=U[R++],1<G&&(j[c++]=U[R++]))}else{for(R=c-Z;j[c++]=j[R++],j[c++]=j[R++],j[c++]=j[R++],2<(G-=3););G&&(j[c++]=j[R++],1<G&&(j[c++]=j[R++]))}break}}break}}while(l<h&&c<u);l-=G=x>>3,_&=(1<<(x-=G<<3))-1,n.next_in=l,n.next_out=c,n.avail_in=l<h?h-l+5:5-(l-h),n.avail_out=c<u?u-c+257:257-(c-u),o.hold=_,o.bits=x}},{}],49:[function(t,i,s){var n=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),l=t("./inffast"),h=t("./inftrees"),c=1,d=2,u=0,p=-2,m=1,g=852,y=592;function b(R){return(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(R){var U;return R&&R.state?(U=R.state,R.total_in=R.total_out=U.total=0,R.msg="",U.wrap&&(R.adler=1&U.wrap),U.mode=m,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new n.Buf32(g),U.distcode=U.distdyn=new n.Buf32(y),U.sane=1,U.back=-1,u):p}function C(R){var U;return R&&R.state?((U=R.state).wsize=0,U.whave=0,U.wnext=0,x(R)):p}function k(R,U){var A,j;return R&&R.state?(j=R.state,U<0?(A=0,U=-U):(A=1+(U>>4),U<48&&(U&=15)),U&&(U<8||15<U)?p:(j.window!==null&&j.wbits!==U&&(j.window=null),j.wrap=A,j.wbits=U,C(R))):p}function M(R,U){var A,j;return R?(j=new _,(R.state=j).window=null,(A=k(R,U))!==u&&(R.state=null),A):p}var L,N,D=!0;function G(R){if(D){var U;for(L=new n.Buf32(512),N=new n.Buf32(32),U=0;U<144;)R.lens[U++]=8;for(;U<256;)R.lens[U++]=9;for(;U<280;)R.lens[U++]=7;for(;U<288;)R.lens[U++]=8;for(h(c,R.lens,0,288,L,0,R.work,{bits:9}),U=0;U<32;)R.lens[U++]=5;h(d,R.lens,0,32,N,0,R.work,{bits:5}),D=!1}R.lencode=L,R.lenbits=9,R.distcode=N,R.distbits=5}function Z(R,U,A,j){var V,H=R.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new n.Buf8(H.wsize)),j>=H.wsize?(n.arraySet(H.window,U,A-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(j<(V=H.wsize-H.wnext)&&(V=j),n.arraySet(H.window,U,A-j,V,H.wnext),(j-=V)?(n.arraySet(H.window,U,A-j,j,0),H.wnext=j,H.whave=H.wsize):(H.wnext+=V,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=V))),0}s.inflateReset=C,s.inflateReset2=k,s.inflateResetKeep=x,s.inflateInit=function(R){return M(R,15)},s.inflateInit2=M,s.inflate=function(R,U){var A,j,V,H,ct,Y,ot,B,O,W,K,J,_t,mt,bt,Ct,Zt,qt,Hi,_i,w,q,$,P,T=0,F=new n.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!R||!R.state||!R.output||!R.input&&R.avail_in!==0)return p;(A=R.state).mode===12&&(A.mode=13),ct=R.next_out,V=R.output,ot=R.avail_out,H=R.next_in,j=R.input,Y=R.avail_in,B=A.hold,O=A.bits,W=Y,K=ot,q=u;t:for(;;)switch(A.mode){case m:if(A.wrap===0){A.mode=13;break}for(;O<16;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if(2&A.wrap&&B===35615){F[A.check=0]=255&B,F[1]=B>>>8&255,A.check=o(A.check,F,2,0),O=B=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&B)<<8)+(B>>8))%31){R.msg="incorrect header check",A.mode=30;break}if((15&B)!=8){R.msg="unknown compression method",A.mode=30;break}if(O-=4,w=8+(15&(B>>>=4)),A.wbits===0)A.wbits=w;else if(w>A.wbits){R.msg="invalid window size",A.mode=30;break}A.dmax=1<<w,R.adler=A.check=1,A.mode=512&B?10:12,O=B=0;break;case 2:for(;O<16;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if(A.flags=B,(255&A.flags)!=8){R.msg="unknown compression method",A.mode=30;break}if(57344&A.flags){R.msg="unknown header flags set",A.mode=30;break}A.head&&(A.head.text=B>>8&1),512&A.flags&&(F[0]=255&B,F[1]=B>>>8&255,A.check=o(A.check,F,2,0)),O=B=0,A.mode=3;case 3:for(;O<32;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}A.head&&(A.head.time=B),512&A.flags&&(F[0]=255&B,F[1]=B>>>8&255,F[2]=B>>>16&255,F[3]=B>>>24&255,A.check=o(A.check,F,4,0)),O=B=0,A.mode=4;case 4:for(;O<16;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}A.head&&(A.head.xflags=255&B,A.head.os=B>>8),512&A.flags&&(F[0]=255&B,F[1]=B>>>8&255,A.check=o(A.check,F,2,0)),O=B=0,A.mode=5;case 5:if(1024&A.flags){for(;O<16;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}A.length=B,A.head&&(A.head.extra_len=B),512&A.flags&&(F[0]=255&B,F[1]=B>>>8&255,A.check=o(A.check,F,2,0)),O=B=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(Y<(J=A.length)&&(J=Y),J&&(A.head&&(w=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Array(A.head.extra_len)),n.arraySet(A.head.extra,j,H,J,w)),512&A.flags&&(A.check=o(A.check,j,J,H)),Y-=J,H+=J,A.length-=J),A.length))break t;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(Y===0)break t;for(J=0;w=j[H+J++],A.head&&w&&A.length<65536&&(A.head.name+=String.fromCharCode(w)),w&&J<Y;);if(512&A.flags&&(A.check=o(A.check,j,J,H)),Y-=J,H+=J,w)break t}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(Y===0)break t;for(J=0;w=j[H+J++],A.head&&w&&A.length<65536&&(A.head.comment+=String.fromCharCode(w)),w&&J<Y;);if(512&A.flags&&(A.check=o(A.check,j,J,H)),Y-=J,H+=J,w)break t}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;O<16;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if(B!==(65535&A.check)){R.msg="header crc mismatch",A.mode=30;break}O=B=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),R.adler=A.check=0,A.mode=12;break;case 10:for(;O<32;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}R.adler=A.check=b(B),O=B=0,A.mode=11;case 11:if(A.havedict===0)return R.next_out=ct,R.avail_out=ot,R.next_in=H,R.avail_in=Y,A.hold=B,A.bits=O,2;R.adler=A.check=1,A.mode=12;case 12:if(U===5||U===6)break t;case 13:if(A.last){B>>>=7&O,O-=7&O,A.mode=27;break}for(;O<3;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}switch(A.last=1&B,O-=1,3&(B>>>=1)){case 0:A.mode=14;break;case 1:if(G(A),A.mode=20,U!==6)break;B>>>=2,O-=2;break t;case 2:A.mode=17;break;case 3:R.msg="invalid block type",A.mode=30}B>>>=2,O-=2;break;case 14:for(B>>>=7&O,O-=7&O;O<32;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if((65535&B)!=(B>>>16^65535)){R.msg="invalid stored block lengths",A.mode=30;break}if(A.length=65535&B,O=B=0,A.mode=15,U===6)break t;case 15:A.mode=16;case 16:if(J=A.length){if(Y<J&&(J=Y),ot<J&&(J=ot),J===0)break t;n.arraySet(V,j,H,J,ct),Y-=J,H+=J,ot-=J,ct+=J,A.length-=J;break}A.mode=12;break;case 17:for(;O<14;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if(A.nlen=257+(31&B),B>>>=5,O-=5,A.ndist=1+(31&B),B>>>=5,O-=5,A.ncode=4+(15&B),B>>>=4,O-=4,286<A.nlen||30<A.ndist){R.msg="too many length or distance symbols",A.mode=30;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;O<3;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}A.lens[X[A.have++]]=7&B,B>>>=3,O-=3}for(;A.have<19;)A.lens[X[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,$={bits:A.lenbits},q=h(0,A.lens,0,19,A.lencode,0,A.work,$),A.lenbits=$.bits,q){R.msg="invalid code lengths set",A.mode=30;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;Ct=(T=A.lencode[B&(1<<A.lenbits)-1])>>>16&255,Zt=65535&T,!((bt=T>>>24)<=O);){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if(Zt<16)B>>>=bt,O-=bt,A.lens[A.have++]=Zt;else{if(Zt===16){for(P=bt+2;O<P;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if(B>>>=bt,O-=bt,A.have===0){R.msg="invalid bit length repeat",A.mode=30;break}w=A.lens[A.have-1],J=3+(3&B),B>>>=2,O-=2}else if(Zt===17){for(P=bt+3;O<P;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}O-=bt,w=0,J=3+(7&(B>>>=bt)),B>>>=3,O-=3}else{for(P=bt+7;O<P;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}O-=bt,w=0,J=11+(127&(B>>>=bt)),B>>>=7,O-=7}if(A.have+J>A.nlen+A.ndist){R.msg="invalid bit length repeat",A.mode=30;break}for(;J--;)A.lens[A.have++]=w}}if(A.mode===30)break;if(A.lens[256]===0){R.msg="invalid code -- missing end-of-block",A.mode=30;break}if(A.lenbits=9,$={bits:A.lenbits},q=h(c,A.lens,0,A.nlen,A.lencode,0,A.work,$),A.lenbits=$.bits,q){R.msg="invalid literal/lengths set",A.mode=30;break}if(A.distbits=6,A.distcode=A.distdyn,$={bits:A.distbits},q=h(d,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,$),A.distbits=$.bits,q){R.msg="invalid distances set",A.mode=30;break}if(A.mode=20,U===6)break t;case 20:A.mode=21;case 21:if(6<=Y&&258<=ot){R.next_out=ct,R.avail_out=ot,R.next_in=H,R.avail_in=Y,A.hold=B,A.bits=O,l(R,K),ct=R.next_out,V=R.output,ot=R.avail_out,H=R.next_in,j=R.input,Y=R.avail_in,B=A.hold,O=A.bits,A.mode===12&&(A.back=-1);break}for(A.back=0;Ct=(T=A.lencode[B&(1<<A.lenbits)-1])>>>16&255,Zt=65535&T,!((bt=T>>>24)<=O);){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if(Ct&&(240&Ct)==0){for(qt=bt,Hi=Ct,_i=Zt;Ct=(T=A.lencode[_i+((B&(1<<qt+Hi)-1)>>qt)])>>>16&255,Zt=65535&T,!(qt+(bt=T>>>24)<=O);){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}B>>>=qt,O-=qt,A.back+=qt}if(B>>>=bt,O-=bt,A.back+=bt,A.length=Zt,Ct===0){A.mode=26;break}if(32&Ct){A.back=-1,A.mode=12;break}if(64&Ct){R.msg="invalid literal/length code",A.mode=30;break}A.extra=15&Ct,A.mode=22;case 22:if(A.extra){for(P=A.extra;O<P;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}A.length+=B&(1<<A.extra)-1,B>>>=A.extra,O-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;Ct=(T=A.distcode[B&(1<<A.distbits)-1])>>>16&255,Zt=65535&T,!((bt=T>>>24)<=O);){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if((240&Ct)==0){for(qt=bt,Hi=Ct,_i=Zt;Ct=(T=A.distcode[_i+((B&(1<<qt+Hi)-1)>>qt)])>>>16&255,Zt=65535&T,!(qt+(bt=T>>>24)<=O);){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}B>>>=qt,O-=qt,A.back+=qt}if(B>>>=bt,O-=bt,A.back+=bt,64&Ct){R.msg="invalid distance code",A.mode=30;break}A.offset=Zt,A.extra=15&Ct,A.mode=24;case 24:if(A.extra){for(P=A.extra;O<P;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}A.offset+=B&(1<<A.extra)-1,B>>>=A.extra,O-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){R.msg="invalid distance too far back",A.mode=30;break}A.mode=25;case 25:if(ot===0)break t;if(J=K-ot,A.offset>J){if((J=A.offset-J)>A.whave&&A.sane){R.msg="invalid distance too far back",A.mode=30;break}_t=J>A.wnext?(J-=A.wnext,A.wsize-J):A.wnext-J,J>A.length&&(J=A.length),mt=A.window}else mt=V,_t=ct-A.offset,J=A.length;for(ot<J&&(J=ot),ot-=J,A.length-=J;V[ct++]=mt[_t++],--J;);A.length===0&&(A.mode=21);break;case 26:if(ot===0)break t;V[ct++]=A.length,ot--,A.mode=21;break;case 27:if(A.wrap){for(;O<32;){if(Y===0)break t;Y--,B|=j[H++]<<O,O+=8}if(K-=ot,R.total_out+=K,A.total+=K,K&&(R.adler=A.check=A.flags?o(A.check,V,K,ct-K):r(A.check,V,K,ct-K)),K=ot,(A.flags?B:b(B))!==A.check){R.msg="incorrect data check",A.mode=30;break}O=B=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;O<32;){if(Y===0)break t;Y--,B+=j[H++]<<O,O+=8}if(B!==(4294967295&A.total)){R.msg="incorrect length check",A.mode=30;break}O=B=0}A.mode=29;case 29:q=1;break t;case 30:q=-3;break t;case 31:return-4;case 32:default:return p}return R.next_out=ct,R.avail_out=ot,R.next_in=H,R.avail_in=Y,A.hold=B,A.bits=O,(A.wsize||K!==R.avail_out&&A.mode<30&&(A.mode<27||U!==4))&&Z(R,R.output,R.next_out,K-R.avail_out)?(A.mode=31,-4):(W-=R.avail_in,K-=R.avail_out,R.total_in+=W,R.total_out+=K,A.total+=K,A.wrap&&K&&(R.adler=A.check=A.flags?o(A.check,V,K,R.next_out-K):r(A.check,V,K,R.next_out-K)),R.data_type=A.bits+(A.last?64:0)+(A.mode===12?128:0)+(A.mode===20||A.mode===15?256:0),(W==0&&K===0||U===4)&&q===u&&(q=-5),q)},s.inflateEnd=function(R){if(!R||!R.state)return p;var U=R.state;return U.window&&(U.window=null),R.state=null,u},s.inflateGetHeader=function(R,U){var A;return R&&R.state?(2&(A=R.state).wrap)==0?p:((A.head=U).done=!1,u):p},s.inflateSetDictionary=function(R,U){var A,j=U.length;return R&&R.state?(A=R.state).wrap!==0&&A.mode!==11?p:A.mode===11&&r(1,U,j,0)!==A.check?-3:Z(R,U,j,j)?(A.mode=31,-4):(A.havedict=1,u):p},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,s){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(c,d,u,p,m,g,y,b){var _,x,C,k,M,L,N,D,G,Z=b.bits,R=0,U=0,A=0,j=0,V=0,H=0,ct=0,Y=0,ot=0,B=0,O=null,W=0,K=new n.Buf16(16),J=new n.Buf16(16),_t=null,mt=0;for(R=0;R<=15;R++)K[R]=0;for(U=0;U<p;U++)K[d[u+U]]++;for(V=Z,j=15;1<=j&&K[j]===0;j--);if(j<V&&(V=j),j===0)return m[g++]=20971520,m[g++]=20971520,b.bits=1,0;for(A=1;A<j&&K[A]===0;A++);for(V<A&&(V=A),R=Y=1;R<=15;R++)if(Y<<=1,(Y-=K[R])<0)return-1;if(0<Y&&(c===0||j!==1))return-1;for(J[1]=0,R=1;R<15;R++)J[R+1]=J[R]+K[R];for(U=0;U<p;U++)d[u+U]!==0&&(y[J[d[u+U]]++]=U);if(L=c===0?(O=_t=y,19):c===1?(O=r,W-=257,_t=o,mt-=257,256):(O=l,_t=h,-1),R=A,M=g,ct=U=B=0,C=-1,k=(ot=1<<(H=V))-1,c===1&&852<ot||c===2&&592<ot)return 1;for(;;){for(N=R-ct,G=y[U]<L?(D=0,y[U]):y[U]>L?(D=_t[mt+y[U]],O[W+y[U]]):(D=96,0),_=1<<R-ct,A=x=1<<H;m[M+(B>>ct)+(x-=_)]=N<<24|D<<16|G|0,x!==0;);for(_=1<<R-1;B&_;)_>>=1;if(_!==0?(B&=_-1,B+=_):B=0,U++,--K[R]==0){if(R===j)break;R=d[u+y[U]]}if(V<R&&(B&k)!==C){for(ct===0&&(ct=V),M+=A,Y=1<<(H=R-ct);H+ct<j&&!((Y-=K[H+ct])<=0);)H++,Y<<=1;if(ot+=1<<H,c===1&&852<ot||c===2&&592<ot)return 1;m[C=B&k]=V<<24|H<<16|M-g|0}}return B!==0&&(m[M+B]=R-ct<<24|64<<16|0),b.bits=V,0}},{"../utils/common":41}],51:[function(t,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,s){var n=t("../utils/common"),r=0,o=1;function l(T){for(var F=T.length;0<=--F;)T[F]=0}var h=0,c=29,d=256,u=d+1+c,p=30,m=19,g=2*u+1,y=15,b=16,_=7,x=256,C=16,k=17,M=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(u+2));l(Z);var R=new Array(2*p);l(R);var U=new Array(512);l(U);var A=new Array(256);l(A);var j=new Array(c);l(j);var V,H,ct,Y=new Array(p);function ot(T,F,X,Q,z){this.static_tree=T,this.extra_bits=F,this.extra_base=X,this.elems=Q,this.max_length=z,this.has_stree=T&&T.length}function B(T,F){this.dyn_tree=T,this.max_code=0,this.stat_desc=F}function O(T){return T<256?U[T]:U[256+(T>>>7)]}function W(T,F){T.pending_buf[T.pending++]=255&F,T.pending_buf[T.pending++]=F>>>8&255}function K(T,F,X){T.bi_valid>b-X?(T.bi_buf|=F<<T.bi_valid&65535,W(T,T.bi_buf),T.bi_buf=F>>b-T.bi_valid,T.bi_valid+=X-b):(T.bi_buf|=F<<T.bi_valid&65535,T.bi_valid+=X)}function J(T,F,X){K(T,X[2*F],X[2*F+1])}function _t(T,F){for(var X=0;X|=1&T,T>>>=1,X<<=1,0<--F;);return X>>>1}function mt(T,F,X){var Q,z,tt=new Array(y+1),nt=0;for(Q=1;Q<=y;Q++)tt[Q]=nt=nt+X[Q-1]<<1;for(z=0;z<=F;z++){var et=T[2*z+1];et!==0&&(T[2*z]=_t(tt[et]++,et))}}function bt(T){var F;for(F=0;F<u;F++)T.dyn_ltree[2*F]=0;for(F=0;F<p;F++)T.dyn_dtree[2*F]=0;for(F=0;F<m;F++)T.bl_tree[2*F]=0;T.dyn_ltree[2*x]=1,T.opt_len=T.static_len=0,T.last_lit=T.matches=0}function Ct(T){8<T.bi_valid?W(T,T.bi_buf):0<T.bi_valid&&(T.pending_buf[T.pending++]=T.bi_buf),T.bi_buf=0,T.bi_valid=0}function Zt(T,F,X,Q){var z=2*F,tt=2*X;return T[z]<T[tt]||T[z]===T[tt]&&Q[F]<=Q[X]}function qt(T,F,X){for(var Q=T.heap[X],z=X<<1;z<=T.heap_len&&(z<T.heap_len&&Zt(F,T.heap[z+1],T.heap[z],T.depth)&&z++,!Zt(F,Q,T.heap[z],T.depth));)T.heap[X]=T.heap[z],X=z,z<<=1;T.heap[X]=Q}function Hi(T,F,X){var Q,z,tt,nt,et=0;if(T.last_lit!==0)for(;Q=T.pending_buf[T.d_buf+2*et]<<8|T.pending_buf[T.d_buf+2*et+1],z=T.pending_buf[T.l_buf+et],et++,Q===0?J(T,z,F):(J(T,(tt=A[z])+d+1,F),(nt=L[tt])!==0&&K(T,z-=j[tt],nt),J(T,tt=O(--Q),X),(nt=N[tt])!==0&&K(T,Q-=Y[tt],nt)),et<T.last_lit;);J(T,x,F)}function _i(T,F){var X,Q,z,tt=F.dyn_tree,nt=F.stat_desc.static_tree,et=F.stat_desc.has_stree,dt=F.stat_desc.elems,Ot=-1;for(T.heap_len=0,T.heap_max=g,X=0;X<dt;X++)tt[2*X]!==0?(T.heap[++T.heap_len]=Ot=X,T.depth[X]=0):tt[2*X+1]=0;for(;T.heap_len<2;)tt[2*(z=T.heap[++T.heap_len]=Ot<2?++Ot:0)]=1,T.depth[z]=0,T.opt_len--,et&&(T.static_len-=nt[2*z+1]);for(F.max_code=Ot,X=T.heap_len>>1;1<=X;X--)qt(T,tt,X);for(z=dt;X=T.heap[1],T.heap[1]=T.heap[T.heap_len--],qt(T,tt,1),Q=T.heap[1],T.heap[--T.heap_max]=X,T.heap[--T.heap_max]=Q,tt[2*z]=tt[2*X]+tt[2*Q],T.depth[z]=(T.depth[X]>=T.depth[Q]?T.depth[X]:T.depth[Q])+1,tt[2*X+1]=tt[2*Q+1]=z,T.heap[1]=z++,qt(T,tt,1),2<=T.heap_len;);T.heap[--T.heap_max]=T.heap[1],(function(xt,ai){var co,Ui,uo,Vt,bh,Nc,hs=ai.dyn_tree,ku=ai.max_code,og=ai.stat_desc.static_tree,lg=ai.stat_desc.has_stree,hg=ai.stat_desc.extra_bits,Tu=ai.stat_desc.extra_base,fo=ai.stat_desc.max_length,yh=0;for(Vt=0;Vt<=y;Vt++)xt.bl_count[Vt]=0;for(hs[2*xt.heap[xt.heap_max]+1]=0,co=xt.heap_max+1;co<g;co++)fo<(Vt=hs[2*hs[2*(Ui=xt.heap[co])+1]+1]+1)&&(Vt=fo,yh++),hs[2*Ui+1]=Vt,ku<Ui||(xt.bl_count[Vt]++,bh=0,Tu<=Ui&&(bh=hg[Ui-Tu]),Nc=hs[2*Ui],xt.opt_len+=Nc*(Vt+bh),lg&&(xt.static_len+=Nc*(og[2*Ui+1]+bh)));if(yh!==0){do{for(Vt=fo-1;xt.bl_count[Vt]===0;)Vt--;xt.bl_count[Vt]--,xt.bl_count[Vt+1]+=2,xt.bl_count[fo]--,yh-=2}while(0<yh);for(Vt=fo;Vt!==0;Vt--)for(Ui=xt.bl_count[Vt];Ui!==0;)ku<(uo=xt.heap[--co])||(hs[2*uo+1]!==Vt&&(xt.opt_len+=(Vt-hs[2*uo+1])*hs[2*uo],hs[2*uo+1]=Vt),Ui--)}})(T,F),mt(tt,Ot,T.bl_count)}function w(T,F,X){var Q,z,tt=-1,nt=F[1],et=0,dt=7,Ot=4;for(nt===0&&(dt=138,Ot=3),F[2*(X+1)+1]=65535,Q=0;Q<=X;Q++)z=nt,nt=F[2*(Q+1)+1],++et<dt&&z===nt||(et<Ot?T.bl_tree[2*z]+=et:z!==0?(z!==tt&&T.bl_tree[2*z]++,T.bl_tree[2*C]++):et<=10?T.bl_tree[2*k]++:T.bl_tree[2*M]++,tt=z,Ot=(et=0)===nt?(dt=138,3):z===nt?(dt=6,3):(dt=7,4))}function q(T,F,X){var Q,z,tt=-1,nt=F[1],et=0,dt=7,Ot=4;for(nt===0&&(dt=138,Ot=3),Q=0;Q<=X;Q++)if(z=nt,nt=F[2*(Q+1)+1],!(++et<dt&&z===nt)){if(et<Ot)for(;J(T,z,T.bl_tree),--et!=0;);else z!==0?(z!==tt&&(J(T,z,T.bl_tree),et--),J(T,C,T.bl_tree),K(T,et-3,2)):et<=10?(J(T,k,T.bl_tree),K(T,et-3,3)):(J(T,M,T.bl_tree),K(T,et-11,7));tt=z,Ot=(et=0)===nt?(dt=138,3):z===nt?(dt=6,3):(dt=7,4)}}l(Y);var $=!1;function P(T,F,X,Q){K(T,(h<<1)+(Q?1:0),3),(function(z,tt,nt,et){Ct(z),W(z,nt),W(z,~nt),n.arraySet(z.pending_buf,z.window,tt,nt,z.pending),z.pending+=nt})(T,F,X)}s._tr_init=function(T){$||((function(){var F,X,Q,z,tt,nt=new Array(y+1);for(z=Q=0;z<c-1;z++)for(j[z]=Q,F=0;F<1<<L[z];F++)A[Q++]=z;for(A[Q-1]=z,z=tt=0;z<16;z++)for(Y[z]=tt,F=0;F<1<<N[z];F++)U[tt++]=z;for(tt>>=7;z<p;z++)for(Y[z]=tt<<7,F=0;F<1<<N[z]-7;F++)U[256+tt++]=z;for(X=0;X<=y;X++)nt[X]=0;for(F=0;F<=143;)Z[2*F+1]=8,F++,nt[8]++;for(;F<=255;)Z[2*F+1]=9,F++,nt[9]++;for(;F<=279;)Z[2*F+1]=7,F++,nt[7]++;for(;F<=287;)Z[2*F+1]=8,F++,nt[8]++;for(mt(Z,u+1,nt),F=0;F<p;F++)R[2*F+1]=5,R[2*F]=_t(F,5);V=new ot(Z,L,d+1,u,y),H=new ot(R,N,0,p,y),ct=new ot(new Array(0),D,0,m,_)})(),$=!0),T.l_desc=new B(T.dyn_ltree,V),T.d_desc=new B(T.dyn_dtree,H),T.bl_desc=new B(T.bl_tree,ct),T.bi_buf=0,T.bi_valid=0,bt(T)},s._tr_stored_block=P,s._tr_flush_block=function(T,F,X,Q){var z,tt,nt=0;0<T.level?(T.strm.data_type===2&&(T.strm.data_type=(function(et){var dt,Ot=4093624447;for(dt=0;dt<=31;dt++,Ot>>>=1)if(1&Ot&&et.dyn_ltree[2*dt]!==0)return r;if(et.dyn_ltree[18]!==0||et.dyn_ltree[20]!==0||et.dyn_ltree[26]!==0)return o;for(dt=32;dt<d;dt++)if(et.dyn_ltree[2*dt]!==0)return o;return r})(T)),_i(T,T.l_desc),_i(T,T.d_desc),nt=(function(et){var dt;for(w(et,et.dyn_ltree,et.l_desc.max_code),w(et,et.dyn_dtree,et.d_desc.max_code),_i(et,et.bl_desc),dt=m-1;3<=dt&&et.bl_tree[2*G[dt]+1]===0;dt--);return et.opt_len+=3*(dt+1)+5+5+4,dt})(T),z=T.opt_len+3+7>>>3,(tt=T.static_len+3+7>>>3)<=z&&(z=tt)):z=tt=X+5,X+4<=z&&F!==-1?P(T,F,X,Q):T.strategy===4||tt===z?(K(T,2+(Q?1:0),3),Hi(T,Z,R)):(K(T,4+(Q?1:0),3),(function(et,dt,Ot,xt){var ai;for(K(et,dt-257,5),K(et,Ot-1,5),K(et,xt-4,4),ai=0;ai<xt;ai++)K(et,et.bl_tree[2*G[ai]+1],3);q(et,et.dyn_ltree,dt-1),q(et,et.dyn_dtree,Ot-1)})(T,T.l_desc.max_code+1,T.d_desc.max_code+1,nt+1),Hi(T,T.dyn_ltree,T.dyn_dtree)),bt(T),Q&&Ct(T)},s._tr_tally=function(T,F,X){return T.pending_buf[T.d_buf+2*T.last_lit]=F>>>8&255,T.pending_buf[T.d_buf+2*T.last_lit+1]=255&F,T.pending_buf[T.l_buf+T.last_lit]=255&X,T.last_lit++,F===0?T.dyn_ltree[2*X]++:(T.matches++,F--,T.dyn_ltree[2*(A[X]+d+1)]++,T.dyn_dtree[2*O(F)]++),T.last_lit===T.lit_bufsize-1},s._tr_align=function(T){K(T,2,3),J(T,x,Z),(function(F){F.bi_valid===16?(W(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):8<=F.bi_valid&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)})(T)}},{"../utils/common":41}],53:[function(t,i,s){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,s){(function(n){(function(r,o){if(!r.setImmediate){var l,h,c,d,u=1,p={},m=!1,g=r.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(r);y=y&&y.setTimeout?y:r,l={}.toString.call(r.process)==="[object process]"?function(C){process.nextTick(function(){_(C)})}:(function(){if(r.postMessage&&!r.importScripts){var C=!0,k=r.onmessage;return r.onmessage=function(){C=!1},r.postMessage("","*"),r.onmessage=k,C}})()?(d="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",x,!1):r.attachEvent("onmessage",x),function(C){r.postMessage(d+C,"*")}):r.MessageChannel?((c=new MessageChannel).port1.onmessage=function(C){_(C.data)},function(C){c.port2.postMessage(C)}):g&&"onreadystatechange"in g.createElement("script")?(h=g.documentElement,function(C){var k=g.createElement("script");k.onreadystatechange=function(){_(C),k.onreadystatechange=null,h.removeChild(k),k=null},h.appendChild(k)}):function(C){setTimeout(_,0,C)},y.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var k=new Array(arguments.length-1),M=0;M<k.length;M++)k[M]=arguments[M+1];var L={callback:C,args:k};return p[u]=L,l(u),u++},y.clearImmediate=b}function b(C){delete p[C]}function _(C){if(m)setTimeout(_,0,C);else{var k=p[C];if(k){m=!0;try{(function(M){var L=M.callback,N=M.args;switch(N.length){case 0:L();break;case 1:L(N[0]);break;case 2:L(N[0],N[1]);break;case 3:L(N[0],N[1],N[2]);break;default:L.apply(o,N)}})(k)}finally{b(C),m=!1}}}}function x(C){C.source===r&&typeof C.data=="string"&&C.data.indexOf(d)===0&&_(+C.data.slice(d.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof vh<"u"?vh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(zc)),zc.exports}var pg=fg();const sf=ug(pg);var Fo={};Fo.d=(f,e)=>{for(var t in e)Fo.o(e,t)&&!Fo.o(f,t)&&Object.defineProperty(f,t,{enumerable:!0,get:e[t]})};Fo.o=(f,e)=>Object.prototype.hasOwnProperty.call(f,e);var pt=globalThis.pdfjsLib={};Fo.d(pt,{AbortException:()=>Cn,AnnotationEditorLayer:()=>eu,AnnotationEditorParamsType:()=>Et,AnnotationEditorType:()=>yt,AnnotationEditorUIManager:()=>Ur,AnnotationLayer:()=>hb,AnnotationMode:()=>Vs,ColorPicker:()=>ac,DOMSVGFactory:()=>bu,DrawLayer:()=>nu,FeatureTest:()=>De,GlobalWorkerOptions:()=>Hs,ImageKind:()=>xh,InvalidPDFException:()=>Xc,MissingPDFException:()=>No,OPS:()=>Si,OutputScale:()=>Kc,PDFDataRangeTransport:()=>rp,PDFDateString:()=>fu,PDFWorker:()=>ia,PasswordResponses:()=>yg,PermissionFlag:()=>bg,PixelsPerInch:()=>kn,RenderingCancelledException:()=>du,TextLayer:()=>Bo,TouchManager:()=>nc,UnexpectedResponseException:()=>ec,Util:()=>ht,VerbosityLevel:()=>Tc,XfaLayer:()=>op,build:()=>jm,createValidAbsoluteUrl:()=>Ag,fetchData:()=>Lc,getDocument:()=>Dm,getFilenameFromUrl:()=>Ig,getPdfFilenameFromUrl:()=>Lg,getXfaPageViewport:()=>Mg,isDataScheme:()=>Mc,isPdfFile:()=>uu,noContextMenu:()=>Bi,normalizeUnicode:()=>Tg,setLayerDimensions:()=>Hr,shadow:()=>St,stopEvent:()=>ni,version:()=>$m});const Ce=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),nf=[1,0,0,1,0,0],Vc=[.001,0,0,.001,0,0],gg=1e7,Hc=1.35,ii={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Vs={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},mg="pdfjs_internal_editor_",yt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Et={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},bg={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ye={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},xh={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ee={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},po={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Tc={ERRORS:0,WARNINGS:1,INFOS:5},Si={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},yg={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Pc=Tc.WARNINGS;function vg(f){Number.isInteger(f)&&(Pc=f)}function wg(){return Pc}function Rc(f){Pc>=Tc.INFOS&&console.log(`Info: ${f}`)}function vt(f){Pc>=Tc.WARNINGS&&console.log(`Warning: ${f}`)}function Ft(f){throw new Error(f)}function Jt(f,e){f||Ft(e)}function _g(f){switch(f==null?void 0:f.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Ag(f,e=null,t=null){if(!f)return null;try{if(t&&typeof f=="string"){if(t.addDefaultProtocol&&f.startsWith("www.")){const s=f.match(/\./g);(s==null?void 0:s.length)>=2&&(f=`http://${f}`)}if(t.tryConvertEncoding)try{f=kg(f)}catch{}}const i=e?new URL(f,e):new URL(f);if(_g(i))return i}catch{}return null}function St(f,e,t,i=!1){return Object.defineProperty(f,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}const Rn=(function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e})();class Iu extends Rn{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Uc extends Rn{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Xc extends Rn{constructor(e){super(e,"InvalidPDFException")}}class No extends Rn{constructor(e){super(e,"MissingPDFException")}}class ec extends Rn{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class Sg extends Rn{constructor(e){super(e,"FormatError")}}class Cn extends Rn{constructor(e){super(e,"AbortException")}}function rf(f){(typeof f!="object"||(f==null?void 0:f.length)===void 0)&&Ft("Invalid argument for bytesToString");const e=f.length,t=8192;if(e<t)return String.fromCharCode.apply(null,f);const i=[];for(let s=0;s<e;s+=t){const n=Math.min(s+t,e),r=f.subarray(s,n);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function Ic(f){typeof f!="string"&&Ft("Invalid argument for stringToBytes");const e=f.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=f.charCodeAt(i)&255;return t}function Eg(f){return String.fromCharCode(f>>24&255,f>>16&255,f>>8&255,f&255)}function hu(f){const e=Object.create(null);for(const[t,i]of f)e[t]=i;return e}function xg(){const f=new Uint8Array(4);return f[0]=1,new Uint32Array(f.buffer,0,1)[0]===1}function Cg(){try{return new Function(""),!0}catch{return!1}}class De{static get isLittleEndian(){return St(this,"isLittleEndian",xg())}static get isEvalSupported(){return St(this,"isEvalSupported",Cg())}static get isOffscreenCanvasSupported(){return St(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return St(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?St(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):St(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return St(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const $c=Array.from(Array(256).keys(),f=>f.toString(16).padStart(2,"0"));var $s,Ch,Yc;class ht{static makeHexColor(e,t,i){return`#${$c[e]}${$c[t]}${$c[i]}`}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const i=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[i,s]}static applyInverseTransform(e,t){const i=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/i,n=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/i;return[s,n]}static getAxialAlignedBoundingBox(e,t){const i=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),n=this.applyTransform([e[0],e[3]],t),r=this.applyTransform([e[2],e[1]],t);return[Math.min(i[0],s[0],n[0],r[0]),Math.min(i[1],s[1],n[1],r[1]),Math.max(i[0],s[0],n[0],r[0]),Math.max(i[1],s[1],n[1],r[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],i=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],n=e[2]*t[0]+e[3]*t[2],r=e[2]*t[1]+e[3]*t[3],o=(i+r)/2,l=Math.sqrt((i+r)**2-4*(i*r-n*s))/2,h=o+l||1,c=o-l||1;return[Math.sqrt(h),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>s)return null;const n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>r?null:[i,n,s,r]}static bezierBoundingBox(e,t,i,s,n,r,o,l,h){return h?(h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],t,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],t,l)):h=[Math.min(e,o),Math.min(t,l),Math.max(e,o),Math.max(t,l)],E(this,$s,Yc).call(this,e,i,n,o,t,s,r,l,3*(-e+3*(i-n)+o),6*(e-2*i+n),3*(i-e),h),E(this,$s,Yc).call(this,e,i,n,o,t,s,r,l,3*(-t+3*(s-r)+l),6*(t-2*s+r),3*(s-t),h),h}}$s=new WeakSet,Ch=function(e,t,i,s,n,r,o,l,h,c){if(h<=0||h>=1)return;const d=1-h,u=h*h,p=u*h,m=d*(d*(d*e+3*h*t)+3*u*i)+p*s,g=d*(d*(d*n+3*h*r)+3*u*o)+p*l;c[0]=Math.min(c[0],m),c[1]=Math.min(c[1],g),c[2]=Math.max(c[2],m),c[3]=Math.max(c[3],g)},Yc=function(e,t,i,s,n,r,o,l,h,c,d,u){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&E(this,$s,Ch).call(this,e,t,i,s,n,r,o,l,-d/c,u);return}const p=c**2-4*d*h;if(p<0)return;const m=Math.sqrt(p),g=2*h;E(this,$s,Ch).call(this,e,t,i,s,n,r,o,l,(-c+m)/g,u),E(this,$s,Ch).call(this,e,t,i,s,n,r,o,l,(-c-m)/g,u)},S(ht,$s);function kg(f){return decodeURIComponent(escape(f))}let jc=null,Lu=null;function Tg(f){return jc||(jc=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Lu=new Map([["","t"]])),f.replaceAll(jc,(e,t,i)=>t?t.normalize("NFKC"):Lu.get(i))}function Pg(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const f=new Uint8Array(32);return crypto.getRandomValues(f),rf(f)}const cu="pdfjs_internal_id_";function Rg(f){return Uint8Array.prototype.toBase64?f.toBase64():btoa(rf(f))}typeof Promise.try!="function"&&(Promise.try=function(f,...e){return new Promise(t=>{t(f(...e))})});const cs="http://www.w3.org/2000/svg",Dn=class Dn{};ut(Dn,"CSS",96),ut(Dn,"PDF",72),ut(Dn,"PDF_TO_CSS_UNITS",Dn.CSS/Dn.PDF);let kn=Dn;async function Lc(f,e="text"){if(yo(f,document.baseURI)){const t=await fetch(f);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{const s=new XMLHttpRequest;s.open("GET",f,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class fh{constructor({viewBox:e,userUnit:t,scale:i,rotation:s,offsetX:n=0,offsetY:r=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=i,this.rotation=s,this.offsetX=n,this.offsetY=r,i*=t;const l=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let c,d,u,p;switch(s%=360,s<0&&(s+=360),s){case 180:c=-1,d=0,u=0,p=1;break;case 90:c=0,d=1,u=1,p=0;break;case 270:c=0,d=-1,u=-1,p=0;break;case 0:c=1,d=0,u=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(u=-u,p=-p);let m,g,y,b;c===0?(m=Math.abs(h-e[1])*i+n,g=Math.abs(l-e[0])*i+r,y=(e[3]-e[1])*i,b=(e[2]-e[0])*i):(m=Math.abs(l-e[0])*i+n,g=Math.abs(h-e[1])*i+r,y=(e[2]-e[0])*i,b=(e[3]-e[1])*i),this.transform=[c*i,d*i,u*i,p*i,m-c*i*l-u*i*h,g-d*i*l-p*i*h],this.width=y,this.height=b}get rawDims(){const{userUnit:e,viewBox:t}=this,i=t.map(s=>s*e);return St(this,"rawDims",{pageWidth:i[2]-i[0],pageHeight:i[3]-i[1],pageX:i[0],pageY:i[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new fh({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(e,t){return ht.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=ht.applyTransform([e[0],e[1]],this.transform),i=ht.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){return ht.applyInverseTransform([e,t],this.transform)}}class du extends Rn{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Mc(f){const e=f.length;let t=0;for(;t<e&&f[t].trim()==="";)t++;return f.substring(t,t+5).toLowerCase()==="data:"}function uu(f){return typeof f=="string"&&/\.pdf$/i.test(f)}function Ig(f){return[f]=f.split(/[#?]/,1),f.substring(f.lastIndexOf("/")+1)}function Lg(f,e="document.pdf"){if(typeof f!="string")return e;if(Mc(f))return vt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(f);let n=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(n&&(n=n[0],n.includes("%")))try{n=i.exec(decodeURIComponent(n))[0]}catch{}return n||e}class Mu{constructor(){ut(this,"started",Object.create(null));ut(this,"times",[])}time(e){e in this.started&&vt(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||vt(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:s,end:n}of this.times)e.push(`${i.padEnd(t)} ${n-s}ms
`);return e.join("")}}function yo(f,e){try{const{protocol:t}=e?new URL(f,e):new URL(f);return t==="http:"||t==="https:"}catch{return!1}}function Bi(f){f.preventDefault()}function ni(f){f.preventDefault(),f.stopPropagation()}var $o;class fu{static toDateObject(e){if(!e||typeof e!="string")return null;a(this,$o)||v(this,$o,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=a(this,$o).exec(e);if(!t)return null;const i=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const h=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,h==="-"?(r+=c,o+=d):h==="+"&&(r-=c,o-=d),new Date(Date.UTC(i,s,n,r,o,l))}}$o=new WeakMap,S(fu,$o);function Mg(f,{scale:e=1,rotation:t=0}){const{width:i,height:s}=f.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new fh({viewBox:n,userUnit:1,scale:e,rotation:t})}function pu(f){if(f.startsWith("#")){const e=parseInt(f.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return f.startsWith("rgb(")?f.slice(4,-1).split(",").map(e=>parseInt(e)):f.startsWith("rgba(")?f.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(vt(`Not a valid color format: "${f}"`),[0,0,0])}function Dg(f){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of f.keys()){e.style.color=t;const i=window.getComputedStyle(e).color;f.set(t,pu(i))}e.remove()}function Ht(f){const{a:e,b:t,c:i,d:s,e:n,f:r}=f.getTransform();return[e,t,i,s,n,r]}function $i(f){const{a:e,b:t,c:i,d:s,e:n,f:r}=f.getTransform().invertSelf();return[e,t,i,s,n,r]}function Hr(f,e,t=!1,i=!0){if(e instanceof fh){const{pageWidth:s,pageHeight:n}=e.rawDims,{style:r}=f,o=De.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,h=`var(--scale-factor) * ${n}px`,c=o?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,d=o?`round(down, ${h}, var(--scale-round-y, 1px))`:`calc(${h})`;!t||e.rotation%180===0?(r.width=c,r.height=d):(r.width=d,r.height=c)}i&&f.setAttribute("data-main-rotation",e.rotation)}class Kc{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var Xs,On,Ei,Nn,jo,Go,hc,af,Fe,of,lf,kh,hf,Qc;const fs=class fs{constructor(e){S(this,Fe);S(this,Xs,null);S(this,On,null);S(this,Ei);S(this,Nn,null);S(this,jo,null);v(this,Ei,e),a(fs,Go)||v(fs,Go,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=v(this,Xs,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=a(this,Ei)._uiManager._signal;e.addEventListener("contextmenu",Bi,{signal:t}),e.addEventListener("pointerdown",E(fs,hc,af),{signal:t});const i=v(this,Nn,document.createElement("div"));i.className="buttons",e.append(i);const s=a(this,Ei).toolbarPosition;if(s){const{style:n}=e,r=a(this,Ei)._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return E(this,Fe,hf).call(this),e}get div(){return a(this,Xs)}hide(){var e;a(this,Xs).classList.add("hidden"),(e=a(this,On))==null||e.hideDropdown()}show(){var e;a(this,Xs).classList.remove("hidden"),(e=a(this,jo))==null||e.shown()}async addAltText(e){const t=await e.render();E(this,Fe,kh).call(this,t),a(this,Nn).prepend(t,a(this,Fe,Qc)),v(this,jo,e)}addColorPicker(e){v(this,On,e);const t=e.renderButton();E(this,Fe,kh).call(this,t),a(this,Nn).prepend(t,a(this,Fe,Qc))}remove(){var e;a(this,Xs).remove(),(e=a(this,On))==null||e.destroy(),v(this,On,null)}};Xs=new WeakMap,On=new WeakMap,Ei=new WeakMap,Nn=new WeakMap,jo=new WeakMap,Go=new WeakMap,hc=new WeakSet,af=function(e){e.stopPropagation()},Fe=new WeakSet,of=function(e){a(this,Ei)._focusEventsAllowed=!1,ni(e)},lf=function(e){a(this,Ei)._focusEventsAllowed=!0,ni(e)},kh=function(e){const t=a(this,Ei)._uiManager._signal;e.addEventListener("focusin",E(this,Fe,of).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",E(this,Fe,lf).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Bi,{signal:t})},hf=function(){const{editorType:e,_uiManager:t}=a(this,Ei),i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",a(fs,Go)[e]),E(this,Fe,kh).call(this,i),i.addEventListener("click",s=>{t.delete()},{signal:t._signal}),a(this,Nn).append(i)},Qc=function(){const e=document.createElement("div");return e.className="divider",e},S(fs,hc),S(fs,Go,null);let Zc=fs;var Wo,Bn,zn,Pn,cf,df,uf;class Fg{constructor(e){S(this,Pn);S(this,Wo,null);S(this,Bn,null);S(this,zn);v(this,zn,e)}show(e,t,i){const[s,n]=E(this,Pn,df).call(this,t,i),{style:r}=a(this,Bn)||v(this,Bn,E(this,Pn,cf).call(this));e.append(a(this,Bn)),r.insetInlineEnd=`${100*s}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){a(this,Bn).remove()}}Wo=new WeakMap,Bn=new WeakMap,zn=new WeakMap,Pn=new WeakSet,cf=function(){const e=v(this,Bn,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Bi,{signal:a(this,zn)._signal});const t=v(this,Wo,document.createElement("div"));return t.className="buttons",e.append(t),E(this,Pn,uf).call(this),e},df=function(e,t){let i=0,s=0;for(const n of e){const r=n.y+n.height;if(r<i)continue;const o=n.x+(t?n.width:0);if(r>i){s=o,i=r;continue}t?o>s&&(s=o):o<s&&(s=o)}return[t?1-s:s,i]},uf=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=a(this,zn)._signal;e.addEventListener("contextmenu",Bi,{signal:i}),e.addEventListener("click",()=>{a(this,zn).highlightSelection("floating_button")},{signal:i}),a(this,Wo).append(e)};function ic(f,e,t){for(const i of t)e.addEventListener(i,f[i].bind(f))}var cc;class Og{constructor(){S(this,cc,0)}get id(){return`${mg}${ke(this,cc)._++}`}}cc=new WeakMap;var ra,qo,_e,aa,Th;const _u=class _u{constructor(){S(this,aa);S(this,ra,Pg());S(this,qo,0);S(this,_e,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;const n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return St(this,"_isSVGFittingCanvas",n)}async getFromFile(e){const{lastModified:t,name:i,size:s,type:n}=e;return E(this,aa,Th).call(this,`${t}_${i}_${s}_${n}`,e)}async getFromUrl(e){return E(this,aa,Th).call(this,e,e)}async getFromBlob(e,t){const i=await t;return E(this,aa,Th).call(this,e,i)}async getFromId(e){a(this,_e)||v(this,_e,new Map);const t=a(this,_e).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)}getFromCanvas(e,t){a(this,_e)||v(this,_e,new Map);let i=a(this,_e).get(e);if(i!=null&&i.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${a(this,ra)}_${ke(this,qo)._++}`,refCounter:1,isSvg:!1},a(this,_e).set(e,i),a(this,_e).set(i.id,i),i}getSvgUrl(e){const t=a(this,_e).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var s;a(this,_e)||v(this,_e,new Map);const t=a(this,_e).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:i}=t;if(!t.url&&!t.file){const n=new OffscreenCanvas(i.width,i.height);n.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=n.convertToBlob()}(s=i.close)==null||s.call(i),t.bitmap=null}isValidId(e){return e.startsWith(`image_${a(this,ra)}_`)}};ra=new WeakMap,qo=new WeakMap,_e=new WeakMap,aa=new WeakSet,Th=async function(e,t){a(this,_e)||v(this,_e,new Map);let i=a(this,_e).get(e);if(i===null)return null;if(i!=null&&i.bitmap)return i.refCounter+=1,i;try{i||(i={bitmap:null,id:`image_${a(this,ra)}_${ke(this,qo)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(i.url=t,s=await Lc(t,"blob")):t instanceof File?s=i.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){const n=_u._isSVGFittingCanvas,r=new FileReader,o=new Image,l=new Promise((h,c)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,h()},r.onload=async()=>{const d=i.svgUrl=r.result;o.src=await n?`${d}#svgView(preserveAspectRatio(none))`:d},o.onerror=r.onerror=c});r.readAsDataURL(s),await l}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){vt(s),i=null}return a(this,_e).set(e,i),i&&a(this,_e).set(i.id,i),i};let Jc=_u;var Xt,Ys,Vo,$t;class Ng{constructor(e=128){S(this,Xt,[]);S(this,Ys,!1);S(this,Vo);S(this,$t,-1);v(this,Vo,e)}add({cmd:e,undo:t,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:o=!1}){if(s&&e(),a(this,Ys))return;const l={cmd:e,undo:t,post:i,type:n};if(a(this,$t)===-1){a(this,Xt).length>0&&(a(this,Xt).length=0),v(this,$t,0),a(this,Xt).push(l);return}if(r&&a(this,Xt)[a(this,$t)].type===n){o&&(l.undo=a(this,Xt)[a(this,$t)].undo),a(this,Xt)[a(this,$t)]=l;return}const h=a(this,$t)+1;h===a(this,Vo)?a(this,Xt).splice(0,1):(v(this,$t,h),h<a(this,Xt).length&&a(this,Xt).splice(h)),a(this,Xt).push(l)}undo(){if(a(this,$t)===-1)return;v(this,Ys,!0);const{undo:e,post:t}=a(this,Xt)[a(this,$t)];e(),t==null||t(),v(this,Ys,!1),v(this,$t,a(this,$t)-1)}redo(){if(a(this,$t)<a(this,Xt).length-1){v(this,$t,a(this,$t)+1),v(this,Ys,!0);const{cmd:e,post:t}=a(this,Xt)[a(this,$t)];e(),t==null||t(),v(this,Ys,!1)}}hasSomethingToUndo(){return a(this,$t)!==-1}hasSomethingToRedo(){return a(this,$t)<a(this,Xt).length-1}cleanType(e){if(a(this,$t)!==-1){for(let t=a(this,$t);t>=0;t--)if(a(this,Xt)[t].type!==e){a(this,Xt).splice(t+1,a(this,$t)-t),v(this,$t,t);return}a(this,Xt).length=0,v(this,$t,-1)}}destroy(){v(this,Xt,null)}}Xt=new WeakMap,Ys=new WeakMap,Vo=new WeakMap,$t=new WeakMap;var dc,ff;class ph{constructor(e){S(this,dc);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=De.platform;for(const[i,s,n={}]of e)for(const r of i){const o=r.startsWith("mac+");t&&o?(this.callbacks.set(r.slice(4),{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1))):!t&&!o&&(this.callbacks.set(r,{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(E(this,dc,ff).call(this,t));if(!i)return;const{callback:s,options:{bubbles:n=!1,args:r=[],checker:o=null}}=i;o&&!o(e,t)||(s.bind(e,...r,t)(),n||ni(t))}}dc=new WeakSet,ff=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const uc=class uc{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return Dg(e),St(this,"_colors",e)}convert(e){const t=pu(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,s]of this._colors)if(s.every((n,r)=>n===t[r]))return uc._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?ht.makeHexColor(...t):e}};ut(uc,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let td=uc;var oa,Ge,se,ue,la,gs,ha,li,Ks,Hn,ca,Un,Wi,xi,$n,Xo,Yo,da,Ko,qi,Zs,ua,Qs,Vi,fc,Js,Zo,tn,jn,Qo,Jo,ae,It,ms,Gn,tl,el,en,Xi,bs,il,hi,it,Ph,ed,pf,gf,Rh,mf,bf,yf,id,vf,sd,nd,wf,Te,ds,_f,Af,rd,Sf,vo,ad;const Jr=class Jr{constructor(e,t,i,s,n,r,o,l,h,c,d,u,p){S(this,it);S(this,oa,new AbortController);S(this,Ge,null);S(this,se,new Map);S(this,ue,new Map);S(this,la,null);S(this,gs,null);S(this,ha,null);S(this,li,new Ng);S(this,Ks,null);S(this,Hn,null);S(this,ca,0);S(this,Un,new Set);S(this,Wi,null);S(this,xi,null);S(this,$n,new Set);ut(this,"_editorUndoBar",null);S(this,Xo,!1);S(this,Yo,!1);S(this,da,!1);S(this,Ko,null);S(this,qi,null);S(this,Zs,null);S(this,ua,null);S(this,Qs,!1);S(this,Vi,null);S(this,fc,new Og);S(this,Js,!1);S(this,Zo,!1);S(this,tn,null);S(this,jn,null);S(this,Qo,null);S(this,Jo,null);S(this,ae,yt.NONE);S(this,It,new Set);S(this,ms,null);S(this,Gn,null);S(this,tl,null);S(this,el,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});S(this,en,[0,0]);S(this,Xi,null);S(this,bs,null);S(this,il,null);S(this,hi,null);const m=this._signal=a(this,oa).signal;v(this,bs,e),v(this,il,t),v(this,la,i),this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:m}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),s._on("setpreference",this.onSetPreference.bind(this),{signal:m}),s._on("switchannotationeditorparams",g=>this.updateParams(g.type,g.value),{signal:m}),E(this,it,mf).call(this),E(this,it,wf).call(this),E(this,it,id).call(this),v(this,gs,n.annotationStorage),v(this,Ko,n.filterFactory),v(this,Gn,r),v(this,ua,o||null),v(this,Xo,l),v(this,Yo,h),v(this,da,c),v(this,Jo,d||null),this.viewParameters={realScale:kn.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=u||null,this._supportsPinchToZoom=p!==!1}static get _keyboardManager(){const e=Jr.prototype,t=r=>a(r,bs).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),i=(r,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return St(this,"_keyboardManager",new ph([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&a(r,bs).contains(o)&&!r.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&a(r,bs).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:t}]]))}destroy(){var e,t,i,s,n;(e=a(this,hi))==null||e.resolve(),v(this,hi,null),(t=a(this,oa))==null||t.abort(),v(this,oa,null),this._signal=null;for(const r of a(this,ue).values())r.destroy();a(this,ue).clear(),a(this,se).clear(),a(this,$n).clear(),v(this,Ge,null),a(this,It).clear(),a(this,li).destroy(),(i=a(this,la))==null||i.destroy(),(s=a(this,Vi))==null||s.hide(),v(this,Vi,null),a(this,qi)&&(clearTimeout(a(this,qi)),v(this,qi,null)),a(this,Xi)&&(clearTimeout(a(this,Xi)),v(this,Xi,null)),(n=this._editorUndoBar)==null||n.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return a(this,Jo)}get useNewAltTextFlow(){return a(this,Yo)}get useNewAltTextWhenAddingImage(){return a(this,da)}get hcmFilter(){return St(this,"hcmFilter",a(this,Gn)?a(this,Ko).addHCMFilter(a(this,Gn).foreground,a(this,Gn).background):"none")}get direction(){return St(this,"direction",getComputedStyle(a(this,bs)).direction)}get highlightColors(){return St(this,"highlightColors",a(this,ua)?new Map(a(this,ua).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return St(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),v(this,Hn,e)}setMainHighlightColorPicker(e){v(this,Qo,e)}editAltText(e,t=!1){var i;(i=a(this,la))==null||i.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":v(this,da,t);break}}onPageChanging({pageNumber:e}){v(this,ca,e-1)}focusMainContainer(){a(this,bs).focus()}findParent(e,t){for(const i of a(this,ue).values()){const{x:s,y:n,width:r,height:o}=i.div.getBoundingClientRect();if(e>=s&&e<=s+r&&t>=n&&t<=n+o)return i}return null}disableUserSelect(e=!1){a(this,il).classList.toggle("noUserSelect",e)}addShouldRescale(e){a(this,$n).add(e)}removeShouldRescale(e){a(this,$n).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*kn.PDF_TO_CSS_UNITS;for(const i of a(this,$n))i.onScaleChanging();(t=a(this,Hn))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=t,o=t.toString(),h=E(this,it,Ph).call(this,t).closest(".textLayer"),c=this.getSelectionBoxes(h);if(!c)return;t.empty();const d=E(this,it,ed).call(this,h),u=a(this,ae)===yt.NONE,p=()=>{d==null||d.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:c,anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r,text:o}),u&&this.showAllEditors("highlight",!0,!0)};if(u){this.switchToMode(yt.HIGHLIGHT,p);return}p()}addToAnnotationStorage(e){!e.isEmpty()&&a(this,gs)&&!a(this,gs).has(e.id)&&a(this,gs).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,a(this,Qs)&&(v(this,Qs,!1),E(this,it,Rh).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of a(this,It))if(t.div.contains(e)){v(this,jn,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!a(this,jn))return;const[e,t]=a(this,jn);v(this,jn,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){E(this,it,id).call(this),E(this,it,sd).call(this)}removeEditListeners(){E(this,it,vf).call(this),E(this,it,nd).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const i of a(this,xi))if(i.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const i of a(this,xi))if(i.isHandlingMimeForPasting(t.type)){i.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var i;if(e.preventDefault(),(i=a(this,Ge))==null||i.commitOrRemove(),!this.hasSelection)return;const t=[];for(const s of a(this,It)){const n=s.serialize(!0);n&&t.push(n)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const n of t.items)for(const r of a(this,xi))if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let i=t.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(n){vt(`paste: "${n.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const n=[];for(const l of i){const h=await s.deserialize(l);if(!h)return;n.push(h)}const r=()=>{for(const l of n)E(this,it,rd).call(this,l);E(this,it,ad).call(this,n)},o=()=>{for(const l of n)l.remove()};this.addCommands({cmd:r,undo:o,mustExec:!0})}catch(n){vt(`paste: "${n.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),a(this,ae)!==yt.NONE&&!this.isEditorHandlingKeyboard&&Jr._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,a(this,Qs)&&(v(this,Qs,!1),E(this,it,Rh).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(E(this,it,bf).call(this),E(this,it,sd).call(this),E(this,it,Te).call(this,{isEditing:a(this,ae)!==yt.NONE,isEmpty:E(this,it,vo).call(this),hasSomethingToUndo:a(this,li).hasSomethingToUndo(),hasSomethingToRedo:a(this,li).hasSomethingToRedo(),hasSelectedEditor:!1})):(E(this,it,yf).call(this),E(this,it,nd).call(this),E(this,it,Te).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!a(this,xi)){v(this,xi,e);for(const t of a(this,xi))E(this,it,ds).call(this,t.defaultPropertiesToUpdate)}}getId(){return a(this,fc).id}get currentLayer(){return a(this,ue).get(a(this,ca))}getLayer(e){return a(this,ue).get(e)}get currentPageIndex(){return a(this,ca)}addLayer(e){a(this,ue).set(e.pageIndex,e),a(this,Js)?e.enable():e.disable()}removeLayer(e){a(this,ue).delete(e.pageIndex)}async updateMode(e,t=null,i=!1){var s;if(a(this,ae)!==e&&!(a(this,hi)&&(await a(this,hi).promise,!a(this,hi)))){if(v(this,hi,Promise.withResolvers()),v(this,ae,e),e===yt.NONE){this.setEditingState(!1),E(this,it,Af).call(this),(s=this._editorUndoBar)==null||s.hide(),a(this,hi).resolve();return}this.setEditingState(!0),await E(this,it,_f).call(this),this.unselectAll();for(const n of a(this,ue).values())n.updateMode(e);if(!t){i&&this.addNewEditorFromKeyboard(),a(this,hi).resolve();return}for(const n of a(this,se).values())n.annotationElementId===t?(this.setSelected(n),n.enterInEditMode()):n.unselect();a(this,hi).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==a(this,ae)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var i;if(a(this,xi)){switch(e){case Et.CREATE:this.currentLayer.addNewEditor();return;case Et.HIGHLIGHT_DEFAULT_COLOR:(i=a(this,Qo))==null||i.updateColor(t);break;case Et.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(a(this,tl)||v(this,tl,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const s of a(this,It))s.updateParams(e,t);for(const s of a(this,xi))s.updateDefaultParams(e,t)}}showAllEditors(e,t,i=!1){var n;for(const r of a(this,se).values())r.editorType===e&&r.show(t);(((n=a(this,tl))==null?void 0:n.get(Et.HIGHLIGHT_SHOW_ALL))??!0)!==t&&E(this,it,ds).call(this,[[Et.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(a(this,Zo)!==e){v(this,Zo,e);for(const t of a(this,ue).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const i of a(this,se).values())i.pageIndex===e&&t.push(i);return t}getEditor(e){return a(this,se).get(e)}addEditor(e){a(this,se).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(a(this,qi)&&clearTimeout(a(this,qi)),v(this,qi,setTimeout(()=>{this.focusMainContainer(),v(this,qi,null)},0))),a(this,se).delete(e.id),this.unselect(e),(!e.annotationElementId||!a(this,Un).has(e.annotationElementId))&&((t=a(this,gs))==null||t.remove(e.id))}addDeletedAnnotationElement(e){a(this,Un).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return a(this,Un).has(e)}removeDeletedAnnotationElement(e){a(this,Un).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){a(this,Ge)!==e&&(v(this,Ge,e),e&&E(this,it,ds).call(this,e.propertiesToUpdate))}updateUI(e){a(this,it,Sf)===e&&E(this,it,ds).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){E(this,it,ds).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(a(this,It).has(e)){a(this,It).delete(e),e.unselect(),E(this,it,Te).call(this,{hasSelectedEditor:this.hasSelection});return}a(this,It).add(e),e.select(),E(this,it,ds).call(this,e.propertiesToUpdate),E(this,it,Te).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=a(this,Hn))==null||t.commitOrRemove();for(const i of a(this,It))i!==e&&i.unselect();a(this,It).clear(),a(this,It).add(e),e.select(),E(this,it,ds).call(this,e.propertiesToUpdate),E(this,it,Te).call(this,{hasSelectedEditor:!0})}isSelected(e){return a(this,It).has(e)}get firstSelectedEditor(){return a(this,It).values().next().value}unselect(e){e.unselect(),a(this,It).delete(e),E(this,it,Te).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return a(this,It).size!==0}get isEnterHandled(){return a(this,It).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;a(this,li).undo(),E(this,it,Te).call(this,{hasSomethingToUndo:a(this,li).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:E(this,it,vo).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){a(this,li).redo(),E(this,it,Te).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:a(this,li).hasSomethingToRedo(),isEmpty:E(this,it,vo).call(this)})}addCommands(e){a(this,li).add(e),E(this,it,Te).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:E(this,it,vo).call(this)})}cleanUndoStack(e){a(this,li).cleanType(e)}delete(){var n;this.commitOrRemove();const e=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...a(this,It)],i=()=>{var r;(r=this._editorUndoBar)==null||r.show(s,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},s=()=>{for(const r of t)E(this,it,rd).call(this,r)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){var e;(e=a(this,Ge))==null||e.commitOrRemove()}hasSomethingToControl(){return a(this,Ge)||this.hasSelection}selectAll(){for(const e of a(this,It))e.commit();E(this,it,ad).call(this,a(this,se).values())}unselectAll(){var e;if(!(a(this,Ge)&&(a(this,Ge).commitOrRemove(),a(this,ae)!==yt.NONE))&&!((e=a(this,Hn))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of a(this,It))t.unselect();a(this,It).clear(),E(this,it,Te).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;a(this,en)[0]+=e,a(this,en)[1]+=t;const[s,n]=a(this,en),r=[...a(this,It)],o=1e3;a(this,Xi)&&clearTimeout(a(this,Xi)),v(this,Xi,setTimeout(()=>{v(this,Xi,null),a(this,en)[0]=a(this,en)[1]=0,this.addCommands({cmd:()=>{for(const l of r)a(this,se).has(l.id)&&l.translateInPage(s,n)},undo:()=>{for(const l of r)a(this,se).has(l.id)&&l.translateInPage(-s,-n)},mustExec:!1})},o));for(const l of r)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),v(this,Wi,new Map);for(const e of a(this,It))a(this,Wi).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!a(this,Wi))return!1;this.disableUserSelect(!1);const e=a(this,Wi);v(this,Wi,null);let t=!1;for(const[{x:s,y:n,pageIndex:r},o]of e)o.newX=s,o.newY=n,o.newPageIndex=r,t||(t=s!==o.savedX||n!==o.savedY||r!==o.savedPageIndex);if(!t)return!1;const i=(s,n,r,o)=>{if(a(this,se).has(s.id)){const l=a(this,ue).get(o);l?s._setParentAndPosition(l,n,r):(s.pageIndex=o,s.x=n,s.y=r)}};return this.addCommands({cmd:()=>{for(const[s,{newX:n,newY:r,newPageIndex:o}]of e)i(s,n,r,o)},undo:()=>{for(const[s,{savedX:n,savedY:r,savedPageIndex:o}]of e)i(s,n,r,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(a(this,Wi))for(const i of a(this,Wi).keys())i.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||a(this,It).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return a(this,Ge)===e}getActive(){return a(this,Ge)}getMode(){return a(this,ae)}get imageManager(){return St(this,"imageManager",new Jc)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,c=t.rangeCount;h<c;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:i,y:s,width:n,height:r}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(h,c,d,u)=>({x:(c-s)/r,y:1-(h+d-i)/n,width:u/r,height:d/n});break;case"180":o=(h,c,d,u)=>({x:1-(h+d-i)/n,y:1-(c+u-s)/r,width:d/n,height:u/r});break;case"270":o=(h,c,d,u)=>({x:1-(c+u-s)/r,y:(h-i)/n,width:u/r,height:d/n});break;default:o=(h,c,d,u)=>({x:(h-i)/n,y:(c-s)/r,width:d/n,height:u/r});break}const l=[];for(let h=0,c=t.rangeCount;h<c;h++){const d=t.getRangeAt(h);if(!d.collapsed)for(const{x:u,y:p,width:m,height:g}of d.getClientRects())m===0||g===0||l.push(o(u,p,m,g))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(a(this,ha)||v(this,ha,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=a(this,ha))==null||t.delete(e)}renderAnnotationElement(e){var s;const t=(s=a(this,ha))==null?void 0:s.get(e.data.id);if(!t)return;const i=a(this,gs).getRawValue(t);i&&(a(this,ae)===yt.NONE&&!i.hasBeenModified||i.renderAnnotationElement(e))}};oa=new WeakMap,Ge=new WeakMap,se=new WeakMap,ue=new WeakMap,la=new WeakMap,gs=new WeakMap,ha=new WeakMap,li=new WeakMap,Ks=new WeakMap,Hn=new WeakMap,ca=new WeakMap,Un=new WeakMap,Wi=new WeakMap,xi=new WeakMap,$n=new WeakMap,Xo=new WeakMap,Yo=new WeakMap,da=new WeakMap,Ko=new WeakMap,qi=new WeakMap,Zs=new WeakMap,ua=new WeakMap,Qs=new WeakMap,Vi=new WeakMap,fc=new WeakMap,Js=new WeakMap,Zo=new WeakMap,tn=new WeakMap,jn=new WeakMap,Qo=new WeakMap,Jo=new WeakMap,ae=new WeakMap,It=new WeakMap,ms=new WeakMap,Gn=new WeakMap,tl=new WeakMap,el=new WeakMap,en=new WeakMap,Xi=new WeakMap,bs=new WeakMap,il=new WeakMap,hi=new WeakMap,it=new WeakSet,Ph=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},ed=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const i of a(this,ue).values())if(i.hasTextLayer(e))return i;return null},pf=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const i=E(this,it,Ph).call(this,e).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(a(this,Vi)||v(this,Vi,new Fg(this)),a(this,Vi).show(i,s,this.direction==="ltr"))},gf=function(){var n,r,o;const e=document.getSelection();if(!e||e.isCollapsed){a(this,ms)&&((n=a(this,Vi))==null||n.hide(),v(this,ms,null),E(this,it,Te).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===a(this,ms))return;const s=E(this,it,Ph).call(this,e).closest(".textLayer");if(!s){a(this,ms)&&((r=a(this,Vi))==null||r.hide(),v(this,ms,null),E(this,it,Te).call(this,{hasSelectedText:!1}));return}if((o=a(this,Vi))==null||o.hide(),v(this,ms,t),E(this,it,Te).call(this,{hasSelectedText:!0}),!(a(this,ae)!==yt.HIGHLIGHT&&a(this,ae)!==yt.NONE)&&(a(this,ae)===yt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),v(this,Qs,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=a(this,ae)===yt.HIGHLIGHT?E(this,it,ed).call(this,s):null;l==null||l.toggleDrawing();const h=new AbortController,c=this.combinedSignal(h),d=u=>{u.type==="pointerup"&&u.button!==0||(h.abort(),l==null||l.toggleDrawing(!0),u.type==="pointerup"&&E(this,it,Rh).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:c}),window.addEventListener("blur",d,{signal:c})}},Rh=function(e=""){a(this,ae)===yt.HIGHLIGHT?this.highlightSelection(e):a(this,Xo)&&E(this,it,pf).call(this)},mf=function(){document.addEventListener("selectionchange",E(this,it,gf).bind(this),{signal:this._signal})},bf=function(){if(a(this,Zs))return;v(this,Zs,new AbortController);const e=this.combinedSignal(a(this,Zs));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},yf=function(){var e;(e=a(this,Zs))==null||e.abort(),v(this,Zs,null)},id=function(){if(a(this,tn))return;v(this,tn,new AbortController);const e=this.combinedSignal(a(this,tn));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},vf=function(){var e;(e=a(this,tn))==null||e.abort(),v(this,tn,null)},sd=function(){if(a(this,Ks))return;v(this,Ks,new AbortController);const e=this.combinedSignal(a(this,Ks));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},nd=function(){var e;(e=a(this,Ks))==null||e.abort(),v(this,Ks,null)},wf=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Te=function(e){Object.entries(e).some(([i,s])=>a(this,el)[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(a(this,el),e)}),a(this,ae)===yt.HIGHLIGHT&&e.hasSelectedEditor===!1&&E(this,it,ds).call(this,[[Et.HIGHLIGHT_FREE,!0]]))},ds=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},_f=async function(){if(!a(this,Js)){v(this,Js,!0);const e=[];for(const t of a(this,ue).values())e.push(t.enable());await Promise.all(e);for(const t of a(this,se).values())t.enable()}},Af=function(){if(this.unselectAll(),a(this,Js)){v(this,Js,!1);for(const e of a(this,ue).values())e.disable();for(const e of a(this,se).values())e.disable()}},rd=function(e){const t=a(this,ue).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},Sf=function(){let e=null;for(e of a(this,It));return e},vo=function(){if(a(this,se).size===0)return!0;if(a(this,se).size===1)for(const e of a(this,se).values())return e.isEmpty();return!1},ad=function(e){for(const t of a(this,It))t.unselect();a(this,It).clear();for(const t of e)t.isEmpty()||(a(this,It).add(t),t.select());E(this,it,Te).call(this,{hasSelectedEditor:this.hasSelection})},ut(Jr,"TRANSLATE_SMALL",1),ut(Jr,"TRANSLATE_BIG",10);let Ur=Jr;var oe,Yi,Ci,fa,Ki,We,pa,Zi,He,ys,Wn,Qi,sn,Ni,wo,Ih;const Pe=class Pe{constructor(e){S(this,Ni);S(this,oe,null);S(this,Yi,!1);S(this,Ci,null);S(this,fa,null);S(this,Ki,null);S(this,We,null);S(this,pa,!1);S(this,Zi,null);S(this,He,null);S(this,ys,null);S(this,Wn,null);S(this,Qi,!1);v(this,He,e),v(this,Qi,e._uiManager.useNewAltTextFlow),a(Pe,sn)||v(Pe,sn,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Pe._l10n??(Pe._l10n=e)}async render(){const e=v(this,Ci,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=v(this,fa,document.createElement("span"));e.append(t),a(this,Qi)?(e.classList.add("new"),e.setAttribute("data-l10n-id",a(Pe,sn).missing),t.setAttribute("data-l10n-id",a(Pe,sn)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=a(this,He)._uiManager._signal;e.addEventListener("contextmenu",Bi,{signal:i}),e.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:i});const s=n=>{n.preventDefault(),a(this,He)._uiManager.editAltText(a(this,He)),a(this,Qi)&&a(this,He)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:a(this,Ni,wo)}})};return e.addEventListener("click",s,{capture:!0,signal:i}),e.addEventListener("keydown",n=>{n.target===e&&n.key==="Enter"&&(v(this,pa,!0),s(n))},{signal:i}),await E(this,Ni,Ih).call(this),e}finish(){a(this,Ci)&&(a(this,Ci).focus({focusVisible:a(this,pa)}),v(this,pa,!1))}isEmpty(){return a(this,Qi)?a(this,oe)===null:!a(this,oe)&&!a(this,Yi)}hasData(){return a(this,Qi)?a(this,oe)!==null||!!a(this,ys):this.isEmpty()}get guessedText(){return a(this,ys)}async setGuessedText(e){a(this,oe)===null&&(v(this,ys,e),v(this,Wn,await Pe._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),E(this,Ni,Ih).call(this))}toggleAltTextBadge(e=!1){var t;if(!a(this,Qi)||a(this,oe)){(t=a(this,Zi))==null||t.remove(),v(this,Zi,null);return}if(!a(this,Zi)){const i=v(this,Zi,document.createElement("div"));i.className="noAltTextBadge",a(this,He).div.append(i)}a(this,Zi).classList.toggle("hidden",!e)}serialize(e){let t=a(this,oe);return!e&&a(this,ys)===t&&(t=a(this,Wn)),{altText:t,decorative:a(this,Yi),guessedText:a(this,ys),textWithDisclaimer:a(this,Wn)}}get data(){return{altText:a(this,oe),decorative:a(this,Yi)}}set data({altText:e,decorative:t,guessedText:i,textWithDisclaimer:s,cancel:n=!1}){i&&(v(this,ys,i),v(this,Wn,s)),!(a(this,oe)===e&&a(this,Yi)===t)&&(n||(v(this,oe,e),v(this,Yi,t)),E(this,Ni,Ih).call(this))}toggle(e=!1){a(this,Ci)&&(!e&&a(this,We)&&(clearTimeout(a(this,We)),v(this,We,null)),a(this,Ci).disabled=!e)}shown(){a(this,He)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:a(this,Ni,wo)}})}destroy(){var e,t;(e=a(this,Ci))==null||e.remove(),v(this,Ci,null),v(this,fa,null),v(this,Ki,null),(t=a(this,Zi))==null||t.remove(),v(this,Zi,null)}};oe=new WeakMap,Yi=new WeakMap,Ci=new WeakMap,fa=new WeakMap,Ki=new WeakMap,We=new WeakMap,pa=new WeakMap,Zi=new WeakMap,He=new WeakMap,ys=new WeakMap,Wn=new WeakMap,Qi=new WeakMap,sn=new WeakMap,Ni=new WeakSet,wo=function(){return a(this,oe)&&"added"||a(this,oe)===null&&this.guessedText&&"review"||"missing"},Ih=async function(){var s,n,r;const e=a(this,Ci);if(!e)return;if(a(this,Qi)){if(e.classList.toggle("done",!!a(this,oe)),e.setAttribute("data-l10n-id",a(Pe,sn)[a(this,Ni,wo)]),(s=a(this,fa))==null||s.setAttribute("data-l10n-id",a(Pe,sn)[`${a(this,Ni,wo)}-label`]),!a(this,oe)){(n=a(this,Ki))==null||n.remove();return}}else{if(!a(this,oe)&&!a(this,Yi)){e.classList.remove("done"),(r=a(this,Ki))==null||r.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=a(this,Ki);if(!t){v(this,Ki,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${a(this,He).id}`;const o=100,l=a(this,He)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(a(this,We)),v(this,We,null)},{once:!0}),e.addEventListener("mouseenter",()=>{v(this,We,setTimeout(()=>{v(this,We,null),a(this,Ki).classList.add("show"),a(this,He)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var h;a(this,We)&&(clearTimeout(a(this,We)),v(this,We,null)),(h=a(this,Ki))==null||h.classList.remove("show")},{signal:l})}a(this,Yi)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=a(this,oe)),t.parentNode||e.append(t);const i=a(this,He).getImageForAltText();i==null||i.setAttribute("aria-describedby",t.id)},S(Pe,sn,null),ut(Pe,"_l10n",null);let sc=Pe;var sl,qn,nl,rl,al,ol,ll,ga,vs,Vn,nn,Gs,Ef,xf,od;const Au=class Au{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:r=null,signal:o}){S(this,Gs);S(this,sl);S(this,qn,!1);S(this,nl,null);S(this,rl);S(this,al);S(this,ol);S(this,ll);S(this,ga);S(this,vs,null);S(this,Vn);S(this,nn,null);v(this,sl,e),v(this,nl,i),v(this,rl,t),v(this,al,s),v(this,ol,n),v(this,ll,r),v(this,Vn,new AbortController),v(this,ga,AbortSignal.any([o,a(this,Vn).signal])),e.addEventListener("touchstart",E(this,Gs,Ef).bind(this),{passive:!1,signal:a(this,ga)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return St(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=a(this,Vn))==null||e.abort(),v(this,Vn,null)}};sl=new WeakMap,qn=new WeakMap,nl=new WeakMap,rl=new WeakMap,al=new WeakMap,ol=new WeakMap,ll=new WeakMap,ga=new WeakMap,vs=new WeakMap,Vn=new WeakMap,nn=new WeakMap,Gs=new WeakSet,Ef=function(e){var s,n,r;if((s=a(this,rl))!=null&&s.call(this)||e.touches.length<2)return;if(!a(this,nn)){v(this,nn,new AbortController);const o=AbortSignal.any([a(this,ga),a(this,nn).signal]),l=a(this,sl),h={signal:o,passive:!1};l.addEventListener("touchmove",E(this,Gs,xf).bind(this),h),l.addEventListener("touchend",E(this,Gs,od).bind(this),h),l.addEventListener("touchcancel",E(this,Gs,od).bind(this),h),(n=a(this,al))==null||n.call(this)}if(ni(e),e.touches.length!==2||(r=a(this,nl))!=null&&r.call(this)){v(this,vs,null);return}let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]),v(this,vs,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:i.screenX,touch1Y:i.screenY})},xf=function(e){var C;if(!a(this,vs)||e.touches.length!==2)return;let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]);const{screenX:s,screenY:n}=t,{screenX:r,screenY:o}=i,l=a(this,vs),{touch0X:h,touch0Y:c,touch1X:d,touch1Y:u}=l,p=d-h,m=u-c,g=r-s,y=o-n,b=Math.hypot(g,y)||1,_=Math.hypot(p,m)||1;if(!a(this,qn)&&Math.abs(_-b)<=Au.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=n,l.touch1X=r,l.touch1Y=o,e.preventDefault(),!a(this,qn)){v(this,qn,!0);return}const x=[(s+r)/2,(n+o)/2];(C=a(this,ol))==null||C.call(this,x,_,b)},od=function(e){var t;a(this,nn).abort(),v(this,nn,null),(t=a(this,ll))==null||t.call(this),a(this,vs)&&(e.preventDefault(),v(this,vs,null),v(this,qn,!1))};let nc=Au;var Xn,ki,Bt,ma,rn,hl,Yn,fe,Kn,ws,an,cl,Zn,qe,dl,Qn,_s,Ji,ba,ya,ci,Jn,ul,pc,ft,ld,fl,hd,Lh,Cf,kf,cd,Mh,dd,Tf,Pf,Rf,ud,If,fd,Lf,Mf,Df,pd,_o;const wt=class wt{constructor(e){S(this,ft);S(this,Xn,null);S(this,ki,null);S(this,Bt,null);S(this,ma,!1);S(this,rn,null);S(this,hl,"");S(this,Yn,!1);S(this,fe,null);S(this,Kn,null);S(this,ws,null);S(this,an,null);S(this,cl,"");S(this,Zn,!1);S(this,qe,null);S(this,dl,!1);S(this,Qn,!1);S(this,_s,!1);S(this,Ji,null);S(this,ba,0);S(this,ya,0);S(this,ci,null);S(this,Jn,null);ut(this,"_editToolbar",null);ut(this,"_initialOptions",Object.create(null));ut(this,"_initialData",null);ut(this,"_isVisible",!0);ut(this,"_uiManager",null);ut(this,"_focusEventsAllowed",!0);S(this,ul,!1);S(this,pc,wt._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,r];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=wt.prototype._resizeWithKeyboard,t=Ur.TRANSLATE_SMALL,i=Ur.TRANSLATE_BIG;return St(this,"_resizerKeyboardManager",new ph([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],wt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return St(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Bg({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(wt._l10n??(wt._l10n=e),wt._l10nResizer||(wt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),wt._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);wt._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Ft("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return a(this,ul)}set _isDraggable(e){var t;v(this,ul,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=a(this,pc)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):E(this,ft,_o).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(a(this,Zn)?v(this,Zn,!1):this.parent.setSelected(this))}focusout(e){var i;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(i=this.parent)!=null&&i.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,s){const[n,r]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(e+i)/n,this.y=(t+s)/r,this.fixAndSetPosition()}translate(e,t){E(this,ft,ld).call(this,this.parentDimensions,e,t)}translateInPage(e,t){a(this,qe)||v(this,qe,[this.x,this.y,this.width,this.height]),E(this,ft,ld).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){a(this,qe)||v(this,qe,[this.x,this.y,this.width,this.height]);const{div:i,parentDimensions:[s,n]}=this;if(this.x+=e/s,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[l,h]=this.getBaseTranslation();r+=l,o+=h;const{style:c}=i;c.left=`${(100*r).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(r,o),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!a(this,qe)&&(a(this,qe)[0]!==this.x||a(this,qe)[1]!==this.y)}get _hasBeenResized(){return!!a(this,qe)&&(a(this,qe)[2]!==this.width||a(this,qe)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:i}=wt,s=i/e,n=i/t;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[i,s]}=this;let{x:n,y:r,width:o,height:l}=this;if(o*=i,l*=s,n*=i,r*=s,this._mustFixPosition)switch(e){case 0:n=Math.max(0,Math.min(i-o,n)),r=Math.max(0,Math.min(s-l,r));break;case 90:n=Math.max(0,Math.min(i-l,n)),r=Math.min(s,Math.max(o,r));break;case 180:n=Math.min(i,Math.max(o,n)),r=Math.min(s,Math.max(l,r));break;case 270:n=Math.min(i,Math.max(l,n)),r=Math.max(0,Math.min(s-o,r));break}this.x=n/=i,this.y=r/=s;const[h,c]=this.getBaseTranslation();n+=h,r+=c,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var i;return E(i=wt,fl,hd).call(i,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var i;return E(i=wt,fl,hd).call(i,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(e,t){const[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*e/i).toFixed(2)}%`,a(this,Yn)||(n.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:i}=e,s=i.endsWith("%"),n=!a(this,Yn)&&t.endsWith("%");if(s&&n)return;const[r,o]=this.parentDimensions;s||(e.width=`${(100*parseFloat(i)/r).toFixed(2)}%`),!a(this,Yn)&&!n&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=a(this,Bt))==null||e.finish()}async addEditToolbar(){return this._editToolbar||a(this,Qn)?this._editToolbar:(this._editToolbar=new Zc(this),this.div.append(this._editToolbar.render()),a(this,Bt)&&await this._editToolbar.addAltText(a(this,Bt)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=a(this,Bt))==null||e.destroy())}addContainer(e){var i;const t=(i=this._editToolbar)==null?void 0:i.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){a(this,Bt)||(sc.initialize(wt._l10n),v(this,Bt,new sc(this)),a(this,Xn)&&(a(this,Bt).data=a(this,Xn),v(this,Xn,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=a(this,Bt))==null?void 0:e.data}set altTextData(e){a(this,Bt)&&(a(this,Bt).data=e)}get guessedAltText(){var e;return(e=a(this,Bt))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=a(this,Bt))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=a(this,Bt))==null?void 0:t.serialize(e)}hasAltText(){return!!a(this,Bt)&&!a(this,Bt).isEmpty()}hasAltTextData(){var e;return((e=a(this,Bt))==null?void 0:e.hasData())??!1}render(){var n;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=a(this,ma)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),E(this,ft,fd).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),ic(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(a(this,Jn)||v(this,Jn,new nc({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:E(this,ft,Tf).bind(this),onPinching:E(this,ft,Pf).bind(this),onPinchEnd:E(this,ft,Rf).bind(this),signal:this._uiManager._signal}))),(n=this._uiManager._editorUndoBar)==null||n.hide(),this.div}pointerdown(e){const{isMac:t}=De.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(v(this,Zn,!0),this._isDraggable){E(this,ft,If).call(this,e);return}E(this,ft,ud).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){a(this,Ji)&&clearTimeout(a(this,Ji)),v(this,Ji,setTimeout(()=>{var e;v(this,Ji,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){const s=this.parentScale,[n,r]=this.pageDimensions,[o,l]=this.pageTranslation,h=e/s,c=t/s,d=this.x*n,u=this.y*r,p=this.width*n,m=this.height*r;switch(i){case 0:return[d+h+o,r-u-c-m+l,d+h+p+o,r-u-c+l];case 90:return[d+c+o,r-u+h+l,d+c+m+o,r-u+h+p+l];case 180:return[d-h-p+o,r-u+c+l,d-h+o,r-u+c+m+l];case 270:return[d-c-m+o,r-u-h-p+l,d-c+o,r-u-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,s,n,r]=e,o=n-i,l=r-s;switch(this.rotation){case 0:return[i,t-r,o,l];case 90:return[i,t-s,l,o];case 180:return[n,t-s,o,l];case 270:return[n,t-r,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){v(this,Qn,!0)}disableEditMode(){v(this,Qn,!1)}isInEditMode(){return a(this,Qn)}shouldGetKeyboardEvents(){return a(this,_s)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return t<r&&s>0&&e<n&&i>0}rebuild(){E(this,ft,fd).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){Ft("An editor must be serializable")}static async deserialize(e,t,i){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});s.rotation=e.rotation,v(s,Xn,e.accessibilityData);const[n,r]=s.pageDimensions,[o,l,h,c]=s.getRectInCurrentCoords(e.rect,r);return s.x=o/n,s.y=l/r,s.width=h/n,s.height=c/r,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=a(this,an))==null||e.abort(),v(this,an,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),a(this,Ji)&&(clearTimeout(a(this,Ji)),v(this,Ji,null)),E(this,ft,_o).call(this),this.removeEditToolbar(),a(this,ci)){for(const i of a(this,ci).values())clearTimeout(i);v(this,ci,null)}this.parent=null,(t=a(this,Jn))==null||t.destroy(),v(this,Jn,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(E(this,ft,Cf).call(this),a(this,fe).classList.remove("hidden"),ic(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),v(this,ws,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=a(this,fe).children;if(!a(this,ki)){v(this,ki,Array.from(t));const r=E(this,ft,Lf).bind(this),o=E(this,ft,Mf).bind(this),l=this._uiManager._signal;for(const h of a(this,ki)){const c=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",r,{signal:l}),h.addEventListener("blur",o,{signal:l}),h.addEventListener("focus",E(this,ft,Df).bind(this,c),{signal:l}),h.setAttribute("data-l10n-id",wt._l10nResizer[c])}}const i=a(this,ki)[0];let s=0;for(const r of t){if(r===i)break;s++}const n=(360-this.rotation+this.parentRotation)%360/90*(a(this,ki).length/4);if(n!==s){if(n<s)for(let o=0;o<s-n;o++)a(this,fe).append(a(this,fe).firstChild);else if(n>s)for(let o=0;o<n-s;o++)a(this,fe).firstChild.before(a(this,fe).lastChild);let r=0;for(const o of t){const h=a(this,ki)[r++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",wt._l10nResizer[h])}}E(this,ft,pd).call(this,0),v(this,_s,!0),a(this,fe).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){a(this,_s)&&E(this,ft,dd).call(this,a(this,cl),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){E(this,ft,_o).call(this),this.div.focus()}select(){var e,t,i;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,n;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(t=this._editToolbar)==null||t.show(),(i=a(this,Bt))==null||i.toggleAltTextBadge(!1)}unselect(){var e,t,i,s,n;(e=a(this,fe))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(i=this.div)!=null&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(n=a(this,Bt))==null||n.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return a(this,dl)}set isEditing(e){v(this,dl,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){v(this,Yn,!0);const i=e/t,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){a(this,ci)||v(this,ci,new Map);const{action:i}=e;let s=a(this,ci).get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),a(this,ci).delete(i),a(this,ci).size===0&&v(this,ci,null)},wt._telemetryTimeout),a(this,ci).set(i,s);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),v(this,ma,!1)}disable(){this.div&&(this.div.tabIndex=-1),v(this,ma,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Xn=new WeakMap,ki=new WeakMap,Bt=new WeakMap,ma=new WeakMap,rn=new WeakMap,hl=new WeakMap,Yn=new WeakMap,fe=new WeakMap,Kn=new WeakMap,ws=new WeakMap,an=new WeakMap,cl=new WeakMap,Zn=new WeakMap,qe=new WeakMap,dl=new WeakMap,Qn=new WeakMap,_s=new WeakMap,Ji=new WeakMap,ba=new WeakMap,ya=new WeakMap,ci=new WeakMap,Jn=new WeakMap,ul=new WeakMap,pc=new WeakMap,ft=new WeakSet,ld=function([e,t],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},fl=new WeakSet,hd=function(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Lh=function(e){switch(e){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}},Cf=function(){if(a(this,fe))return;v(this,fe,document.createElement("div")),a(this,fe).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const i of e){const s=document.createElement("div");a(this,fe).append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",E(this,ft,kf).bind(this,i),{signal:t}),s.addEventListener("contextmenu",Bi,{signal:t}),s.tabIndex=-1}this.div.prepend(a(this,fe))},kf=function(e,t){var c;t.preventDefault();const{isMac:i}=De.platform;if(t.button!==0||t.ctrlKey&&i)return;(c=a(this,Bt))==null||c.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,v(this,Kn,[t.screenX,t.screenY]);const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",E(this,ft,dd).bind(this,e),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",ni,{passive:!1,signal:r}),window.addEventListener("contextmenu",Bi,{signal:r}),v(this,ws,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{var d;n.abort(),this.parent.togglePointerEvents(!0),(d=a(this,Bt))==null||d.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=o,this.div.style.cursor=l,E(this,ft,Mh).call(this)};window.addEventListener("pointerup",h,{signal:r}),window.addEventListener("blur",h,{signal:r})},cd=function(e,t,i,s){this.width=i,this.height=s,this.x=e,this.y=t;const[n,r]=this.parentDimensions;this.setDims(n*i,r*s),this.fixAndSetPosition(),this._onResized()},Mh=function(){if(!a(this,ws))return;const{savedX:e,savedY:t,savedWidth:i,savedHeight:s}=a(this,ws);v(this,ws,null);const n=this.x,r=this.y,o=this.width,l=this.height;n===e&&r===t&&o===i&&l===s||this.addCommands({cmd:E(this,ft,cd).bind(this,n,r,o,l),undo:E(this,ft,cd).bind(this,e,t,i,s),mustExec:!0})},dd=function(e,t){const[i,s]=this.parentDimensions,n=this.x,r=this.y,o=this.width,l=this.height,h=wt.MIN_SIZE/i,c=wt.MIN_SIZE/s,d=E(this,ft,Lh).call(this,this.rotation),u=(V,H)=>[d[0]*V+d[2]*H,d[1]*V+d[3]*H],p=E(this,ft,Lh).call(this,360-this.rotation),m=(V,H)=>[p[0]*V+p[2]*H,p[1]*V+p[3]*H];let g,y,b=!1,_=!1;switch(e){case"topLeft":b=!0,g=(V,H)=>[0,0],y=(V,H)=>[V,H];break;case"topMiddle":g=(V,H)=>[V/2,0],y=(V,H)=>[V/2,H];break;case"topRight":b=!0,g=(V,H)=>[V,0],y=(V,H)=>[0,H];break;case"middleRight":_=!0,g=(V,H)=>[V,H/2],y=(V,H)=>[0,H/2];break;case"bottomRight":b=!0,g=(V,H)=>[V,H],y=(V,H)=>[0,0];break;case"bottomMiddle":g=(V,H)=>[V/2,H],y=(V,H)=>[V/2,0];break;case"bottomLeft":b=!0,g=(V,H)=>[0,H],y=(V,H)=>[V,0];break;case"middleLeft":_=!0,g=(V,H)=>[0,H/2],y=(V,H)=>[V,H/2];break}const x=g(o,l),C=y(o,l);let k=u(...C);const M=wt._round(n+k[0]),L=wt._round(r+k[1]);let N=1,D=1,G,Z;if(t.fromKeyboard)({deltaX:G,deltaY:Z}=t);else{const{screenX:V,screenY:H}=t,[ct,Y]=a(this,Kn);[G,Z]=this.screenToPageTranslation(V-ct,H-Y),a(this,Kn)[0]=V,a(this,Kn)[1]=H}if([G,Z]=m(G/i,Z/s),b){const V=Math.hypot(o,l);N=D=Math.max(Math.min(Math.hypot(C[0]-x[0]-G,C[1]-x[1]-Z)/V,1/o,1/l),h/o,c/l)}else _?N=Math.max(h,Math.min(1,Math.abs(C[0]-x[0]-G)))/o:D=Math.max(c,Math.min(1,Math.abs(C[1]-x[1]-Z)))/l;const R=wt._round(o*N),U=wt._round(l*D);k=u(...y(R,U));const A=M-k[0],j=L-k[1];a(this,qe)||v(this,qe,[this.x,this.y,this.width,this.height]),this.width=R,this.height=U,this.x=A,this.y=j,this.setDims(i*R,s*U),this.fixAndSetPosition(),this._onResizing()},Tf=function(){var e;v(this,ws,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=a(this,Bt))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Pf=function(e,t,i){let n=.7*(i/t)+1-.7;if(n===1)return;const r=E(this,ft,Lh).call(this,this.rotation),o=(M,L)=>[r[0]*M+r[2]*L,r[1]*M+r[3]*L],[l,h]=this.parentDimensions,c=this.x,d=this.y,u=this.width,p=this.height,m=wt.MIN_SIZE/l,g=wt.MIN_SIZE/h;n=Math.max(Math.min(n,1/u,1/p),m/u,g/p);const y=wt._round(u*n),b=wt._round(p*n);if(y===u&&b===p)return;a(this,qe)||v(this,qe,[c,d,u,p]);const _=o(u/2,p/2),x=wt._round(c+_[0]),C=wt._round(d+_[1]),k=o(y/2,b/2);this.x=x-k[0],this.y=C-k[1],this.width=y,this.height=b,this.setDims(l*y,h*b),this.fixAndSetPosition(),this._onResizing()},Rf=function(){var e;(e=a(this,Bt))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),E(this,ft,Mh).call(this)},ud=function(e){const{isMac:t}=De.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},If=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let i=!1;const s=new AbortController,n=this._uiManager.combinedSignal(s),r={capture:!0,passive:!1,signal:n},o=h=>{s.abort(),v(this,rn,null),v(this,Zn,!1),this._uiManager.endDragSession()||E(this,ft,ud).call(this,h),i&&this._onStopDragging()};t&&(v(this,ba,e.clientX),v(this,ya,e.clientY),v(this,rn,e.pointerId),v(this,hl,e.pointerType),window.addEventListener("pointermove",h=>{i||(i=!0,this._onStartDragging());const{clientX:c,clientY:d,pointerId:u}=h;if(u!==a(this,rn)){ni(h);return}const[p,m]=this.screenToPageTranslation(c-a(this,ba),d-a(this,ya));v(this,ba,c),v(this,ya,d),this._uiManager.dragSelectedEditors(p,m)},r),window.addEventListener("touchmove",ni,r),window.addEventListener("pointerdown",h=>{h.pointerType===a(this,hl)&&(a(this,Jn)||h.isPrimary)&&o(h),ni(h)},r));const l=h=>{if(!a(this,rn)||a(this,rn)===h.pointerId){o(h);return}ni(h)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})},fd=function(){if(a(this,an)||!this.div)return;v(this,an,new AbortController);const e=this._uiManager.combinedSignal(a(this,an));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},Lf=function(e){wt._resizerKeyboardManager.exec(this,e)},Mf=function(e){var t;a(this,_s)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==a(this,fe)&&E(this,ft,_o).call(this)},Df=function(e){v(this,cl,a(this,_s)?e:"")},pd=function(e){if(a(this,ki))for(const t of a(this,ki))t.tabIndex=e},_o=function(){v(this,_s,!1),E(this,ft,pd).call(this,-1),E(this,ft,Mh).call(this)},S(wt,fl),ut(wt,"_l10n",null),ut(wt,"_l10nResizer",null),ut(wt,"_borderLineWidth",-1),ut(wt,"_colorManager",new td),ut(wt,"_zIndex",1),ut(wt,"_telemetryTimeout",1e3);let Gt=wt;class Bg extends Gt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Du=3285377520,oi=4294901760,ji=65535;class Ff{constructor(e){this.h1=e?e&4294967295:Du,this.h2=e?e&4294967295:Du}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let g=0,y=e.length;g<y;g++){const b=e.charCodeAt(g);b<=255?t[i++]=b:(t[i++]=b>>>8,t[i++]=b&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,n=i-s*4,r=new Uint32Array(t.buffer,0,s);let o=0,l=0,h=this.h1,c=this.h2;const d=3432918353,u=461845907,p=d&ji,m=u&ji;for(let g=0;g<s;g++)g&1?(o=r[g],o=o*d&oi|o*p&ji,o=o<<15|o>>>17,o=o*u&oi|o*m&ji,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(l=r[g],l=l*d&oi|l*p&ji,l=l<<15|l>>>17,l=l*u&oi|l*m&ji,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,n){case 3:o^=t[s*4+2]<<16;case 2:o^=t[s*4+1]<<8;case 1:o^=t[s*4],o=o*d&oi|o*p&ji,o=o<<15|o>>>17,o=o*u&oi|o*m&ji,s&1?h^=o:c^=o}this.h1=h,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&oi|e*36045&ji,t=t*4283543511&oi|((t<<16|e>>>16)*2950163797&oi)>>>16,e^=t>>>1,e=e*444984403&oi|e*60499&ji,t=t*3301882366&oi|((t<<16|e>>>16)*3120437893&oi)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const gd=Object.freeze({map:null,hash:"",transfer:void 0});var tr,er,le,gc,Of;class gu{constructor(){S(this,gc);S(this,tr,!1);S(this,er,null);S(this,le,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=a(this,le).get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return a(this,le).get(e)}remove(e){if(a(this,le).delete(e),a(this,le).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of a(this,le).values())if(t instanceof Gt)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=a(this,le).get(e);let s=!1;if(i!==void 0)for(const[n,r]of Object.entries(t))i[n]!==r&&(s=!0,i[n]=r);else s=!0,a(this,le).set(e,t);s&&E(this,gc,Of).call(this),t instanceof Gt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return a(this,le).has(e)}getAll(){return a(this,le).size>0?hu(a(this,le)):null}setAll(e){for(const[t,i]of Object.entries(e))this.setValue(t,i)}get size(){return a(this,le).size}resetModified(){a(this,tr)&&(v(this,tr,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Nf(this)}get serializable(){if(a(this,le).size===0)return gd;const e=new Map,t=new Ff,i=[],s=Object.create(null);let n=!1;for(const[r,o]of a(this,le)){const l=o instanceof Gt?o.serialize(!1,s):o;l&&(e.set(r,l),t.update(`${r}:${JSON.stringify(l)}`),n||(n=!!l.bitmap))}if(n)for(const r of e.values())r.bitmap&&i.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:gd}get editorStats(){let e=null;const t=new Map;for(const i of a(this,le).values()){if(!(i instanceof Gt))continue;const s=i.telemetryFinalData;if(!s)continue;const{type:n}=s;t.has(n)||t.set(n,Object.getPrototypeOf(i).constructor),e||(e=Object.create(null));const r=e[n]||(e[n]=new Map);for(const[o,l]of Object.entries(s)){if(o==="type")continue;let h=r.get(o);h||(h=new Map,r.set(o,h));const c=h.get(l)??0;h.set(l,c+1)}}for(const[i,s]of t)e[i]=s.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){v(this,er,null)}get modifiedIds(){if(a(this,er))return a(this,er);const e=[];for(const t of a(this,le).values())!(t instanceof Gt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return v(this,er,{ids:new Set(e),hash:e.join(",")})}}tr=new WeakMap,er=new WeakMap,le=new WeakMap,gc=new WeakSet,Of=function(){a(this,tr)||(v(this,tr,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var pl;class Nf extends gu{constructor(t){super();S(this,pl);const{map:i,hash:s,transfer:n}=t.serializable,r=structuredClone(i,n?{transfer:n}:null);v(this,pl,{map:r,hash:s,transfer:n})}get print(){Ft("Should not call PrintAnnotationStorage.print")}get serializable(){return a(this,pl)}get modifiedIds(){return St(this,"modifiedIds",{ids:new Set,hash:""})}}pl=new WeakMap;var va;class zg{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){S(this,va,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),a(this,va).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||a(this,va).has(e.loadedName))){if(Jt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:s,style:n}=e,r=new FontFace(i,s,n);this.addNativeFontFace(r);try{await r.load(),a(this,va).add(i),t==null||t(e)}catch{vt(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(r)}return}Ft("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw vt(`Failed to load font '${i.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return St(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(Ce||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),St(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(Jt(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const n=i.shift();setTimeout(n.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:t,callback:e};return i.push(s),s}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return St(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(C,k){return C.charCodeAt(k)<<24|C.charCodeAt(k+1)<<16|C.charCodeAt(k+2)<<8|C.charCodeAt(k+3)&255}function s(C,k,M,L){const N=C.substring(0,k),D=C.substring(k+M);return N+L+D}let n,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let h=0;function c(C,k){if(++h>30){vt("Load test font never loaded."),k();return}if(l.font="30px "+C,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){k();return}setTimeout(c.bind(null,C,k))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=s(u,976,d.length,d);const m=16,g=1482184792;let y=i(u,m);for(n=0,r=d.length-3;n<r;n+=4)y=y-g+i(d,n)|0;n<d.length&&(y=y-g+i(d+"XXX",n)|0),u=s(u,m,4,Eg(y));const b=`url(data:font/opentype;base64,${btoa(u)});`,_=`@font-face {font-family:"${d}";src:${b}}`;this.insertRule(_);const x=this._document.createElement("div");x.style.visibility="hidden",x.style.width=x.style.height="10px",x.style.position="absolute",x.style.top=x.style.left="0px";for(const C of[e.loadedName,d]){const k=this._document.createElement("span");k.textContent="Hi",k.style.fontFamily=C,x.append(k)}this._document.body.append(x),c(d,()=>{x.remove(),t.complete()})}}va=new WeakMap;class Hg{constructor(e,{disableFontFace:t=!1,fontExtraProperties:i=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const n in e)this[n]=e[n];this.disableFontFace=t===!0,this.fontExtraProperties=i===!0,this._inspectFont=s}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var i;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Rg(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return(i=this._inspectFont)==null||i.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const i=this.loadedName+"_path_"+t;let s;try{s=e.get(i)}catch(r){vt(`getPathGenerator - ignoring character: "${r}".`)}const n=new Path2D(s||"");return this.fontExtraProperties||e.delete(i),this.compiledGlyphs[t]=n}}const _h={DATA:1,ERROR:2},Qt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Fu(){}function Be(f){if(f instanceof Cn||f instanceof Xc||f instanceof No||f instanceof Iu||f instanceof ec||f instanceof Uc)return f;switch(f instanceof Error||typeof f=="object"&&f!==null||Ft('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),f.name){case"AbortException":return new Cn(f.message);case"InvalidPDFException":return new Xc(f.message);case"MissingPDFException":return new No(f.message);case"PasswordException":return new Iu(f.message,f.code);case"UnexpectedResponseException":return new ec(f.message,f.status);case"UnknownErrorException":return new Uc(f.message,f.details)}return new Uc(f.message,f.toString())}var wa,vi,Bf,zf,Hf,Dh;class Ao{constructor(e,t,i){S(this,vi);S(this,wa,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",E(this,vi,Bf).bind(this),{signal:a(this,wa).signal})}on(e,t){const i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},i)}catch(r){n.reject(r)}return n.promise}sendWithStream(e,t,i,s){const n=this.streamId++,r=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const c=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:o,action:e,streamId:n,data:t,desiredSize:h.desiredSize},s),c.promise},pull:h=>{const c=Promise.withResolvers();return this.streamControllers[n].pullCall=c,l.postMessage({sourceName:r,targetName:o,stream:Qt.PULL,streamId:n,desiredSize:h.desiredSize}),c.promise},cancel:h=>{Jt(h instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[n].cancelCall=c,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:o,stream:Qt.CANCEL,streamId:n,reason:Be(h)}),c.promise}},i)}destroy(){var e;(e=a(this,wa))==null||e.abort(),v(this,wa,null)}}wa=new WeakMap,vi=new WeakSet,Bf=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){E(this,vi,Hf).call(this,e);return}if(e.callback){const i=e.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===_h.DATA)s.resolve(e.data);else if(e.callback===_h.ERROR)s.reject(Be(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const i=this.sourceName,s=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(r){n.postMessage({sourceName:i,targetName:s,callback:_h.DATA,callbackId:e.callbackId,data:r})},function(r){n.postMessage({sourceName:i,targetName:s,callback:_h.ERROR,callbackId:e.callbackId,reason:Be(r)})});return}if(e.streamId){E(this,vi,zf).call(this,e);return}t(e.data)},zf=function(e){const t=e.streamId,i=this.sourceName,s=e.sourceName,n=this.comObj,r=this,o=this.actionHandler[e.action],l={enqueue(h,c=1,d){if(this.isCancelled)return;const u=this.desiredSize;this.desiredSize-=c,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:Qt.ENQUEUE,streamId:t,chunk:h},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Qt.CLOSE,streamId:t}),delete r.streamSinks[t])},error(h){Jt(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Qt.ERROR,streamId:t,reason:Be(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Qt.START_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:Qt.START_COMPLETE,streamId:t,reason:Be(h)})})},Hf=function(e){const t=e.streamId,i=this.sourceName,s=e.sourceName,n=this.comObj,r=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Qt.START_COMPLETE:e.success?r.startCall.resolve():r.startCall.reject(Be(e.reason));break;case Qt.PULL_COMPLETE:e.success?r.pullCall.resolve():r.pullCall.reject(Be(e.reason));break;case Qt.PULL:if(!o){n.postMessage({sourceName:i,targetName:s,stream:Qt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||Fu).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Qt.PULL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:Qt.PULL_COMPLETE,streamId:t,reason:Be(h)})});break;case Qt.ENQUEUE:if(Jt(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case Qt.CLOSE:if(Jt(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),E(this,vi,Dh).call(this,r,t);break;case Qt.ERROR:Jt(r,"error should have stream controller"),r.controller.error(Be(e.reason)),E(this,vi,Dh).call(this,r,t);break;case Qt.CANCEL_COMPLETE:e.success?r.cancelCall.resolve():r.cancelCall.reject(Be(e.reason)),E(this,vi,Dh).call(this,r,t);break;case Qt.CANCEL:if(!o)break;const l=Be(e.reason);Promise.try(o.onCancel||Fu,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Qt.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:Qt.CANCEL_COMPLETE,streamId:t,reason:Be(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Dh=async function(e,t){var i,s,n;await Promise.allSettled([(i=e.startCall)==null?void 0:i.promise,(s=e.pullCall)==null?void 0:s.promise,(n=e.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[t]};var gl;class Uf{constructor({enableHWA:e=!1}){S(this,gl,!1);v(this,gl,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!a(this,gl)})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Ft("Abstract method `_createCanvas` called.")}}gl=new WeakMap;class Ug extends Uf{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}class $f{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Ft("Abstract method `_fetch` called.")}}class jf extends $f{async _fetch(e){const t=await Lc(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Ic(t)}}class Gf{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,s,n){return"none"}destroy(e=!1){}}var ir,_a,As,Ss,Ae,sr,nr,st,ve,So,qr,Fh,Vr,Wf,md,Xr,Eo,xo,bd,Co;class $g extends Gf{constructor({docId:t,ownerDocument:i=globalThis.document}){super();S(this,st);S(this,ir);S(this,_a);S(this,As);S(this,Ss);S(this,Ae);S(this,sr);S(this,nr,0);v(this,Ss,t),v(this,Ae,i)}addFilter(t){if(!t)return"none";let i=a(this,st,ve).get(t);if(i)return i;const[s,n,r]=E(this,st,Fh).call(this,t),o=t.length===1?s:`${s}${n}${r}`;if(i=a(this,st,ve).get(o),i)return a(this,st,ve).set(t,i),i;const l=`g_${a(this,Ss)}_transfer_map_${ke(this,nr)._++}`,h=E(this,st,Vr).call(this,l);a(this,st,ve).set(t,h),a(this,st,ve).set(o,h);const c=E(this,st,Xr).call(this,l);return E(this,st,xo).call(this,s,n,r,c),h}addHCMFilter(t,i){var m;const s=`${t}-${i}`,n="base";let r=a(this,st,So).get(n);if((r==null?void 0:r.key)===s||(r?((m=r.filter)==null||m.remove(),r.key=s,r.url="none",r.filter=null):(r={key:s,url:"none",filter:null},a(this,st,So).set(n,r)),!t||!i))return r.url;const o=E(this,st,Co).call(this,t);t=ht.makeHexColor(...o);const l=E(this,st,Co).call(this,i);if(i=ht.makeHexColor(...l),a(this,st,qr).style.color="",t==="#000000"&&i==="#ffffff"||t===i)return r.url;const h=new Array(256);for(let g=0;g<=255;g++){const y=g/255;h[g]=y<=.03928?y/12.92:((y+.055)/1.055)**2.4}const c=h.join(","),d=`g_${a(this,Ss)}_hcm_filter`,u=r.filter=E(this,st,Xr).call(this,d);E(this,st,xo).call(this,c,c,c,u),E(this,st,md).call(this,u);const p=(g,y)=>{const b=o[g]/255,_=l[g]/255,x=new Array(y+1);for(let C=0;C<=y;C++)x[C]=b+C/y*(_-b);return x.join(",")};return E(this,st,xo).call(this,p(0,5),p(1,5),p(2,5),u),r.url=E(this,st,Vr).call(this,d),r.url}addAlphaFilter(t){let i=a(this,st,ve).get(t);if(i)return i;const[s]=E(this,st,Fh).call(this,[t]),n=`alpha_${s}`;if(i=a(this,st,ve).get(n),i)return a(this,st,ve).set(t,i),i;const r=`g_${a(this,Ss)}_alpha_map_${ke(this,nr)._++}`,o=E(this,st,Vr).call(this,r);a(this,st,ve).set(t,o),a(this,st,ve).set(n,o);const l=E(this,st,Xr).call(this,r);return E(this,st,bd).call(this,s,l),o}addLuminosityFilter(t){let i=a(this,st,ve).get(t||"luminosity");if(i)return i;let s,n;if(t?([s]=E(this,st,Fh).call(this,[t]),n=`luminosity_${s}`):n="luminosity",i=a(this,st,ve).get(n),i)return a(this,st,ve).set(t,i),i;const r=`g_${a(this,Ss)}_luminosity_map_${ke(this,nr)._++}`,o=E(this,st,Vr).call(this,r);a(this,st,ve).set(t,o),a(this,st,ve).set(n,o);const l=E(this,st,Xr).call(this,r);return E(this,st,Wf).call(this,l),t&&E(this,st,bd).call(this,s,l),o}addHighlightHCMFilter(t,i,s,n,r){var _;const o=`${i}-${s}-${n}-${r}`;let l=a(this,st,So).get(t);if((l==null?void 0:l.key)===o||(l?((_=l.filter)==null||_.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},a(this,st,So).set(t,l)),!i||!s))return l.url;const[h,c]=[i,s].map(E(this,st,Co).bind(this));let d=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[p,m]=[n,r].map(E(this,st,Co).bind(this));u<d&&([d,u,p,m]=[u,d,m,p]),a(this,st,qr).style.color="";const g=(x,C,k)=>{const M=new Array(256),L=(u-d)/k,N=x/255,D=(C-x)/(255*k);let G=0;for(let Z=0;Z<=k;Z++){const R=Math.round(d+Z*L),U=N+Z*D;for(let A=G;A<=R;A++)M[A]=U;G=R+1}for(let Z=G;Z<256;Z++)M[Z]=M[G-1];return M.join(",")},y=`g_${a(this,Ss)}_hcm_${t}_filter`,b=l.filter=E(this,st,Xr).call(this,y);return E(this,st,md).call(this,b),E(this,st,xo).call(this,g(p[0],m[0],5),g(p[1],m[1],5),g(p[2],m[2],5),b),l.url=E(this,st,Vr).call(this,y),l.url}destroy(t=!1){var i,s,n,r;t&&((i=a(this,sr))!=null&&i.size)||((s=a(this,As))==null||s.parentNode.parentNode.remove(),v(this,As,null),(n=a(this,_a))==null||n.clear(),v(this,_a,null),(r=a(this,sr))==null||r.clear(),v(this,sr,null),v(this,nr,0))}}ir=new WeakMap,_a=new WeakMap,As=new WeakMap,Ss=new WeakMap,Ae=new WeakMap,sr=new WeakMap,nr=new WeakMap,st=new WeakSet,ve=function(){return a(this,_a)||v(this,_a,new Map)},So=function(){return a(this,sr)||v(this,sr,new Map)},qr=function(){if(!a(this,As)){const t=a(this,Ae).createElement("div"),{style:i}=t;i.visibility="hidden",i.contain="strict",i.width=i.height=0,i.position="absolute",i.top=i.left=0,i.zIndex=-1;const s=a(this,Ae).createElementNS(cs,"svg");s.setAttribute("width",0),s.setAttribute("height",0),v(this,As,a(this,Ae).createElementNS(cs,"defs")),t.append(s),s.append(a(this,As)),a(this,Ae).body.append(t)}return a(this,As)},Fh=function(t){if(t.length===1){const h=t[0],c=new Array(256);for(let u=0;u<256;u++)c[u]=h[u]/255;const d=c.join(",");return[d,d,d]}const[i,s,n]=t,r=new Array(256),o=new Array(256),l=new Array(256);for(let h=0;h<256;h++)r[h]=i[h]/255,o[h]=s[h]/255,l[h]=n[h]/255;return[r.join(","),o.join(","),l.join(",")]},Vr=function(t){if(a(this,ir)===void 0){v(this,ir,"");const i=a(this,Ae).URL;i!==a(this,Ae).baseURI&&(Mc(i)?vt('#createUrl: ignore "data:"-URL for performance reasons.'):v(this,ir,i.split("#",1)[0]))}return`url(${a(this,ir)}#${t})`},Wf=function(t){const i=a(this,Ae).createElementNS(cs,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(i)},md=function(t){const i=a(this,Ae).createElementNS(cs,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(i)},Xr=function(t){const i=a(this,Ae).createElementNS(cs,"filter");return i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("id",t),a(this,st,qr).append(i),i},Eo=function(t,i,s){const n=a(this,Ae).createElementNS(cs,i);n.setAttribute("type","discrete"),n.setAttribute("tableValues",s),t.append(n)},xo=function(t,i,s,n){const r=a(this,Ae).createElementNS(cs,"feComponentTransfer");n.append(r),E(this,st,Eo).call(this,r,"feFuncR",t),E(this,st,Eo).call(this,r,"feFuncG",i),E(this,st,Eo).call(this,r,"feFuncB",s)},bd=function(t,i){const s=a(this,Ae).createElementNS(cs,"feComponentTransfer");i.append(s),E(this,st,Eo).call(this,s,"feFuncA",t)},Co=function(t){return a(this,st,qr).style.color=t,pu(getComputedStyle(a(this,st,qr)).getPropertyValue("color"))};class qf{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Ft("Abstract method `_fetch` called.")}}class Vf extends qf{async _fetch(e){const t=await Lc(e,"arraybuffer");return new Uint8Array(t)}}Ce&&vt("Please use the `legacy` build in Node.js environments.");async function Xf(f){const t=await process.getBuiltinModule("fs").promises.readFile(f);return new Uint8Array(t)}class jg extends Gf{}class Gg extends Uf{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Wg extends $f{async _fetch(e){return Xf(e)}}class qg extends qf{async _fetch(e){return Xf(e)}}const xe={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function yd(f,e){if(!e)return;const t=e[2]-e[0],i=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,i),f.clip(s)}class mu{getPattern(){Ft("Abstract method `getPattern` called.")}}class Vg extends mu{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,s){let n;if(s===xe.STROKE||s===xe.FILL){const r=t.current.getClippedPathBoundingBox(s,Ht(e))||[0,0,0,0],o=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,h=t.cachedCanvases.getCanvas("pattern",o,l),c=h.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-r[0],-r[1]),i=ht.transform(i,[1,0,0,1,r[0],r[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),yd(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),n=e.createPattern(h.canvas,"no-repeat");const d=new DOMMatrix(i);n.setTransform(d)}else yd(e,this._bbox),n=this._createGradient(e);return n}}function Gc(f,e,t,i,s,n,r,o){const l=e.coords,h=e.colors,c=f.data,d=f.width*4;let u;l[t+1]>l[i+1]&&(u=t,t=i,i=u,u=n,n=r,r=u),l[i+1]>l[s+1]&&(u=i,i=s,s=u,u=r,r=o,o=u),l[t+1]>l[i+1]&&(u=t,t=i,i=u,u=n,n=r,r=u);const p=(l[t]+e.offsetX)*e.scaleX,m=(l[t+1]+e.offsetY)*e.scaleY,g=(l[i]+e.offsetX)*e.scaleX,y=(l[i+1]+e.offsetY)*e.scaleY,b=(l[s]+e.offsetX)*e.scaleX,_=(l[s+1]+e.offsetY)*e.scaleY;if(m>=_)return;const x=h[n],C=h[n+1],k=h[n+2],M=h[r],L=h[r+1],N=h[r+2],D=h[o],G=h[o+1],Z=h[o+2],R=Math.round(m),U=Math.round(_);let A,j,V,H,ct,Y,ot,B;for(let O=R;O<=U;O++){if(O<y){const mt=O<m?0:(m-O)/(m-y);A=p-(p-g)*mt,j=x-(x-M)*mt,V=C-(C-L)*mt,H=k-(k-N)*mt}else{let mt;O>_?mt=1:y===_?mt=0:mt=(y-O)/(y-_),A=g-(g-b)*mt,j=M-(M-D)*mt,V=L-(L-G)*mt,H=N-(N-Z)*mt}let W;O<m?W=0:O>_?W=1:W=(m-O)/(m-_),ct=p-(p-b)*W,Y=x-(x-D)*W,ot=C-(C-G)*W,B=k-(k-Z)*W;const K=Math.round(Math.min(A,ct)),J=Math.round(Math.max(A,ct));let _t=d*O+K*4;for(let mt=K;mt<=J;mt++)W=(A-mt)/(A-ct),W<0?W=0:W>1&&(W=1),c[_t++]=j-(j-Y)*W|0,c[_t++]=V-(V-ot)*W|0,c[_t++]=H-(H-B)*W|0,c[_t++]=255}}function Xg(f,e,t){const i=e.coords,s=e.colors;let n,r;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(i.length/o)-1,h=o-1;for(n=0;n<l;n++){let c=n*o;for(let d=0;d<h;d++,c++)Gc(f,t,i[c],i[c+1],i[c+o],s[c],s[c+1],s[c+o]),Gc(f,t,i[c+o+1],i[c+1],i[c+o],s[c+o+1],s[c+1],s[c+o])}break;case"triangles":for(n=0,r=i.length;n<r;n+=3)Gc(f,t,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}class Yg extends mu{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,i){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(c*e[1]*1.1)),3e3),p=h/d,m=c/u,g={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/p,scaleY:1/m},y=d+4,b=u+4,_=i.getCanvas("mesh",y,b),x=_.context,C=x.createImageData(d,u);if(t){const M=C.data;for(let L=0,N=M.length;L<N;L+=4)M[L]=t[0],M[L+1]=t[1],M[L+2]=t[2],M[L+3]=255}for(const M of this._figures)Xg(C,M,g);return x.putImageData(C,2,2),{canvas:_.canvas,offsetX:o-2*p,offsetY:l-2*m,scaleX:p,scaleY:m}}getPattern(e,t,i,s){yd(e,this._bbox);let n;if(s===xe.SHADING)n=ht.singularValueDecompose2dScale(Ht(e));else if(n=ht.singularValueDecompose2dScale(t.baseTransform),this.matrix){const o=ht.singularValueDecompose2dScale(this.matrix);n=[n[0]*o[0],n[1]*o[1]]}const r=this._createMeshCanvas(n,s===xe.SHADING?null:this._background,t.cachedCanvases);return s!==xe.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}}class Kg extends mu{getPattern(){return"hotpink"}}function Zg(f){switch(f[0]){case"RadialAxial":return new Vg(f);case"Mesh":return new Yg(f);case"Dummy":return new Kg}throw new Error(`Unknown IR type: ${f[0]}`)}const Ou={COLORED:1,UNCOLORED:2},mc=class mc{constructor(e,t,i,s,n){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=i,this.canvasGraphicsFactory=s,this.baseTransform=n}createPatternCanvas(e){const{bbox:t,operatorList:i,paintType:s,tilingType:n,color:r,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:h}=this;l=Math.abs(l),h=Math.abs(h),Rc("TilingType: "+n);const c=t[0],d=t[1],u=t[2],p=t[3],m=u-c,g=p-d,y=ht.singularValueDecompose2dScale(this.matrix),b=ht.singularValueDecompose2dScale(this.baseTransform),_=y[0]*b[0],x=y[1]*b[1];let C=m,k=g,M=!1,L=!1;const N=Math.ceil(l*_),D=Math.ceil(h*x),G=Math.ceil(m*_),Z=Math.ceil(g*x);N>=G?C=l:M=!0,D>=Z?k=h:L=!0;const R=this.getSizeAndScale(C,this.ctx.canvas.width,_),U=this.getSizeAndScale(k,this.ctx.canvas.height,x),A=e.cachedCanvases.getCanvas("pattern",R.size,U.size),j=A.context,V=o.createCanvasGraphics(j);if(V.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(V,s,r),j.translate(-R.scale*c,-U.scale*d),V.transform(R.scale,0,0,U.scale,0,0),j.save(),this.clipBbox(V,c,d,u,p),V.baseTransform=Ht(V.ctx),V.executeOperatorList(i),V.endDrawing(),j.restore(),M||L){const H=A.canvas;M&&(C=l),L&&(k=h);const ct=this.getSizeAndScale(C,this.ctx.canvas.width,_),Y=this.getSizeAndScale(k,this.ctx.canvas.height,x),ot=ct.size,B=Y.size,O=e.cachedCanvases.getCanvas("pattern-workaround",ot,B),W=O.context,K=M?Math.floor(m/l):0,J=L?Math.floor(g/h):0;for(let _t=0;_t<=K;_t++)for(let mt=0;mt<=J;mt++)W.drawImage(H,ot*_t,B*mt,ot,B,0,0,ot,B);return{canvas:O.canvas,scaleX:ct.scale,scaleY:Y.scale,offsetX:c,offsetY:d}}return{canvas:A.canvas,scaleX:R.scale,scaleY:U.scale,offsetX:c,offsetY:d}}getSizeAndScale(e,t,i){const s=Math.max(mc.MAX_PATTERN_SIZE,t);let n=Math.ceil(e*i);return n>=s?n=s:i=n/e,{scale:i,size:n}}clipBbox(e,t,i,s,n){const r=s-t,o=n-i;e.ctx.rect(t,i,r,o),e.current.updateRectMinMax(Ht(e.ctx),[t,i,s,n]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,i){const s=e.ctx,n=e.current;switch(t){case Ou.COLORED:const r=this.ctx;s.fillStyle=r.fillStyle,s.strokeStyle=r.strokeStyle,n.fillColor=r.fillStyle,n.strokeColor=r.strokeStyle;break;case Ou.UNCOLORED:const o=ht.makeHexColor(i[0],i[1],i[2]);s.fillStyle=o,s.strokeStyle=o,n.fillColor=o,n.strokeColor=o;break;default:throw new Sg(`Unsupported paint type: ${t}`)}}getPattern(e,t,i,s){let n=i;s!==xe.SHADING&&(n=ht.transform(n,t.baseTransform),this.matrix&&(n=ht.transform(n,this.matrix)));const r=this.createPatternCanvas(t);let o=new DOMMatrix(n);o=o.translate(r.offsetX,r.offsetY),o=o.scale(1/r.scaleX,1/r.scaleY);const l=e.createPattern(r.canvas,"repeat");return l.setTransform(o),l}};ut(mc,"MAX_PATTERN_SIZE",3e3);let vd=mc;function Qg({src:f,srcPos:e=0,dest:t,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const o=De.isLittleEndian?4278190080:255,[l,h]=r?[n,o]:[o,n],c=i>>3,d=i&7,u=f.length;t=new Uint32Array(t.buffer);let p=0;for(let m=0;m<s;m++){for(const y=e+c;e<y;e++){const b=e<u?f[e]:255;t[p++]=b&128?h:l,t[p++]=b&64?h:l,t[p++]=b&32?h:l,t[p++]=b&16?h:l,t[p++]=b&8?h:l,t[p++]=b&4?h:l,t[p++]=b&2?h:l,t[p++]=b&1?h:l}if(d===0)continue;const g=e<u?f[e++]:255;for(let y=0;y<d;y++)t[p++]=g&1<<7-y?h:l}return{srcPos:e,destPos:p}}const Nu=16,Bu=100,Jg=15,zu=10,Hu=1e3,je=16;function tm(f,e){if(f._removeMirroring)throw new Error("Context is already forwarding operations.");f.__originalSave=f.save,f.__originalRestore=f.restore,f.__originalRotate=f.rotate,f.__originalScale=f.scale,f.__originalTranslate=f.translate,f.__originalTransform=f.transform,f.__originalSetTransform=f.setTransform,f.__originalResetTransform=f.resetTransform,f.__originalClip=f.clip,f.__originalMoveTo=f.moveTo,f.__originalLineTo=f.lineTo,f.__originalBezierCurveTo=f.bezierCurveTo,f.__originalRect=f.rect,f.__originalClosePath=f.closePath,f.__originalBeginPath=f.beginPath,f._removeMirroring=()=>{f.save=f.__originalSave,f.restore=f.__originalRestore,f.rotate=f.__originalRotate,f.scale=f.__originalScale,f.translate=f.__originalTranslate,f.transform=f.__originalTransform,f.setTransform=f.__originalSetTransform,f.resetTransform=f.__originalResetTransform,f.clip=f.__originalClip,f.moveTo=f.__originalMoveTo,f.lineTo=f.__originalLineTo,f.bezierCurveTo=f.__originalBezierCurveTo,f.rect=f.__originalRect,f.closePath=f.__originalClosePath,f.beginPath=f.__originalBeginPath,delete f._removeMirroring},f.save=function(){e.save(),this.__originalSave()},f.restore=function(){e.restore(),this.__originalRestore()},f.translate=function(i,s){e.translate(i,s),this.__originalTranslate(i,s)},f.scale=function(i,s){e.scale(i,s),this.__originalScale(i,s)},f.transform=function(i,s,n,r,o,l){e.transform(i,s,n,r,o,l),this.__originalTransform(i,s,n,r,o,l)},f.setTransform=function(i,s,n,r,o,l){e.setTransform(i,s,n,r,o,l),this.__originalSetTransform(i,s,n,r,o,l)},f.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},f.rotate=function(i){e.rotate(i),this.__originalRotate(i)},f.clip=function(i){e.clip(i),this.__originalClip(i)},f.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},f.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},f.bezierCurveTo=function(t,i,s,n,r,o){e.bezierCurveTo(t,i,s,n,r,o),this.__originalBezierCurveTo(t,i,s,n,r,o)},f.rect=function(t,i,s,n){e.rect(t,i,s,n),this.__originalRect(t,i,s,n)},f.closePath=function(){e.closePath(),this.__originalClosePath()},f.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class em{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,i)):(s=this.canvasFactory.create(t,i),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Ah(f,e,t,i,s,n,r,o,l,h){const[c,d,u,p,m,g]=Ht(f);if(d===0&&u===0){const _=r*c+m,x=Math.round(_),C=o*p+g,k=Math.round(C),M=(r+l)*c+m,L=Math.abs(Math.round(M)-x)||1,N=(o+h)*p+g,D=Math.abs(Math.round(N)-k)||1;return f.setTransform(Math.sign(c),0,0,Math.sign(p),x,k),f.drawImage(e,t,i,s,n,0,0,L,D),f.setTransform(c,d,u,p,m,g),[L,D]}if(c===0&&p===0){const _=o*u+m,x=Math.round(_),C=r*d+g,k=Math.round(C),M=(o+h)*u+m,L=Math.abs(Math.round(M)-x)||1,N=(r+l)*d+g,D=Math.abs(Math.round(N)-k)||1;return f.setTransform(0,Math.sign(d),Math.sign(u),0,x,k),f.drawImage(e,t,i,s,n,0,0,D,L),f.setTransform(c,d,u,p,m,g),[D,L]}f.drawImage(e,t,i,s,n,r,o,l,h);const y=Math.hypot(c,d),b=Math.hypot(u,p);return[y*l,b*h]}function im(f){const{width:e,height:t}=f;if(e>Hu||t>Hu)return null;const i=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=e+1;let r=new Uint8Array(n*(t+1)),o,l,h;const c=e+7&-8;let d=new Uint8Array(c*t),u=0;for(const b of f.data){let _=128;for(;_>0;)d[u++]=b&_?0:255,_>>=1}let p=0;for(u=0,d[u]!==0&&(r[0]=1,++p),l=1;l<e;l++)d[u]!==d[u+1]&&(r[l]=d[u]?2:1,++p),u++;for(d[u]!==0&&(r[l]=2,++p),o=1;o<t;o++){u=o*c,h=o*n,d[u-c]!==d[u]&&(r[h]=d[u]?1:8,++p);let b=(d[u]?4:0)+(d[u-c]?8:0);for(l=1;l<e;l++)b=(b>>2)+(d[u+1]?4:0)+(d[u-c+1]?8:0),s[b]&&(r[h+l]=s[b],++p),u++;if(d[u-c]!==d[u]&&(r[h+l]=d[u]?2:4,++p),p>i)return null}for(u=c*(t-1),h=o*n,d[u]!==0&&(r[h]=8,++p),l=1;l<e;l++)d[u]!==d[u+1]&&(r[h+l]=d[u]?4:8,++p),u++;if(d[u]!==0&&(r[h+l]=4,++p),p>i)return null;const m=new Int32Array([0,n,-1,0,-n,0,0,0,1]),g=new Path2D;for(o=0;p&&o<=t;o++){let b=o*n;const _=b+e;for(;b<_&&!r[b];)b++;if(b===_)continue;g.moveTo(b%n,o);const x=b;let C=r[b];do{const k=m[C];do b+=k;while(!r[b]);const M=r[b];M!==5&&M!==10?(C=M,r[b]=0):(C=M&51*C>>4,r[b]&=C>>2|C<<2),g.lineTo(b%n,b/n|0),r[b]||--p}while(x!==b);--o}return d=null,r=null,function(b){b.save(),b.scale(1/e,-1/t),b.translate(0,-t),b.fill(g),b.beginPath(),b.restore()}}class Uu{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=nf,this.textMatrixScale=1,this.fontMatrix=Vc,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ye.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,i){[t,i]=ht.applyTransform([t,i],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(e,t){const i=ht.applyTransform(t,e),s=ht.applyTransform(t.slice(2),e),n=ht.applyTransform([t[0],t[3]],e),r=ht.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,i[0],s[0],n[0],r[0]),this.minY=Math.min(this.minY,i[1],s[1],n[1],r[1]),this.maxX=Math.max(this.maxX,i[0],s[0],n[0],r[0]),this.maxY=Math.max(this.maxY,i[1],s[1],n[1],r[1])}updateScalingPathMinMax(e,t){ht.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,i,s,n,r,o,l,h,c){const d=ht.bezierBoundingBox(t,i,s,n,r,o,l,h,c);c||this.updateRectMinMax(e,d)}getPathBoundingBox(e=xe.FILL,t=null){const i=[this.minX,this.minY,this.maxX,this.maxY];if(e===xe.STROKE){t||Ft("Stroke bounding box must include transform.");const s=ht.singularValueDecompose2dScale(t),n=s[0]*this.lineWidth/2,r=s[1]*this.lineWidth/2;i[0]-=n,i[1]-=r,i[2]+=n,i[3]+=r}return i}updateClipFromPath(){const e=ht.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=xe.FILL,t=null){return ht.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function $u(f,e){if(e instanceof ImageData){f.putImageData(e,0,0);return}const t=e.height,i=e.width,s=t%je,n=(t-s)/je,r=s===0?n:n+1,o=f.createImageData(i,je);let l=0,h;const c=e.data,d=o.data;let u,p,m,g;if(e.kind===xh.GRAYSCALE_1BPP){const y=c.byteLength,b=new Uint32Array(d.buffer,0,d.byteLength>>2),_=b.length,x=i+7>>3,C=4294967295,k=De.isLittleEndian?4278190080:255;for(u=0;u<r;u++){for(m=u<n?je:s,h=0,p=0;p<m;p++){const M=y-l;let L=0;const N=M>x?i:M*8-7,D=N&-8;let G=0,Z=0;for(;L<D;L+=8)Z=c[l++],b[h++]=Z&128?C:k,b[h++]=Z&64?C:k,b[h++]=Z&32?C:k,b[h++]=Z&16?C:k,b[h++]=Z&8?C:k,b[h++]=Z&4?C:k,b[h++]=Z&2?C:k,b[h++]=Z&1?C:k;for(;L<N;L++)G===0&&(Z=c[l++],G=128),b[h++]=Z&G?C:k,G>>=1}for(;h<_;)b[h++]=0;f.putImageData(o,0,u*je)}}else if(e.kind===xh.RGBA_32BPP){for(p=0,g=i*je*4,u=0;u<n;u++)d.set(c.subarray(l,l+g)),l+=g,f.putImageData(o,0,p),p+=je;u<r&&(g=i*s*4,d.set(c.subarray(l,l+g)),f.putImageData(o,0,p))}else if(e.kind===xh.RGB_24BPP)for(m=je,g=i*m,u=0;u<r;u++){for(u>=n&&(m=s,g=i*m),h=0,p=g;p--;)d[h++]=c[l++],d[h++]=c[l++],d[h++]=c[l++],d[h++]=255;f.putImageData(o,0,u*je)}else throw new Error(`bad image kind: ${e.kind}`)}function ju(f,e){if(e.bitmap){f.drawImage(e.bitmap,0,0);return}const t=e.height,i=e.width,s=t%je,n=(t-s)/je,r=s===0?n:n+1,o=f.createImageData(i,je);let l=0;const h=e.data,c=o.data;for(let d=0;d<r;d++){const u=d<n?je:s;({srcPos:l}=Qg({src:h,srcPos:l,dest:c,width:i,height:u,nonBlackColor:0})),f.putImageData(o,0,d*je)}}function go(f,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)f[i]!==void 0&&(e[i]=f[i]);f.setLineDash!==void 0&&(e.setLineDash(f.getLineDash()),e.lineDashOffset=f.lineDashOffset)}function Sh(f){if(f.strokeStyle=f.fillStyle="#000000",f.fillRule="nonzero",f.globalAlpha=1,f.lineWidth=1,f.lineCap="butt",f.lineJoin="miter",f.miterLimit=10,f.globalCompositeOperation="source-over",f.font="10px sans-serif",f.setLineDash!==void 0&&(f.setLineDash([]),f.lineDashOffset=0),!Ce){const{filter:e}=f;e!=="none"&&e!==""&&(f.filter="none")}}function Gu(f,e){if(e)return!0;const t=ht.singularValueDecompose2dScale(f);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*kn.PDF_TO_CSS_UNITS);return t[0]<=i&&t[1]<=i}const sm=["butt","round","square"],nm=["miter","round","bevel"],rm={},Wu={};var zi,wd,_d,Ad;const Su=class Su{constructor(e,t,i,s,n,{optionalContentConfig:r,markedContentStack:o=null},l,h){S(this,zi);this.ctx=e,this.current=new Uu(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=r,this.cachedCanvases=new em(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:s=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=o,i){const l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Ht(this.compositeCtx))}this.ctx.save(),Sh(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Ht(this.ctx)}executeOperatorList(e,t,i,s){const n=e.argsArray,r=e.fnArray;let o=t||0;const l=n.length;if(l===o)return o;const h=l-o>zu&&typeof i=="function",c=h?Date.now()+Jg:0;let d=0;const u=this.commonObjs,p=this.objs;let m;for(;;){if(s!==void 0&&o===s.nextBreakPoint)return s.breakIt(o,i),o;if(m=r[o],m!==Si.dependency)this[m].apply(this,n[o]);else for(const g of n[o]){const y=g.startsWith("g_")?u:p;if(!y.has(g))return y.get(g,i),o}if(o++,o===l)return o;if(h&&++d>zu){if(Date.now()>c)return i(),o;d=0}}}endDrawing(){E(this,zi,wd).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),E(this,zi,_d).call(this)}_scaleImage(e,t){const i=e.width??e.displayWidth,s=e.height??e.displayHeight;let n=Math.max(Math.hypot(t[0],t[1]),1),r=Math.max(Math.hypot(t[2],t[3]),1),o=i,l=s,h="prescale1",c,d;for(;n>2&&o>1||r>2&&l>1;){let u=o,p=l;n>2&&o>1&&(u=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/u),r>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/p),c=this.cachedCanvases.getCanvas(h,u,p),d=c.context,d.clearRect(0,0,u,p),d.drawImage(e,0,0,o,l,0,0,u,p),e=c.canvas,o=u,l=p,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:i,height:s}=e,n=this.current.fillColor,r=this.current.patternFill,o=Ht(t);let l,h,c,d;if((e.bitmap||e.data)&&e.count>1){const N=e.bitmap||e.data.buffer;h=JSON.stringify(r?o:[o.slice(0,4),n]),l=this._cachedBitmapsMap.get(N),l||(l=new Map,this._cachedBitmapsMap.set(N,l));const D=l.get(h);if(D&&!r){const G=Math.round(Math.min(o[0],o[2])+o[4]),Z=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:D,offsetX:G,offsetY:Z}}c=D}c||(d=this.cachedCanvases.getCanvas("maskCanvas",i,s),ju(d.context,e));let u=ht.transform(o,[1/i,0,0,-1/s,0,0]);u=ht.transform(u,[1,0,0,1,0,-s]);const[p,m,g,y]=ht.getAxialAlignedBoundingBox([0,0,i,s],u),b=Math.round(g-p)||1,_=Math.round(y-m)||1,x=this.cachedCanvases.getCanvas("fillCanvas",b,_),C=x.context,k=p,M=m;C.translate(-k,-M),C.transform(...u),c||(c=this._scaleImage(d.canvas,$i(C)),c=c.img,l&&r&&l.set(h,c)),C.imageSmoothingEnabled=Gu(Ht(C),e.interpolate),Ah(C,c,0,0,c.width,c.height,0,0,i,s),C.globalCompositeOperation="source-in";const L=ht.transform($i(C),[1,0,0,1,-k,-M]);return C.fillStyle=r?n.getPattern(t,this,L,xe.FILL):n,C.fillRect(0,0,i,s),l&&!r&&(this.cachedCanvases.delete("fillCanvas"),l.set(h,x.canvas)),{canvas:x.canvas,offsetX:Math.round(k),offsetY:Math.round(M)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=sm[e]}setLineJoin(e){this.ctx.lineJoin=nm[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;const n=this.ctx;n.setTransform(...Ht(this.suspendedCtx)),go(this.suspendedCtx,n),tm(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),go(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,s){const n=s[0],r=s[1],o=s[2]-n,l=s[3]-r;o===0||l===0||(this.genericComposeSMask(t.context,i,o,l,t.subtype,t.backdrop,t.transferMap,n,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,s,n,r,o,l,h,c,d){let u=e.canvas,p=l-c,m=h-d;if(r){const y=ht.makeHexColor(...r);if(p<0||m<0||p+i>u.width||m+s>u.height){const b=this.cachedCanvases.getCanvas("maskExtension",i,s),_=b.context;_.drawImage(u,-p,-m),_.globalCompositeOperation="destination-atop",_.fillStyle=y,_.fillRect(0,0,i,s),_.globalCompositeOperation="source-over",u=b.canvas,p=m=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(p,m,i,s),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=y,e.fillRect(p,m,i,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const g=new Path2D;g.rect(l,h,i,s),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(u,p,m,i,s,l,h,i,s),t.restore()}save(){this.inSMaskMode?(go(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),go(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,i,s,n,r){this.ctx.transform(e,t,i,s,n,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){const s=this.ctx,n=this.current;let r=n.x,o=n.y,l,h;const c=Ht(s),d=c[0]===0&&c[3]===0||c[1]===0&&c[2]===0,u=d?i.slice(0):null;for(let p=0,m=0,g=e.length;p<g;p++)switch(e[p]|0){case Si.rectangle:r=t[m++],o=t[m++];const y=t[m++],b=t[m++],_=r+y,x=o+b;s.moveTo(r,o),y===0||b===0?s.lineTo(_,x):(s.lineTo(_,o),s.lineTo(_,x),s.lineTo(r,x)),d||n.updateRectMinMax(c,[r,o,_,x]),s.closePath();break;case Si.moveTo:r=t[m++],o=t[m++],s.moveTo(r,o),d||n.updatePathMinMax(c,r,o);break;case Si.lineTo:r=t[m++],o=t[m++],s.lineTo(r,o),d||n.updatePathMinMax(c,r,o);break;case Si.curveTo:l=r,h=o,r=t[m+4],o=t[m+5],s.bezierCurveTo(t[m],t[m+1],t[m+2],t[m+3],r,o),n.updateCurvePathMinMax(c,l,h,t[m],t[m+1],t[m+2],t[m+3],r,o,u),m+=6;break;case Si.curveTo2:l=r,h=o,s.bezierCurveTo(r,o,t[m],t[m+1],t[m+2],t[m+3]),n.updateCurvePathMinMax(c,l,h,r,o,t[m],t[m+1],t[m+2],t[m+3],u),r=t[m+2],o=t[m+3],m+=4;break;case Si.curveTo3:l=r,h=o,r=t[m+2],o=t[m+3],s.bezierCurveTo(t[m],t[m+1],r,o,r,o),n.updateCurvePathMinMax(c,l,h,t[m],t[m+1],r,o,r,o,u),m+=4;break;case Si.closePath:s.closePath();break}d&&n.updateScalingPathMinMax(c,u),n.setCurrentPoint(r,o)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,i=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&(i!=null&&i.getPattern)?(t.save(),t.strokeStyle=i.getPattern(t,this,$i(t),xe.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,i=this.current.fillColor,s=this.current.patternFill;let n=!1;s&&(t.save(),t.fillStyle=i.getPattern(t,this,$i(t),xe.FILL),n=!0);const r=this.current.getClippedPathBoundingBox();this.contentVisible&&r!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),n&&t.restore(),e&&this.consumePath(r)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=rm}eoClip(){this.pendingClip=Wu}beginText(){this.current.textMatrix=nf,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const i=new Path2D,s=t.getTransform().invertSelf();for(const{transform:n,x:r,y:o,fontSize:l,path:h}of e)i.addPath(h,new DOMMatrix(n).preMultiplySelf(s).translate(r,o).scale(l,-l));t.clip(i),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var c;const i=this.commonObjs.get(e),s=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=i.fontMatrix||Vc,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&vt("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;const n=i.loadedName||"sans-serif",r=((c=i.systemFontInfo)==null?void 0:c.css)||`"${n}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const l=i.italic?"italic":"normal";let h=t;t<Nu?h=Nu:t>Bu&&(h=Bu),this.current.fontSizeScale=t/h,this.ctx.font=`${l} ${o} ${h}px ${r}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,i,s,n,r){this.current.textMatrix=[e,t,i,s,n,r],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,i,s,n){const r=this.ctx,o=this.current,l=o.font,h=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,d=h&ye.FILL_STROKE_MASK,u=!!(h&ye.ADD_TO_PATH_FLAG),p=o.patternFill&&!l.missingFile,m=o.patternStroke&&!l.missingFile;let g;if((l.disableFontFace||u||p||m)&&(g=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||p||m){if(r.save(),r.translate(t,i),r.scale(c,-c),d===ye.FILL||d===ye.FILL_STROKE)if(s){const y=r.getTransform();r.setTransform(...s),r.fill(E(this,zi,Ad).call(this,g,y,s))}else r.fill(g);if(d===ye.STROKE||d===ye.FILL_STROKE)if(n){const y=r.getTransform();r.setTransform(...n),r.stroke(E(this,zi,Ad).call(this,g,y,n))}else r.lineWidth/=c,r.stroke(g);r.restore()}else(d===ye.FILL||d===ye.FILL_STROKE)&&r.fillText(e,t,i),(d===ye.STROKE||d===ye.FILL_STROKE)&&r.strokeText(e,t,i);u&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Ht(r),x:t,y:i,fontSize:c,path:g})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){i=!0;break}return St(this,"isFontSubpixelAAEnabled",i)}showText(e){const t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);const s=t.fontSize;if(s===0)return;const n=this.ctx,r=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,h=t.fontDirection,c=t.textHScale*h,d=e.length,u=i.vertical,p=u?1:-1,m=i.defaultVMetrics,g=s*t.fontMatrix[0],y=t.textRenderingMode===ye.FILL&&!i.disableFontFace&&!t.patternFill;n.save(),n.transform(...t.textMatrix),n.translate(t.x,t.y+t.textRise),h>0?n.scale(c,-1):n.scale(c,1);let b,_;if(t.patternFill){n.save();const L=t.fillColor.getPattern(n,this,$i(n),xe.FILL);b=Ht(n),n.restore(),n.fillStyle=L}if(t.patternStroke){n.save();const L=t.strokeColor.getPattern(n,this,$i(n),xe.STROKE);_=Ht(n),n.restore(),n.strokeStyle=L}let x=t.lineWidth;const C=t.textMatrixScale;if(C===0||x===0){const L=t.textRenderingMode&ye.FILL_STROKE_MASK;(L===ye.STROKE||L===ye.FILL_STROKE)&&(x=this.getSinglePixelWidth())}else x/=C;if(r!==1&&(n.scale(r,r),x/=r),n.lineWidth=x,i.isInvalidPDFjsFont){const L=[];let N=0;for(const D of e)L.push(D.unicode),N+=D.width;n.fillText(L.join(""),0,0),t.x+=N*g*c,n.restore(),this.compose();return}let k=0,M;for(M=0;M<d;++M){const L=e[M];if(typeof L=="number"){k+=p*L*s/1e3;continue}let N=!1;const D=(L.isSpace?l:0)+o,G=L.fontChar,Z=L.accent;let R,U,A=L.width;if(u){const V=L.vmetric||m,H=-(L.vmetric?V[1]:A*.5)*g,ct=V[2]*g;A=V?-V[0]:A,R=H/r,U=(k+ct)/r}else R=k/r,U=0;if(i.remeasure&&A>0){const V=n.measureText(G).width*1e3/s*r;if(A<V&&this.isFontSubpixelAAEnabled){const H=A/V;N=!0,n.save(),n.scale(H,1),R/=H}else A!==V&&(R+=(A-V)/2e3*s/r)}if(this.contentVisible&&(L.isInFont||i.missingFile)){if(y&&!Z)n.fillText(G,R,U);else if(this.paintChar(G,R,U,b,_),Z){const V=R+s*Z.offset.x/r,H=U-s*Z.offset.y/r;this.paintChar(Z.fontChar,V,H,b,_)}}const j=u?A*g-D*h:A*g+D*h;k+=j,N&&n.restore()}u?t.y-=k:t.x+=k*c,n.restore(),this.compose()}showType3Text(e){const t=this.ctx,i=this.current,s=i.font,n=i.fontSize,r=i.fontDirection,o=s.vertical?1:-1,l=i.charSpacing,h=i.wordSpacing,c=i.textHScale*r,d=i.fontMatrix||Vc,u=e.length,p=i.textRenderingMode===ye.INVISIBLE;let m,g,y,b;if(!(p||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...i.textMatrix),t.translate(i.x,i.y),t.scale(c,r),m=0;m<u;++m){if(g=e[m],typeof g=="number"){b=o*g*n/1e3,this.ctx.translate(b,0),i.x+=b*c;continue}const _=(g.isSpace?h:0)+l,x=s.charProcOperatorList[g.operatorListId];if(!x){vt(`Type3 character "${g.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=g,this.save(),t.scale(n,n),t.transform(...d),this.executeOperatorList(x),this.restore()),y=ht.applyTransform([g.width,0],d)[0]*n+_,t.translate(y,0),i.x+=y*c}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,s,n,r){this.ctx.rect(i,s,n-i,r-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const i=e[1],s=this.baseTransform||Ht(this.ctx),n={createCanvasGraphics:r=>new Su(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new vd(e,i,this.ctx,n,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,i){this.ctx.strokeStyle=this.current.strokeColor=ht.makeHexColor(e,t,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,i){this.ctx.fillStyle=this.current.fillColor=ht.makeHexColor(e,t,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=Zg(this.getObject(e)),this.cachedPatterns.set(e,i)),t&&(i.matrix=t),i}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,$i(t),xe.SHADING);const s=$i(t);if(s){const{width:n,height:r}=t.canvas,[o,l,h,c]=ht.getAxialAlignedBoundingBox([0,0,n,r],s);this.ctx.fillRect(o,l,h-o,c-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Ft("Should not call beginInlineImage")}beginImageData(){Ft("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Ht(this.ctx),t)){const i=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],i,s),this.current.updateRectMinMax(Ht(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||Rc("TODO: Support non-isolated groups."),e.knockout&&vt("Knockout groups not supported.");const i=Ht(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=ht.getAxialAlignedBoundingBox(e.bbox,Ht(t));const n=[0,0,t.canvas.width,t.canvas.height];s=ht.intersect(s,n)||[0,0,0,0];const r=Math.floor(s[0]),o=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-r,1),h=Math.max(Math.ceil(s[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,h]);let c="groupAt"+this.groupLevel;e.smask&&(c+="_smask_"+this.smaskCounter++%2);const d=this.cachedCanvases.getCanvas(c,l,h),u=d.context;u.translate(-r,-o),u.transform(...i),e.smask?this.smaskStack.push({canvas:d.canvas,context:u,offsetX:r,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(r,o),t.save()),go(t,u),this.ctx=u,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=Ht(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const n=ht.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,i,s,n){if(E(this,zi,wd).call(this),Sh(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const r=t[2]-t[0],o=t[3]-t[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=t[0],i[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=r,t[3]=o;const[l,h]=ht.singularValueDecompose2dScale(Ht(this.ctx)),{viewportScale:c}=this,d=Math.ceil(r*this.outputScaleX*c),u=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,u);const{canvas:p,context:m}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=m,this.ctx.save(),this.ctx.setTransform(l,0,0,-h,0,o*h),Sh(this.ctx)}else Sh(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],r,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new Uu(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),E(this,zi,_d).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const i=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=im(e)),s.compiled)){s.compiled(i);return}const n=this._createMaskCanvas(e),r=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,n.offsetX,n.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i=0,s=0,n,r){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=Ht(o);o.transform(t,i,s,n,0,0);const h=this._createMaskCanvas(e);o.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]);for(let c=0,d=r.length;c<d;c+=2){const u=ht.transform(l,[t,i,s,n,r[c],r[c+1]]),[p,m]=ht.applyTransform([0,0],u);o.drawImage(h.canvas,p,m)}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const n of e){const{data:r,width:o,height:l,transform:h}=n,c=this.cachedCanvases.getCanvas("maskCanvas",o,l),d=c.context;d.save();const u=this.getObject(r,n);ju(d,u),d.globalCompositeOperation="source-in",d.fillStyle=s?i.getPattern(d,this,$i(t),xe.FILL):i,d.fillRect(0,0,o,l),d.restore(),t.save(),t.transform(...h),t.scale(1,-1),Ah(t,c.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){vt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,i,s){if(!this.contentVisible)return;const n=this.getObject(e);if(!n){vt("Dependent image isn't ready yet");return}const r=n.width,o=n.height,l=[];for(let h=0,c=s.length;h<c;h+=2)l.push({transform:[t,0,0,i,s[h],s[h+1]],x:0,y:0,w:r,h:o});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:i,height:s}=e,n=this.cachedCanvases.getCanvas("inlineImage",i,s),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,i=e.height,s=this.ctx;if(this.save(),!Ce){const{filter:o}=s;o!=="none"&&o!==""&&(s.filter="none")}s.scale(1/t,-1/i);let n;if(e.bitmap)n=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)n=e;else{const l=this.cachedCanvases.getCanvas("inlineImage",t,i).context;$u(l,e),n=this.applyTransferMapsToCanvas(l)}const r=this._scaleImage(n,$i(s));s.imageSmoothingEnabled=Gu(Ht(s),e.interpolate),Ah(s,r.img,0,0,r.paintWidth,r.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const n=e.width,r=e.height,l=this.cachedCanvases.getCanvas("inlineImage",n,r).context;$u(l,e),s=this.applyTransferMapsToCanvas(l)}for(const n of t)i.save(),i.transform(...n.transform),i.scale(1,-1),Ah(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(t||(this.pendingClip===Wu?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Ht(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:i,c:s,d:n}=this.ctx.getTransform();let r,o;if(i===0&&s===0){const l=Math.abs(t),h=Math.abs(n);if(l===h)if(e===0)r=o=1/l;else{const c=l*e;r=o=c<1?1/c:1}else if(e===0)r=1/l,o=1/h;else{const c=l*e,d=h*e;r=c<1?1/c:1,o=d<1?1/d:1}}else{const l=Math.abs(t*n-i*s),h=Math.hypot(t,i),c=Math.hypot(s,n);if(e===0)r=c/l,o=h/l;else{const d=e*l;r=c>d?c/d:1,o=h>d?h/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:i}=this.current,[s,n]=this.getScaleForStroking();if(t.lineWidth=i||1,s===1&&n===1){t.stroke();return}const r=t.getLineDash();if(e&&t.save(),t.scale(s,n),r.length>0){const o=Math.max(s,n);t.setLineDash(r.map(l=>l/o)),t.lineDashOffset/=o}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};zi=new WeakSet,wd=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},_d=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Ad=function(e,t,i){const s=new Path2D;return s.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),s};let ea=Su;for(const f in Si)ea.prototype[f]!==void 0&&(ea.prototype[Si[f]]=ea.prototype[f]);var ml,bl;class Hs{static get workerPort(){return a(this,ml)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");v(this,ml,e)}static get workerSrc(){return a(this,bl)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");v(this,bl,e)}}ml=new WeakMap,bl=new WeakMap,S(Hs,ml,null),S(Hs,bl,"");var rr,yl;class am{constructor({parsedData:e,rawData:t}){S(this,rr);S(this,yl);v(this,rr,e),v(this,yl,t)}getRaw(){return a(this,yl)}get(e){return a(this,rr).get(e)??null}getAll(){return hu(a(this,rr))}has(e){return a(this,rr).has(e)}}rr=new WeakMap,yl=new WeakMap;const Yr=Symbol("INTERNAL");var vl,wl,_l,Aa;class om{constructor(e,{name:t,intent:i,usage:s,rbGroups:n}){S(this,vl,!1);S(this,wl,!1);S(this,_l,!1);S(this,Aa,!0);v(this,vl,!!(e&ii.DISPLAY)),v(this,wl,!!(e&ii.PRINT)),this.name=t,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(a(this,_l))return a(this,Aa);if(!a(this,Aa))return!1;const{print:e,view:t}=this.usage;return a(this,vl)?(t==null?void 0:t.viewState)!=="OFF":a(this,wl)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,i=!1){e!==Yr&&Ft("Internal method `_setVisible` called."),v(this,_l,i),v(this,Aa,t)}}vl=new WeakMap,wl=new WeakMap,_l=new WeakMap,Aa=new WeakMap;var on,Lt,Sa,Ea,Al,Sd;class lm{constructor(e,t=ii.DISPLAY){S(this,Al);S(this,on,null);S(this,Lt,new Map);S(this,Sa,null);S(this,Ea,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,v(this,Ea,e.order);for(const i of e.groups)a(this,Lt).set(i.id,new om(t,i));if(e.baseState==="OFF")for(const i of a(this,Lt).values())i._setVisible(Yr,!1);for(const i of e.on)a(this,Lt).get(i)._setVisible(Yr,!0);for(const i of e.off)a(this,Lt).get(i)._setVisible(Yr,!1);v(this,Sa,this.getHash())}}isVisible(e){if(a(this,Lt).size===0)return!0;if(!e)return Rc("Optional content group not defined."),!0;if(e.type==="OCG")return a(this,Lt).has(e.id)?a(this,Lt).get(e.id).visible:(vt(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return E(this,Al,Sd).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!a(this,Lt).has(t))return vt(`Optional content group not found: ${t}`),!0;if(a(this,Lt).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!a(this,Lt).has(t))return vt(`Optional content group not found: ${t}`),!0;if(!a(this,Lt).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!a(this,Lt).has(t))return vt(`Optional content group not found: ${t}`),!0;if(!a(this,Lt).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!a(this,Lt).has(t))return vt(`Optional content group not found: ${t}`),!0;if(a(this,Lt).get(t).visible)return!1}return!0}return vt(`Unknown optional content policy ${e.policy}.`),!0}return vt(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){var n;const s=a(this,Lt).get(e);if(!s){vt(`Optional content group not found: ${e}`);return}if(i&&t&&s.rbGroups.length)for(const r of s.rbGroups)for(const o of r)o!==e&&((n=a(this,Lt).get(o))==null||n._setVisible(Yr,!1,!0));s._setVisible(Yr,!!t,!0),v(this,on,null)}setOCGState({state:e,preserveRB:t}){let i;for(const s of e){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const n=a(this,Lt).get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!n.visible,t);break}}v(this,on,null)}get hasInitialVisibility(){return a(this,Sa)===null||this.getHash()===a(this,Sa)}getOrder(){return a(this,Lt).size?a(this,Ea)?a(this,Ea).slice():[...a(this,Lt).keys()]:null}getGroups(){return a(this,Lt).size>0?hu(a(this,Lt)):null}getGroup(e){return a(this,Lt).get(e)||null}getHash(){if(a(this,on)!==null)return a(this,on);const e=new Ff;for(const[t,i]of a(this,Lt))e.update(`${t}:${i.visible}`);return v(this,on,e.hexdigest())}}on=new WeakMap,Lt=new WeakMap,Sa=new WeakMap,Ea=new WeakMap,Al=new WeakSet,Sd=function(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let s=1;s<t;s++){const n=e[s];let r;if(Array.isArray(n))r=E(this,Al,Sd).call(this,n);else if(a(this,Lt).has(n))r=a(this,Lt).get(n).visible;else return vt(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return i==="And"};class hm{constructor(e,{disableRange:t=!1,disableStream:i=!1}){Jt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:n,progressiveDone:r,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),e.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(i),!0)});Jt(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,i,s,n;e.total===void 0?(i=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||i.call(t,{loaded:e.loaded}):(n=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||n.call(s,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Jt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new cm(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new dm(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeReaders.slice(0))i.cancel(e);this._pdfDataRangeTransport.abort()}}class cm{constructor(e,t,i=!1,s=null){this._stream=e,this._done=i||!1,this._filename=uu(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class dm{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function um(f){let e=!0,t=i("filename\\*","i").exec(f);if(t){t=t[1];let c=o(t);return c=unescape(c),c=l(c),c=h(c),n(c)}if(t=r(f),t){const c=h(t);return n(c)}if(t=i("filename","i").exec(f),t){t=t[1];let c=o(t);return c=h(c),n(c)}function i(c,d){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function s(c,d){if(c){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const u=new TextDecoder(c,{fatal:!0}),p=Ic(d);d=u.decode(p),e=!1}catch{}}return d}function n(c){return e&&/[\x80-\xff]/.test(c)&&(c=s("utf-8",c),e&&(c=s("iso-8859-1",c))),c}function r(c){const d=[];let u;const p=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=p.exec(c))!==null;){let[,g,y,b]=u;if(g=parseInt(g,10),g in d){if(g===0)break;continue}d[g]=[y,b]}const m=[];for(let g=0;g<d.length&&g in d;++g){let[y,b]=d[g];b=o(b),y&&(b=unescape(b),g===0&&(b=l(b))),m.push(b)}return m.join("")}function o(c){if(c.startsWith('"')){const d=c.slice(1).split('\\"');for(let u=0;u<d.length;++u){const p=d[u].indexOf('"');p!==-1&&(d[u]=d[u].slice(0,p),d.length=u+1),d[u]=d[u].replaceAll(/\\(.)/g,"$1")}c=d.join('"')}return c}function l(c){const d=c.indexOf("'");if(d===-1)return c;const u=c.slice(0,d),m=c.slice(d+1).replace(/^[^']*'/,"");return s(u,m)}function h(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,u,p,m){if(p==="q"||p==="Q")return m=m.replaceAll("_"," "),m=m.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,y){return String.fromCharCode(parseInt(y,16))}),s(u,m);try{m=atob(m)}catch{}return s(u,m)})}return""}function Yf(f,e){const t=new Headers;if(!f||!e||typeof e!="object")return t;for(const i in e){const s=e[i];s!==void 0&&t.append(i,s)}return t}function Dc(f){try{return new URL(f).origin}catch{}return null}function Kf({responseHeaders:f,isHttp:e,rangeChunkSize:t,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(f.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*t)||i||!e||f.get("Accept-Ranges")!=="bytes"||(f.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Zf(f){const e=f.get("Content-Disposition");if(e){let t=um(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(uu(t))return t}return null}function Fc(f,e){return f===404||f===0&&e.startsWith("file:")?new No('Missing PDF "'+e+'".'):new ec(`Unexpected server response (${f}) while retrieving PDF "${e}".`,f)}function Qf(f){return f===200||f===206}function Jf(f,e,t){return{method:"GET",headers:f,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function tp(f){return f instanceof Uint8Array?f.buffer:f instanceof ArrayBuffer?f:(vt(`getArrayBuffer - unexpected data format: ${f}`),new Uint8Array(f).buffer)}class qu{constructor(e){ut(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=Yf(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Jt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new fm(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new pm(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class fm{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const i=new Headers(e.headers),s=t.url;fetch(s,Jf(i,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=Dc(n.url),!Qf(n.status))throw Fc(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:o,suggestedLength:l}=Kf({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=Zf(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Cn("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:tp(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class pm{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const n=new Headers(e.headers);n.append("Range",`bytes=${t}-${i-1}`);const r=s.url;fetch(r,Jf(n,this._withCredentials,this._abortController)).then(o=>{const l=Dc(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!Qf(o.status))throw Fc(o.status,r);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:tp(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Wc=200,qc=206;function gm(f){const e=f.response;return typeof e!="string"?e:Ic(e).buffer}class mm{constructor({url:e,httpHeaders:t,withCredentials:i}){ut(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=Yf(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[n,r]of this.headers)t.setRequestHeader(n,r);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=qc):s.expectedStatus=Wc,t.responseType="arraybuffer",Jt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){var s;const i=this.pendingRequests[e];i&&((s=i.onProgress)==null||s.call(i,t))}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){i.onError(s.status);return}const n=s.status||Wc;if(!(n===Wc&&i.expectedStatus===qc)&&n!==i.expectedStatus){i.onError(s.status);return}const o=gm(s);if(n===qc){const l=s.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?i.onDone({begin:parseInt(h[1],10),chunk:o}):(vt('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class bm{constructor(e){this._source=e,this._manager=new mm(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Jt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ym(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new vm(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class ym{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Dc(t.responseURL);const i=t.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...h]=o.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=Kf({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Zf(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Fc(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class vm{constructor(e,t,i){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=Dc((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=Fc(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const wm=/^[a-z][a-z0-9\-+.]+:/i;function _m(f){if(wm.test(f))return new URL(f);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(f))}class Am{constructor(e){this.source=e,this.url=_m(e.url),Jt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Jt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Sm(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Em(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}}class Sm{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new No(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Cn("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Em{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=e.source;this._isStreamingSupported=!s.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const xm=1e5,Ne=30,Cm=.8;var ef,ln,Ue,Sl,El,ar,Es,xl,Cl,or,xa,Ca,hn,ka,kl,Ta,lr,Tl,Pl,hr,cr,Rl,cn,Pa,Ws,ep,ip,Ed,ri,Oh,xd,sp,np;const ie=class ie{constructor({textContentSource:e,container:t,viewport:i}){S(this,Ws);S(this,ln,Promise.withResolvers());S(this,Ue,null);S(this,Sl,!1);S(this,El,!!((ef=globalThis.FontInspector)!=null&&ef.enabled));S(this,ar,null);S(this,Es,null);S(this,xl,0);S(this,Cl,0);S(this,or,null);S(this,xa,null);S(this,Ca,0);S(this,hn,0);S(this,ka,Object.create(null));S(this,kl,[]);S(this,Ta,null);S(this,lr,[]);S(this,Tl,new WeakMap);S(this,Pl,null);var l;if(e instanceof ReadableStream)v(this,Ta,e);else if(typeof e=="object")v(this,Ta,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');v(this,Ue,v(this,xa,t)),v(this,hn,i.scale*(globalThis.devicePixelRatio||1)),v(this,Ca,i.rotation),v(this,Es,{div:null,properties:null,ctx:null});const{pageWidth:s,pageHeight:n,pageX:r,pageY:o}=i.rawDims;v(this,Pl,[1,0,0,-1,-r,o+n]),v(this,Cl,s),v(this,xl,n),E(l=ie,ri,sp).call(l),Hr(t,i),a(this,ln).promise.finally(()=>{a(ie,Pa).delete(this),v(this,Es,null),v(this,ka,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=De.platform;return St(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{a(this,or).read().then(({value:t,done:i})=>{if(i){a(this,ln).resolve();return}a(this,ar)??v(this,ar,t.lang),Object.assign(a(this,ka),t.styles),E(this,Ws,ep).call(this,t.items),e()},a(this,ln).reject)};return v(this,or,a(this,Ta).getReader()),a(ie,Pa).add(this),e(),a(this,ln).promise}update({viewport:e,onBefore:t=null}){var n;const i=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==a(this,Ca)&&(t==null||t(),v(this,Ca,s),Hr(a(this,xa),{rotation:s})),i!==a(this,hn)){t==null||t(),v(this,hn,i);const r={div:null,properties:null,ctx:E(n=ie,ri,Oh).call(n,a(this,ar))};for(const o of a(this,lr))r.properties=a(this,Tl).get(o),r.div=o,E(this,Ws,Ed).call(this,r)}}cancel(){var t;const e=new Cn("TextLayer task cancelled.");(t=a(this,or))==null||t.cancel(e).catch(()=>{}),v(this,or,null),a(this,ln).reject(e)}get textDivs(){return a(this,lr)}get textContentItemsStr(){return a(this,kl)}static cleanup(){if(!(a(this,Pa).size>0)){a(this,hr).clear();for(const{canvas:e}of a(this,cr).values())e.remove();a(this,cr).clear()}}};ln=new WeakMap,Ue=new WeakMap,Sl=new WeakMap,El=new WeakMap,ar=new WeakMap,Es=new WeakMap,xl=new WeakMap,Cl=new WeakMap,or=new WeakMap,xa=new WeakMap,Ca=new WeakMap,hn=new WeakMap,ka=new WeakMap,kl=new WeakMap,Ta=new WeakMap,lr=new WeakMap,Tl=new WeakMap,Pl=new WeakMap,hr=new WeakMap,cr=new WeakMap,Rl=new WeakMap,cn=new WeakMap,Pa=new WeakMap,Ws=new WeakSet,ep=function(e){var s,n;if(a(this,Sl))return;(n=a(this,Es)).ctx??(n.ctx=E(s=ie,ri,Oh).call(s,a(this,ar)));const t=a(this,lr),i=a(this,kl);for(const r of e){if(t.length>xm){vt("Ignoring additional textDivs for performance reasons."),v(this,Sl,!0);return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const o=a(this,Ue);v(this,Ue,document.createElement("span")),a(this,Ue).classList.add("markedContent"),r.id!==null&&a(this,Ue).setAttribute("id",`${r.id}`),o.append(a(this,Ue))}else r.type==="endMarkedContent"&&v(this,Ue,a(this,Ue).parentNode);continue}i.push(r.str),E(this,Ws,ip).call(this,r)}},ip=function(e){var g;const t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};a(this,lr).push(t);const s=ht.transform(a(this,Pl),e.transform);let n=Math.atan2(s[1],s[0]);const r=a(this,ka)[e.fontName];r.vertical&&(n+=Math.PI/2);let o=a(this,El)&&r.fontSubstitution||r.fontFamily;o=ie.fontFamilyMap.get(o)||o;const l=Math.hypot(s[2],s[3]),h=l*E(g=ie,ri,np).call(g,o,a(this,ar));let c,d;n===0?(c=s[4],d=s[5]-h):(c=s[4]+h*Math.sin(n),d=s[5]-h*Math.cos(n));const u="calc(var(--scale-factor)*",p=t.style;a(this,Ue)===a(this,xa)?(p.left=`${(100*c/a(this,Cl)).toFixed(2)}%`,p.top=`${(100*d/a(this,xl)).toFixed(2)}%`):(p.left=`${u}${c.toFixed(2)}px)`,p.top=`${u}${d.toFixed(2)}px)`),p.fontSize=`${u}${(a(ie,cn)*l).toFixed(2)}px)`,p.fontFamily=o,i.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,a(this,El)&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),n!==0&&(i.angle=n*(180/Math.PI));let m=!1;if(e.str.length>1)m=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const y=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);y!==b&&Math.max(y,b)/Math.min(y,b)>1.5&&(m=!0)}if(m&&(i.canvasWidth=r.vertical?e.height:e.width),a(this,Tl).set(t,i),a(this,Es).div=t,a(this,Es).properties=i,E(this,Ws,Ed).call(this,a(this,Es)),i.hasText&&a(this,Ue).append(t),i.hasEOL){const y=document.createElement("br");y.setAttribute("role","presentation"),a(this,Ue).append(y)}},Ed=function(e){var o;const{div:t,properties:i,ctx:s}=e,{style:n}=t;let r="";if(a(ie,cn)>1&&(r=`scale(${1/a(ie,cn)})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:l}=n,{canvasWidth:h,fontSize:c}=i;E(o=ie,ri,xd).call(o,s,c*a(this,hn),l);const{width:d}=s.measureText(t.textContent);d>0&&(r=`scaleX(${h*a(this,hn)/d}) ${r}`)}i.angle!==0&&(r=`rotate(${i.angle}deg) ${r}`),r.length>0&&(n.transform=r)},ri=new WeakSet,Oh=function(e=null){let t=a(this,cr).get(e||(e=""));if(!t){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),a(this,cr).set(e,t),a(this,Rl).set(t,{size:0,family:""})}return t},xd=function(e,t,i){const s=a(this,Rl).get(e);t===s.size&&i===s.family||(e.font=`${t}px ${i}`,s.size=t,s.family=i)},sp=function(){if(a(this,cn)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),v(this,cn,e.getBoundingClientRect().height),e.remove()},np=function(e,t){const i=a(this,hr).get(e);if(i)return i;const s=E(this,ri,Oh).call(this,t);s.canvas.width=s.canvas.height=Ne,E(this,ri,xd).call(this,s,Ne,e);const n=s.measureText("");let r=n.fontBoundingBoxAscent,o=Math.abs(n.fontBoundingBoxDescent);if(r){const c=r/(r+o);return a(this,hr).set(e,c),s.canvas.width=s.canvas.height=0,c}s.strokeStyle="red",s.clearRect(0,0,Ne,Ne),s.strokeText("g",0,0);let l=s.getImageData(0,0,Ne,Ne).data;o=0;for(let c=l.length-1-3;c>=0;c-=4)if(l[c]>0){o=Math.ceil(c/4/Ne);break}s.clearRect(0,0,Ne,Ne),s.strokeText("A",0,Ne),l=s.getImageData(0,0,Ne,Ne).data,r=0;for(let c=0,d=l.length;c<d;c+=4)if(l[c]>0){r=Ne-Math.floor(c/4/Ne);break}s.canvas.width=s.canvas.height=0;const h=r?r/(r+o):Cm;return a(this,hr).set(e,h),h},S(ie,ri),S(ie,hr,new Map),S(ie,cr,new Map),S(ie,Rl,new WeakMap),S(ie,cn,null),S(ie,Pa,new Set);let Bo=ie;class zo{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};function s(n){var l;if(!n)return;let r=null;const o=n.name;if(o==="#text")r=n.value;else if(zo.shouldBuildText(o))(l=n==null?void 0:n.attributes)!=null&&l.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&t.push({str:r}),!!n.children)for(const h of n.children)s(h)}return s(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const km=65536,Tm=100,Pm=5e3,Rm=Ce?Gg:Ug,Im=Ce?Wg:jf,Lm=Ce?jg:$g,Mm=Ce?qg:Vf;function Dm(f={}){typeof f=="string"||f instanceof URL?f={url:f}:(f instanceof ArrayBuffer||ArrayBuffer.isView(f))&&(f={data:f});const e=new Cd,{docId:t}=e,i=f.url?Fm(f.url):null,s=f.data?Om(f.data):null,n=f.httpHeaders||null,r=f.withCredentials===!0,o=f.password??null,l=f.range instanceof rp?f.range:null,h=Number.isInteger(f.rangeChunkSize)&&f.rangeChunkSize>0?f.rangeChunkSize:km;let c=f.worker instanceof ia?f.worker:null;const d=f.verbosity,u=typeof f.docBaseUrl=="string"&&!Mc(f.docBaseUrl)?f.docBaseUrl:null,p=typeof f.cMapUrl=="string"?f.cMapUrl:null,m=f.cMapPacked!==!1,g=f.CMapReaderFactory||Im,y=typeof f.standardFontDataUrl=="string"?f.standardFontDataUrl:null,b=f.StandardFontDataFactory||Mm,_=f.stopAtErrors!==!0,x=Number.isInteger(f.maxImageSize)&&f.maxImageSize>-1?f.maxImageSize:-1,C=f.isEvalSupported!==!1,k=typeof f.isOffscreenCanvasSupported=="boolean"?f.isOffscreenCanvasSupported:!Ce,M=typeof f.isImageDecoderSupported=="boolean"?f.isImageDecoderSupported:!Ce&&(De.platform.isFirefox||!globalThis.chrome),L=Number.isInteger(f.canvasMaxAreaInBytes)?f.canvasMaxAreaInBytes:-1,N=typeof f.disableFontFace=="boolean"?f.disableFontFace:Ce,D=f.fontExtraProperties===!0,G=f.enableXfa===!0,Z=f.ownerDocument||globalThis.document,R=f.disableRange===!0,U=f.disableStream===!0,A=f.disableAutoFetch===!0,j=f.pdfBug===!0,V=f.CanvasFactory||Rm,H=f.FilterFactory||Lm,ct=f.enableHWA===!0,Y=l?l.length:f.length??NaN,ot=typeof f.useSystemFonts=="boolean"?f.useSystemFonts:!Ce&&!N,B=typeof f.useWorkerFetch=="boolean"?f.useWorkerFetch:g===jf&&b===Vf&&p&&y&&yo(p,document.baseURI)&&yo(y,document.baseURI),O=null;vg(d);const W={canvasFactory:new V({ownerDocument:Z,enableHWA:ct}),filterFactory:new H({docId:t,ownerDocument:Z}),cMapReaderFactory:B?null:new g({baseUrl:p,isCompressed:m}),standardFontDataFactory:B?null:new b({baseUrl:y})};if(!c){const _t={verbosity:d,port:Hs.workerPort};c=_t.port?ia.fromPort(_t):new ia(_t),e._worker=c}const K={docId:t,apiVersion:"4.10.38",data:s,password:o,disableAutoFetch:A,rangeChunkSize:h,length:Y,docBaseUrl:u,enableXfa:G,evaluatorOptions:{maxImageSize:x,disableFontFace:N,ignoreErrors:_,isEvalSupported:C,isOffscreenCanvasSupported:k,isImageDecoderSupported:M,canvasMaxAreaInBytes:L,fontExtraProperties:D,useSystemFonts:ot,cMapUrl:B?p:null,standardFontDataUrl:B?y:null}},J={disableFontFace:N,fontExtraProperties:D,ownerDocument:Z,pdfBug:j,styleElement:O,loadingParams:{disableAutoFetch:A,enableXfa:G}};return c.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const _t=c.messageHandler.sendWithPromise("GetDocRequest",K,s?[s.buffer]:null);let mt;if(l)mt=new hm(l,{disableRange:R,disableStream:U});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");let bt;if(Ce)if(yo(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");bt=qu}else bt=Am;else bt=yo(i)?qu:bm;mt=new bt({url:i,length:Y,httpHeaders:n,withCredentials:r,rangeChunkSize:h,disableRange:R,disableStream:U})}return _t.then(bt=>{if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Ct=new Ao(t,bt,c.port),Zt=new Hm(Ct,e,mt,J,W);e._transport=Zt,Ct.send("Ready",null)})}).catch(e._capability.reject),e}function Fm(f){if(f instanceof URL)return f.href;try{return new URL(f,window.location).href}catch{if(Ce&&typeof f=="string")return f}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Om(f){if(Ce&&typeof Buffer<"u"&&f instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(f instanceof Uint8Array&&f.byteLength===f.buffer.byteLength)return f;if(typeof f=="string")return Ic(f);if(f instanceof ArrayBuffer||ArrayBuffer.isView(f)||typeof f=="object"&&!isNaN(f==null?void 0:f.length))return new Uint8Array(f);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Vu(f){return typeof f=="object"&&Number.isInteger(f==null?void 0:f.num)&&f.num>=0&&Number.isInteger(f==null?void 0:f.gen)&&f.gen>=0}var bc;const yc=class yc{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${ke(yc,bc)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,i,s;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(n){throw(i=this._worker)!=null&&i.port&&delete this._worker._pendingDestroy,n}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}};bc=new WeakMap,S(yc,bc,0);let Cd=yc;class rp{constructor(e,t,i=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){Ft("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Nm{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return St(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var dn,xs,gi,Kr,Nh;class Bm{constructor(e,t,i,s=!1){S(this,gi);S(this,dn,null);S(this,xs,!1);this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=s?new Mu:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new ap,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new fh({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return St(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:s=Vs.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:h=null,printAnnotationStorage:c=null,isEditing:d=!1}){var C,k;(C=this._stats)==null||C.time("Overall");const u=this._transport.getRenderingIntent(i,s,c,d),{renderingIntent:p,cacheKey:m}=u;v(this,xs,!1),E(this,gi,Nh).call(this),o||(o=this._transport.getOptionalContentConfig(p));let g=this._intentStates.get(m);g||(g=Object.create(null),this._intentStates.set(m,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);const y=!!(p&ii.PRINT);g.displayReadyCapability||(g.displayReadyCapability=Promise.withResolvers(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(k=this._stats)==null||k.time("Page Request"),this._pumpOperatorList(u));const b=M=>{var L;g.renderTasks.delete(_),(this._maybeCleanupAfterRender||y)&&v(this,xs,!0),E(this,gi,Kr).call(this,!y),M?(_.capability.reject(M),this._abortOperatorList({intentState:g,reason:M instanceof Error?M:new Error(M)})):_.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(L=globalThis.Stats)!=null&&L.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},_=new Td({callback:b,params:{canvasContext:e,viewport:t,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!y,pdfBug:this._pdfBug,pageColors:h});(g.renderTasks||(g.renderTasks=new Set)).add(_);const x=_.task;return Promise.all([g.displayReadyCapability.promise,o]).then(([M,L])=>{var N;if(this.destroyed){b();return}if((N=this._stats)==null||N.time("Rendering"),!(L.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");_.initializeGraphics({transparency:M,optionalContentConfig:L}),_.operatorListChanged()}).catch(b),x}getOperatorList({intent:e="display",annotationMode:t=Vs.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){var h;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(e,t,i,s,!0);let o=this._intentStates.get(r.cacheKey);o||(o=Object.create(null),this._intentStates.set(r.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(r)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>zo.textContent(i));const t=this.streamTextContent(e);return new Promise(function(i,s){function n(){r.read().then(function({value:l,done:h}){if(h){i(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),n()},s)}const r=t.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),v(this,xs,!1),E(this,gi,Nh).call(this),Promise.all(e)}cleanup(e=!1){v(this,xs,!0);const t=E(this,gi,Kr).call(this,!1);return e&&t&&this._stats&&(this._stats=new Mu),t}_startRenderPage(e,t){var s,n;const i=this._intentStates.get(t);i&&((s=this._stats)==null||s.timeEnd("Page Request"),(n=i.displayReadyCapability)==null||n.resolve(e))}_renderPageChunk(e,t){for(let i=0,s=e.length;i<s;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&E(this,gi,Kr).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:s}){const{map:n,transfer:r}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:s},r).getReader(),h=this._intentStates.get(t);h.streamReader=l;const c=()=>{l.read().then(({value:d,done:u})=>{if(u){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,h),c())},d=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const u of h.renderTasks)u.operatorListChanged();E(this,gi,Kr).call(this,!0)}if(h.displayReadyCapability)h.displayReadyCapability.reject(d);else if(h.opListReadCapability)h.opListReadCapability.reject(d);else throw d}})};c()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof du){let s=Tm;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new Cn(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[s,n]of this._intentStates)if(n===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}dn=new WeakMap,xs=new WeakMap,gi=new WeakSet,Kr=function(e=!1){if(E(this,gi,Nh).call(this),!a(this,xs)||this.destroyed)return!1;if(e)return v(this,dn,setTimeout(()=>{v(this,dn,null),E(this,gi,Kr).call(this,!1)},Pm)),!1;for(const{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),v(this,xs,!1),!0},Nh=function(){a(this,dn)&&(clearTimeout(a(this,dn)),v(this,dn,null))};var Cs,vc;class zm{constructor(){S(this,Cs,new Map);S(this,vc,Promise.resolve())}postMessage(e,t){const i={data:structuredClone(e,t?{transfer:t}:null)};a(this,vc).then(()=>{for(const[s]of a(this,Cs))s.call(this,i)})}addEventListener(e,t,i=null){let s=null;if((i==null?void 0:i.signal)instanceof AbortSignal){const{signal:n}=i;if(n.aborted){vt("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(e,t);s=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}a(this,Cs).set(t,s)}removeEventListener(e,t){const i=a(this,Cs).get(t);i==null||i(),a(this,Cs).delete(t)}terminate(){for(const[,e]of a(this,Cs))e==null||e();a(this,Cs).clear()}}Cs=new WeakMap,vc=new WeakMap;var wc,dr,ur,Ra,Bh,Ia,zh;const zt=class zt{constructor({name:e=null,port:t=null,verbosity:i=wg()}={}){S(this,Ra);var s;if(this.name=e,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((s=a(zt,ur))!=null&&s.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(a(zt,ur)||v(zt,ur,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new Ao("main","worker",e),this._messageHandler.on("ready",function(){}),E(this,Ra,Bh).call(this)}_initialize(){if(a(zt,dr)||a(zt,Ia,zh)){this._setupFakeWorker();return}let{workerSrc:e}=zt;try{zt._isSameOrigin(window.location.href,e)||(e=zt._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),i=new Ao("main","worker",t),s=()=>{n.abort(),i.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:n.signal}),i.on("test",o=>{if(n.abort(),this.destroyed||!o){s();return}this._messageHandler=i,this._port=t,this._webWorker=t,E(this,Ra,Bh).call(this)}),i.on("ready",o=>{if(n.abort(),this.destroyed){s();return}try{r()}catch{this._setupFakeWorker()}});const r=()=>{const o=new Uint8Array;i.send("test",o,[o.buffer])};r();return}catch{Rc("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){a(zt,dr)||(vt("Setting up fake worker."),v(zt,dr,!0)),zt._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new zm;this._port=t;const i=`fake${ke(zt,wc)._++}`,s=new Ao(i+"_worker",i,t);e.setup(s,t),this._messageHandler=new Ao(i,i+"_worker",t),E(this,Ra,Bh).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,i;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=a(zt,ur))==null||t.delete(this._port),this._port=null,(i=this._messageHandler)==null||i.destroy(),this._messageHandler=null}static fromPort(e){var i;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(i=a(this,ur))==null?void 0:i.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new zt(e)}static get workerSrc(){if(Hs.workerSrc)return Hs.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return St(this,"_setupFakeWorkerGlobal",(async()=>a(this,Ia,zh)?a(this,Ia,zh):(await import(this.workerSrc)).WorkerMessageHandler)())}};wc=new WeakMap,dr=new WeakMap,ur=new WeakMap,Ra=new WeakSet,Bh=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Ia=new WeakSet,zh=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},S(zt,Ia),S(zt,wc,0),S(zt,dr,!1),S(zt,ur),Ce&&(v(zt,dr,!0),Hs.workerSrc||(Hs.workerSrc="./pdf.worker.mjs")),zt._isSameOrigin=(e,t)=>{let i;try{if(i=new URL(e),!i.origin||i.origin==="null")return!1}catch{return!1}const s=new URL(t,i);return i.origin===s.origin},zt._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let ia=zt;var ks,ts,La,Ma,Ts,fr,ko;class Hm{constructor(e,t,i,s,n){S(this,fr);S(this,ks,new Map);S(this,ts,new Map);S(this,La,new Map);S(this,Ma,new Map);S(this,Ts,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new ap,this.fontLoader=new zg({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return St(this,"annotationStorage",new gu)}getRenderingIntent(e,t=Vs.ENABLE,i=null,s=!1,n=!1){let r=ii.DISPLAY,o=gd;switch(e){case"any":r=ii.ANY;break;case"display":break;case"print":r=ii.PRINT;break;default:vt(`getRenderingIntent - invalid intent: ${e}`)}const l=r&ii.PRINT&&i instanceof Nf?i:this.annotationStorage;switch(t){case Vs.DISABLE:r+=ii.ANNOTATIONS_DISABLE;break;case Vs.ENABLE:break;case Vs.ENABLE_FORMS:r+=ii.ANNOTATIONS_FORMS;break;case Vs.ENABLE_STORAGE:r+=ii.ANNOTATIONS_STORAGE,o=l.serializable;break;default:vt(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(r+=ii.IS_EDITING),n&&(r+=ii.OPLIST);const{ids:h,hash:c}=l.modifiedIds,d=[r,o.hash,c];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var i;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(i=a(this,Ts))==null||i.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const s of a(this,ts).values())e.push(s._destroy());a(this,ts).clear(),a(this,La).clear(),a(this,Ma).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var s,n;this.commonObjs.clear(),this.fontLoader.clear(),a(this,ks).clear(),this.filterFactory.destroy(),Bo.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new Cn("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,s)=>{Jt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){s.close();return}Jt(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("ReaderHeadersReady",async i=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:n,contentLength:r}=this._fullReader;return(!s||!n)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var h;(h=t.onProgress)==null||h.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:r}}),e.on("GetRangeReader",(i,s)=>{Jt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:r,done:o}){if(o){s.close();return}Jt(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{n.cancel(r),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new Nm(i,this))}),e.on("DocException",i=>{t._capability.reject(Be(i))}),e.on("PasswordRequest",i=>{v(this,Ts,Promise.withResolvers());try{if(!t.onPassword)throw Be(i);const s=n=>{n instanceof Error?a(this,Ts).reject(n):a(this,Ts).resolve({password:n})};t.onPassword(s,i.code)}catch(s){a(this,Ts).reject(s)}return a(this,Ts).promise}),e.on("DataLoaded",i=>{var s;(s=t.onProgress)==null||s.call(t,{loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;a(this,ts).get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,s,n])=>{var r;if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":const{disableFontFace:o,fontExtraProperties:l,pdfBug:h}=this._params;if("error"in n){const p=n.error;vt(`Error during font loading: ${p}`),this.commonObjs.resolve(i,p);break}const c=h&&((r=globalThis.FontInspector)!=null&&r.enabled)?(p,m)=>globalThis.FontInspector.fontAdded(p,m):null,d=new Hg(n,{disableFontFace:o,fontExtraProperties:l,inspectFont:c});this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!l&&d.data&&(d.data=null),this.commonObjs.resolve(i,d)});break;case"CopyLocalImage":const{imageRef:u}=n;Jt(u,"The imageRef must be defined.");for(const p of a(this,ts).values())for(const[,m]of p.objs)if((m==null?void 0:m.ref)===u)return m.dataLen?(this.commonObjs.resolve(i,structuredClone(m)),m.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([i,s,n,r])=>{var l;if(this.destroyed)return;const o=a(this,ts).get(s);if(!o.objs.has(i)){if(o._intentStates.size===0){(l=r==null?void 0:r.bitmap)==null||l.close();return}switch(n){case"Image":o.objs.resolve(i,r),(r==null?void 0:r.dataLen)>gg&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(i,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",i=>{var s;this.destroyed||(s=t.onProgress)==null||s.call(t,{loaded:i.loaded,total:i.total})}),e.on("FetchBuiltInCMap",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)}),e.on("FetchStandardFontData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var i;this.annotationStorage.size<=0&&vt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((i=this._fullReader)==null?void 0:i.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=a(this,La).get(t);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&a(this,Ma).set(n.refStr,e);const r=new Bm(t,n,this,this._params.pdfBug);return a(this,ts).set(t,r),r});return a(this,La).set(t,s),s}getPageIndex(e){return Vu(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return E(this,fr,ko).call(this,"GetFieldObjects")}hasJSActions(){return E(this,fr,ko).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return E(this,fr,ko).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return E(this,fr,ko).call(this,"GetOptionalContentConfig").then(t=>new lm(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=a(this,ks).get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then(s=>{var n,r;return{info:s[0],metadata:s[1]?new am(s[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((r=this._fullReader)==null?void 0:r.contentLength)??null}});return a(this,ks).set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of a(this,ts).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),a(this,ks).clear(),this.filterFactory.destroy(!0),Bo.cleanup()}}cachedPageNumber(e){if(!Vu(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return a(this,Ma).get(t)??null}}ks=new WeakMap,ts=new WeakMap,La=new WeakMap,Ma=new WeakMap,Ts=new WeakMap,fr=new WeakSet,ko=function(e,t=null){const i=a(this,ks).get(e);if(i)return i;const s=this.messageHandler.sendWithPromise(e,t);return a(this,ks).set(e,s),s};const mo=Symbol("INITIAL_DATA");var Ve,Il,kd;class ap{constructor(){S(this,Il);S(this,Ve,Object.create(null))}get(e,t=null){if(t){const s=E(this,Il,kd).call(this,e);return s.promise.then(()=>t(s.data)),null}const i=a(this,Ve)[e];if(!i||i.data===mo)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){const t=a(this,Ve)[e];return!!t&&t.data!==mo}delete(e){const t=a(this,Ve)[e];return!t||t.data===mo?!1:(delete a(this,Ve)[e],!0)}resolve(e,t=null){const i=E(this,Il,kd).call(this,e);i.data=t,i.resolve()}clear(){var e;for(const t in a(this,Ve)){const{data:i}=a(this,Ve)[t];(e=i==null?void 0:i.bitmap)==null||e.close()}v(this,Ve,Object.create(null))}*[Symbol.iterator](){for(const e in a(this,Ve)){const{data:t}=a(this,Ve)[e];t!==mo&&(yield[e,t])}}}Ve=new WeakMap,Il=new WeakSet,kd=function(e){var t;return(t=a(this,Ve))[e]||(t[e]={...Promise.withResolvers(),data:mo})};var un;class Um{constructor(e){S(this,un,null);v(this,un,e),this.onContinue=null}get promise(){return a(this,un).capability.promise}cancel(e=0){a(this,un).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=a(this,un).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=a(this,un);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}un=new WeakMap;var fn,pr;const Fn=class Fn{constructor({callback:e,params:t,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:r,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:c=!1,pdfBug:d=!1,pageColors:u=null}){S(this,fn,null);this.callback=e,this.params=t,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=d,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Um(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,l;if(this.cancelled)return;if(this._canvas){if(a(Fn,pr).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");a(Fn,pr).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:s,transform:n,background:r}=this.params;this.gfx=new ea(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var i;this.running=!1,this.cancelled=!0,(i=this.gfx)==null||i.endDrawing(),a(this,fn)&&(window.cancelAnimationFrame(a(this,fn)),v(this,fn,null)),a(Fn,pr).delete(this._canvas),this.callback(e||new du(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?v(this,fn,window.requestAnimationFrame(()=>{v(this,fn,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),a(Fn,pr).delete(this._canvas),this.callback())))}};fn=new WeakMap,pr=new WeakMap,S(Fn,pr,new WeakSet);let Td=Fn;const $m="4.10.38",jm="f9bea397f";function Xu(f){return Math.floor(Math.max(0,Math.min(1,f))*255).toString(16).padStart(2,"0")}function bo(f){return Math.max(0,Math.min(255,255*f))}class Yu{static CMYK_G([e,t,i,s]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=bo(e),[e,e,e]}static G_HTML([e]){const t=Xu(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(bo)}static RGB_HTML(e){return`#${e.map(Xu).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,i+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,i,s]){return[bo(1-Math.min(1,e+s)),bo(1-Math.min(1,i+s)),bo(1-Math.min(1,t+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){const s=1-e,n=1-t,r=1-i,o=Math.min(s,n,r);return["CMYK",s,n,r,o]}}class Gm{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Ft("Abstract method `_createSVG` called.")}}class bu extends Gm{_createSVG(e){return document.createElementNS(cs,e)}}class op{static setupStorage(e,t,i,s,n){const r=s.getValue(t,{value:null});switch(i.name){case"textarea":if(r.value!==null&&(e.textContent=r.value),n==="print")break;e.addEventListener("input",o=>{s.setValue(t,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(r.value===i.attributes.xfaOn?e.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",o=>{s.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&e.setAttribute("value",r.value),n==="print")break;e.addEventListener("input",o=>{s.setValue(t,{value:o.target.value})})}break;case"select":if(r.value!==null){e.setAttribute("value",r.value);for(const o of i.children)o.attributes.value===r.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:s,linkService:n}){const{attributes:r}=t,o=e instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${s}`);for(const[l,h]of Object.entries(r))if(h!=null)switch(l){case"class":h.length&&e.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,h)}o&&n.addLinkAttributes(e,r.href,r.newWindow),i&&r.dataId&&this.setupStorage(e,r.dataId,t,i)}static render(e){var d,u;const t=e.annotationStorage,i=e.linkService,s=e.xfaHtml,n=e.intent||"display",r=document.createElement(s.name);s.attributes&&this.setAttributes({html:r,element:s,intent:n,linkService:i});const o=n!=="richText",l=e.div;if(l.append(r),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=p}o&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(s.children.length===0){if(s.value){const p=document.createTextNode(s.value);r.append(p),o&&zo.shouldBuildText(s.name)&&h.push(p)}return{textDivs:h}}const c=[[s,-1,r]];for(;c.length>0;){const[p,m,g]=c.at(-1);if(m+1===p.children.length){c.pop();continue}const y=p.children[++c.at(-1)[1]];if(y===null)continue;const{name:b}=y;if(b==="#text"){const x=document.createTextNode(y.value);h.push(x),g.append(x);continue}const _=(d=y==null?void 0:y.attributes)!=null&&d.xmlns?document.createElementNS(y.attributes.xmlns,b):document.createElement(b);if(g.append(_),y.attributes&&this.setAttributes({html:_,element:y,storage:t,intent:n,linkService:i}),((u=y.children)==null?void 0:u.length)>0)c.push([y,-1,_]);else if(y.value){const x=document.createTextNode(y.value);o&&zo.shouldBuildText(b)&&h.push(x),_.append(x)}}for(const p of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const gh=1e3,Wm=9,$r=new WeakSet;function xn(f){return{width:f[2]-f[0],height:f[3]-f[1]}}class qm{static create(e){switch(e.data.annotationType){case ee.LINK:return new lp(e);case ee.TEXT:return new Vm(e);case ee.WIDGET:switch(e.data.fieldType){case"Tx":return new Xm(e);case"Btn":return e.data.radioButton?new dp(e):e.data.checkBox?new Km(e):new Zm(e);case"Ch":return new Qm(e);case"Sig":return new Ym(e)}return new Gr(e);case ee.POPUP:return new Rd(e);case ee.FREETEXT:return new mp(e);case ee.LINE:return new tb(e);case ee.SQUARE:return new eb(e);case ee.CIRCLE:return new ib(e);case ee.POLYLINE:return new bp(e);case ee.CARET:return new nb(e);case ee.INK:return new yu(e);case ee.POLYGON:return new sb(e);case ee.HIGHLIGHT:return new yp(e);case ee.UNDERLINE:return new rb(e);case ee.SQUIGGLY:return new ab(e);case ee.STRIKEOUT:return new ob(e);case ee.STAMP:return new vp(e);case ee.FILEATTACHMENT:return new lb(e);default:return new Kt(e)}}}var gr,Da,Fa,Ll,Pd;const Eu=class Eu{constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){S(this,Ll);S(this,gr,null);S(this,Da,!1);S(this,Fa,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:i}){return!!(e!=null&&e.str||t!=null&&t.str||i!=null&&i.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Eu._hasPopupData(this.data)}updateEdited(e){var i;if(!this.container)return;a(this,gr)||v(this,gr,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&E(this,Ll,Pd).call(this,t),(i=a(this,Fa))==null||i.popup.updateEdited(e)}resetEdited(){var e;a(this,gr)&&(E(this,Ll,Pd).call(this,a(this,gr).rect),(e=a(this,Fa))==null||e.popup.resetEdited(),v(this,gr,null))}_createContainer(e){const{data:t,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),this instanceof Gr||(n.tabIndex=gh);const{style:r}=n;if(r.zIndex=this.parent.zIndex++,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof Rd){const{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}const{width:o,height:l}=xn(t.rect);if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;const g=t.borderStyle.horizontalCornerRadius,y=t.borderStyle.verticalCornerRadius;if(g>0||y>0){const _=`calc(${g}px * var(--scale-factor)) / calc(${y}px * var(--scale-factor))`;r.borderRadius=_}else if(this instanceof dp){const _=`calc(${o}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;r.borderRadius=_}switch(t.borderStyle.style){case po.SOLID:r.borderStyle="solid";break;case po.DASHED:r.borderStyle="dashed";break;case po.BEVELED:vt("Unimplemented border style: beveled");break;case po.INSET:vt("Unimplemented border style: inset");break;case po.UNDERLINE:r.borderBottomStyle="solid";break}const b=t.borderColor||null;b?(v(this,Da,!0),r.borderColor=ht.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):r.borderWidth=0}const h=ht.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:c,pageHeight:d,pageX:u,pageY:p}=s.rawDims;r.left=`${100*(h[0]-u)/c}%`,r.top=`${100*(h[1]-p)/d}%`;const{rotation:m}=t;return t.hasOwnCanvas||m===0?(r.width=`${100*o/c}%`,r.height=`${100*l/d}%`):this.setRotation(m,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims,{width:n,height:r}=xn(this.data.rect);let o,l;e%180===0?(o=100*n/i,l=100*r/s):(o=100*r/i,l=100*n/s),t.style.width=`${o}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,i,s)=>{const n=s.detail[t],r=n[0],o=n.slice(1);s.target.style[i]=Yu[`${r}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:Yu[`${r}_rgb`](o)})};return St(this,"_commonActions",{display:t=>{const{display:i}=t.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const s of Object.keys(t.detail)){const n=e[s]||i[s];n==null||n(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[s,n]of Object.entries(t)){const r=i[s];if(r){const o={detail:{[s]:n},target:e};r(o),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,i,s,n]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){const[g,y,b,_]=e.subarray(2,6);if(s===g&&n===y&&t===b&&i===_)return}const{style:r}=this.container;let o;if(a(this,Da)){const{borderColor:g,borderWidth:y}=r;r.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${y}">`],this.container.classList.add("hasBorder")}const l=s-t,h=n-i,{svgFactory:c}=this,d=c.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);const u=c.createElement("defs");d.append(u);const p=c.createElement("clipPath"),m=`clippath_${this.data.id}`;p.setAttribute("id",m),p.setAttribute("clipPathUnits","objectBoundingBox"),u.append(p);for(let g=2,y=e.length;g<y;g+=8){const b=e[g],_=e[g+1],x=e[g+2],C=e[g+3],k=c.createElement("rect"),M=(x-t)/l,L=(n-_)/h,N=(b-x)/l,D=(_-C)/h;k.setAttribute("x",M),k.setAttribute("y",L),k.setAttribute("width",N),k.setAttribute("height",D),p.append(k),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${M}" y="${L}" width="${N}" height="${D}"/>`)}a(this,Da)&&(o.push("</g></svg>')"),r.backgroundImage=o.join("")),this.container.append(d),this.container.style.clipPath=`url(#${m})`}_createPopup(){const{data:e}=this,t=v(this,Fa,new Rd({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){Ft("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:n,id:r,exportValues:o}of s){if(n===-1||r===t)continue;const l=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${r}"]`);if(h&&!$r.has(h)){vt(`_getElementsByName - element not allowed: ${r}`);continue}i.push({id:r,exportValue:l,domElement:h})}return i}for(const s of document.getElementsByName(e)){const{exportValue:n}=s,r=s.getAttribute("data-element-id");r!==t&&$r.has(s)&&i.push({id:r,exportValue:n,domElement:s})}return i}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var i;(i=this.linkService.eventBus)==null||i.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};gr=new WeakMap,Da=new WeakMap,Fa=new WeakMap,Ll=new WeakSet,Pd=function(e){const{container:{style:t},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:l}}}}=this;i==null||i.splice(0,4,...e);const{width:h,height:c}=xn(e);t.left=`${100*(e[0]-o)/n}%`,t.top=`${100*(r-e[3]+l)/r}%`,s===0?(t.width=`${100*h/n}%`,t.height=`${100*c/r}%`):this.setRotation(s)};let Kt=Eu;var si,In,hp,cp;class lp extends Kt{constructor(t,i=null){super(t,{isRenderable:!0,ignoreBorder:!!(i!=null&&i.ignoreBorder),createQuadrilaterals:!0});S(this,si);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:i}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let n=!1;return t.url?(i.addLinkAttributes(s,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(s,t.action),n=!0):t.attachment?(E(this,si,hp).call(this,s,t.attachment,t.attachmentDest),n=!0):t.setOCGState?(E(this,si,cp).call(this,s,t.setOCGState),n=!0):t.dest?(this._bindLink(s,t.dest),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),n=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(s,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(s),this.container}_bindLink(t,i){t.href=this.linkService.getDestinationHash(i),t.onclick=()=>(i&&this.linkService.goToDestination(i),!1),(i||i==="")&&E(this,si,In).call(this)}_bindNamedAction(t,i){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(i),!1),E(this,si,In).call(this)}_bindJSAction(t,i){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(i.actions)){const r=s.get(n);r&&(t[r]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i.id,name:n}}),!1})}t.onclick||(t.onclick=()=>!1),E(this,si,In).call(this)}_bindResetFormAction(t,i){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),E(this,si,In).call(this),!this._fieldObjects){vt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{var d;s==null||s();const{fields:n,refs:r,include:o}=i,l=[];if(n.length!==0||r.length!==0){const u=new Set(r);for(const p of n){const m=this._fieldObjects[p]||[];for(const{id:g}of m)u.add(g)}for(const p of Object.values(this._fieldObjects))for(const m of p)u.has(m.id)===o&&l.push(m)}else for(const u of Object.values(this._fieldObjects))l.push(...u);const h=this.annotationStorage,c=[];for(const u of l){const{id:p}=u;switch(c.push(p),u.type){case"text":{const g=u.defaultValue||"";h.setValue(p,{value:g});break}case"checkbox":case"radiobutton":{const g=u.defaultValue===u.exportValues;h.setValue(p,{value:g});break}case"combobox":case"listbox":{const g=u.defaultValue||"";h.setValue(p,{value:g});break}default:continue}const m=document.querySelector(`[data-element-id="${p}"]`);if(m){if(!$r.has(m)){vt(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;m.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}si=new WeakSet,In=function(){this.container.setAttribute("data-internal-link","")},hp=function(t,i,s=null){t.href=this.linkService.getAnchorUrl(""),i.description&&(t.title=i.description),t.onclick=()=>{var n;return(n=this.downloadManager)==null||n.openOrDownloadData(i.content,i.filename,s),!1},E(this,si,In).call(this)},cp=function(t,i){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(i),!1),E(this,si,In).call(this)};class Vm extends Kt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Gr extends Kt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return De.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,s,n){i.includes("mouse")?e.addEventListener(i,r=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):e.addEventListener(i,r=>{var o;if(i==="blur"){if(!t.focused||!r.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r)}}))})}_setEventListeners(e,t,i,s){var n,r,o;for(const[l,h]of i)(h==="Action"||(n=this.data.actions)!=null&&n[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,h,s),h==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":ht.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||Wm,n=e.style;let r;const o=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(h/(Hc*s))||1,d=h/c;r=Math.min(s,l(d/Hc))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);r=Math.min(s,l(h/Hc))}n.fontSize=`calc(${r}px * var(--scale-factor))`,n.color=ht.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Xm extends Gr{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,s){const n=this.annotationStorage;for(const r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=i),n.setValue(r.id,{[s]:i})}render(){var s,n;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let o=r.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let h=r.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const c={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=h??o,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",h??o),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),$r.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=gh,this._setRequired(i,this.data.required),l&&(i.maxLength=l),i.addEventListener("input",u=>{e.setValue(t,{value:u.target.value}),this.setPropertyOnSiblings(i,"value",u.target.value,"value"),c.formattedValue=null}),i.addEventListener("resetform",u=>{const p=this.data.defaultFieldValue??"";i.value=c.userValue=p,c.formattedValue=null});let d=u=>{const{formattedValue:p}=c;p!=null&&(u.target.value=p),u.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",p=>{var g;if(c.focused)return;const{target:m}=p;c.userValue&&(m.value=c.userValue),c.lastCommittedValue=m.value,c.commitKey=1,(g=this.data.actions)!=null&&g.Focus||(c.focused=!0)}),i.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const m={value(g){c.userValue=g.detail.value??"",e.setValue(t,{value:c.userValue.toString()}),g.target.value=c.userValue},formattedValue(g){const{formattedValue:y}=g.detail;c.formattedValue=y,y!=null&&g.target!==document.activeElement&&(g.target.value=y),e.setValue(t,{formattedValue:y})},selRange(g){g.target.setSelectionRange(...g.detail.selRange)},charLimit:g=>{var x;const{charLimit:y}=g.detail,{target:b}=g;if(y===0){b.removeAttribute("maxLength");return}b.setAttribute("maxLength",y);let _=c.userValue;!_||_.length<=y||(_=_.slice(0,y),b.value=c.userValue=_,e.setValue(t,{value:_}),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:1,selStart:b.selectionStart,selEnd:b.selectionEnd}}))}};this._dispatchEventFromSandbox(m,p)}),i.addEventListener("keydown",p=>{var y;c.commitKey=1;let m=-1;if(p.key==="Escape"?m=0:p.key==="Enter"&&!this.data.multiLine?m=2:p.key==="Tab"&&(c.commitKey=3),m===-1)return;const{value:g}=p.target;c.lastCommittedValue!==g&&(c.lastCommittedValue=g,c.userValue=g,(y=this.linkService.eventBus)==null||y.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,willCommit:!0,commitKey:m,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const u=d;d=null,i.addEventListener("blur",p=>{var g,y;if(!c.focused||!p.relatedTarget)return;(g=this.data.actions)!=null&&g.Blur||(c.focused=!1);const{value:m}=p.target;c.userValue=m,c.lastCommittedValue!==m&&((y=this.linkService.eventBus)==null||y.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,willCommit:!0,commitKey:c.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),u(p)}),(n=this.data.actions)!=null&&n.Keystroke&&i.addEventListener("beforeinput",p=>{var k;c.lastCommittedValue=null;const{data:m,target:g}=p,{value:y,selectionStart:b,selectionEnd:_}=g;let x=b,C=_;switch(p.inputType){case"deleteWordBackward":{const M=y.substring(0,b).match(/\w*[^\w]*$/);M&&(x-=M[0].length);break}case"deleteWordForward":{const M=y.substring(b).match(/^[^\w]*\w*/);M&&(C+=M[0].length);break}case"deleteContentBackward":b===_&&(x-=1);break;case"deleteContentForward":b===_&&(C+=1);break}p.preventDefault(),(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,change:m||"",willCommit:!1,selStart:x,selEnd:C}})}),this._setEventListeners(i,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(d&&i.addEventListener("blur",d),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/l;i.classList.add("comb"),i.style.letterSpacing=`calc(${p}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Ym extends Gr{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Km extends Gr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let s=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return $r.add(n),n.setAttribute("data-element-id",i),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=gh,n.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const h of this._getElementsByName(o,i)){const c=l&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=c),e.setValue(h.id,{value:c})}e.setValue(i,{value:l})}),n.addEventListener("resetform",r=>{const o=t.defaultFieldValue||"Off";r.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class dp extends Gr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,i=t.id;let s=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(i,{value:s})),s)for(const r of this._getElementsByName(t.fieldName,i))e.setValue(r.id,{value:!1});const n=document.createElement("input");if($r.add(n),n.setAttribute("data-element-id",i),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=gh,n.addEventListener("change",r=>{const{name:o,checked:l}=r.target;for(const h of this._getElementsByName(o,i))e.setValue(h.id,{value:!1});e.setValue(i,{value:l})}),n.addEventListener("resetform",r=>{const o=t.defaultFieldValue;r.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const r=t.buttonValue;n.addEventListener("updatefromsandbox",o=>{const l={value:h=>{const c=r===h.detail.value;for(const d of this._getElementsByName(h.target.name)){const u=c&&d.id===i;d.domElement&&(d.domElement.checked=u),e.setValue(d.id,{value:u})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Zm extends lp{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}}class Qm extends Gr{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");$r.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=gh;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",c=>{const d=this.data.defaultFieldValue;for(const u of s.options)u.selected=u.value===d});for(const c of this.data.options){const d=document.createElement("option");d.textContent=c.displayValue,d.value=c.exportValue,i.value.includes(c.exportValue)&&(d.setAttribute("selected",!0),n=!1),s.append(d)}let r=null;if(n){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),s.prepend(c),r=()=>{c.remove(),s.removeEventListener("input",r),r=null},s.addEventListener("input",r)}const o=c=>{const d=c?"value":"textContent",{options:u,multiple:p}=s;return p?Array.prototype.filter.call(u,m=>m.selected).map(m=>m[d]):u.selectedIndex===-1?null:u[u.selectedIndex][d]};let l=o(!1);const h=c=>{const d=c.target.options;return Array.prototype.map.call(d,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",c=>{const d={value(u){r==null||r();const p=u.detail.value,m=new Set(Array.isArray(p)?p:[p]);for(const g of s.options)g.selected=m.has(g.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(u){s.multiple=!0},remove(u){const p=s.options,m=u.detail.remove;p[m].selected=!1,s.remove(m),p.length>0&&Array.prototype.findIndex.call(p,y=>y.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:o(!0),items:h(u)}),l=o(!1)},clear(u){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(u){const{index:p,displayValue:m,exportValue:g}=u.detail.insert,y=s.children[p],b=document.createElement("option");b.textContent=m,b.value=g,y?y.before(b):s.append(b),e.setValue(t,{value:o(!0),items:h(u)}),l=o(!1)},items(u){const{items:p}=u.detail;for(;s.length!==0;)s.remove(0);for(const m of p){const{displayValue:g,exportValue:y}=m,b=document.createElement("option");b.textContent=g,b.value=y,s.append(b)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:o(!0),items:h(u)}),l=o(!1)},indices(u){const p=new Set(u.detail.indices);for(const m of u.target.options)m.selected=p.has(m.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(d,c)}),s.addEventListener("input",c=>{var p;const d=o(!0),u=o(!1);e.setValue(t,{value:d}),c.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:u,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):s.addEventListener("input",function(c){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Rd extends Kt{constructor(e){const{data:t,elements:i}=e;super(e,{isRenderable:Kt._hasPopupData(t)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Jm({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",t.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(i=>`${cu}${i}`).join(",")),this.container}}var Oa,_c,Ac,Na,mr,Wt,Ps,Ba,Ml,Dl,za,Rs,Ti,Is,Fl,Ls,Ol,br,yr,Dt,Hh,Id,up,fp,pp,gp,Uh,$h,Ld;class Jm{constructor({container:e,color:t,elements:i,titleObj:s,modificationDate:n,contentsObj:r,richText:o,parent:l,rect:h,parentRect:c,open:d}){S(this,Dt);S(this,Oa,E(this,Dt,pp).bind(this));S(this,_c,E(this,Dt,Ld).bind(this));S(this,Ac,E(this,Dt,$h).bind(this));S(this,Na,E(this,Dt,Uh).bind(this));S(this,mr,null);S(this,Wt,null);S(this,Ps,null);S(this,Ba,null);S(this,Ml,null);S(this,Dl,null);S(this,za,null);S(this,Rs,!1);S(this,Ti,null);S(this,Is,null);S(this,Fl,null);S(this,Ls,null);S(this,Ol,null);S(this,br,null);S(this,yr,!1);var u;v(this,Wt,e),v(this,Ol,s),v(this,Ps,r),v(this,Ls,o),v(this,Dl,l),v(this,mr,t),v(this,Fl,h),v(this,za,c),v(this,Ml,i),v(this,Ba,fu.toDateObject(n)),this.trigger=i.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",a(this,Na)),p.addEventListener("mouseenter",a(this,Ac)),p.addEventListener("mouseleave",a(this,_c)),p.classList.add("popupTriggerArea");for(const p of i)(u=p.container)==null||u.addEventListener("keydown",a(this,Oa));a(this,Wt).hidden=!0,d&&E(this,Dt,Uh).call(this)}render(){if(a(this,Ti))return;const e=v(this,Ti,document.createElement("div"));if(e.className="popup",a(this,mr)){const n=e.style.outlineColor=ht.makeHexColor(...a(this,mr));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`:e.style.backgroundColor=ht.makeHexColor(...a(this,mr).map(o=>Math.floor(.7*(255-o)+o)))}const t=document.createElement("span");t.className="header";const i=document.createElement("h1");if(t.append(i),{dir:i.dir,str:i.textContent}=a(this,Ol),e.append(t),a(this,Ba)){const n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:a(this,Ba).valueOf()})),t.append(n)}const s=a(this,Dt,Hh);if(s)op.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(a(this,Ps));e.append(n)}a(this,Wt).append(e)}_formatContents({str:e,dir:t}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=t;const s=e.split(/(?:\r\n?|\n)/);for(let n=0,r=s.length;n<r;++n){const o=s[n];i.append(document.createTextNode(o)),n<r-1&&i.append(document.createElement("br"))}return i}updateEdited({rect:e,popupContent:t}){var i;a(this,br)||v(this,br,{contentsObj:a(this,Ps),richText:a(this,Ls)}),e&&v(this,Is,null),t&&(v(this,Ls,E(this,Dt,fp).call(this,t)),v(this,Ps,null)),(i=a(this,Ti))==null||i.remove(),v(this,Ti,null)}resetEdited(){var e;a(this,br)&&({contentsObj:ke(this,Ps)._,richText:ke(this,Ls)._}=a(this,br),v(this,br,null),(e=a(this,Ti))==null||e.remove(),v(this,Ti,null),v(this,Is,null))}forceHide(){v(this,yr,this.isVisible),a(this,yr)&&(a(this,Wt).hidden=!0)}maybeShow(){a(this,yr)&&(a(this,Ti)||E(this,Dt,$h).call(this),v(this,yr,!1),a(this,Wt).hidden=!1)}get isVisible(){return a(this,Wt).hidden===!1}}Oa=new WeakMap,_c=new WeakMap,Ac=new WeakMap,Na=new WeakMap,mr=new WeakMap,Wt=new WeakMap,Ps=new WeakMap,Ba=new WeakMap,Ml=new WeakMap,Dl=new WeakMap,za=new WeakMap,Rs=new WeakMap,Ti=new WeakMap,Is=new WeakMap,Fl=new WeakMap,Ls=new WeakMap,Ol=new WeakMap,br=new WeakMap,yr=new WeakMap,Dt=new WeakSet,Hh=function(){const e=a(this,Ls),t=a(this,Ps);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&a(this,Ls).html||null},Id=function(){var e,t,i;return((i=(t=(e=a(this,Dt,Hh))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:i.fontSize)||0},up=function(){var e,t,i;return((i=(t=(e=a(this,Dt,Hh))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:i.color)||null},fp=function(e){const t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:a(this,Dt,up),fontSize:a(this,Dt,Id)?`calc(${a(this,Dt,Id)}px * var(--scale-factor))`:""}};for(const n of e.split(`
`))t.push({name:"span",value:n,attributes:s});return i},pp=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&a(this,Rs))&&E(this,Dt,Uh).call(this)},gp=function(){if(a(this,Is)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:s,pageY:n}}}=a(this,Dl);let r=!!a(this,za),o=r?a(this,za):a(this,Fl);for(const m of a(this,Ml))if(!o||ht.intersect(m.data.rect,o)!==null){o=m.data.rect,r=!0;break}const l=ht.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=r?o[2]-o[0]+5:0,d=l[0]+c,u=l[1];v(this,Is,[100*(d-s)/t,100*(u-n)/i]);const{style:p}=a(this,Wt);p.left=`${a(this,Is)[0]}%`,p.top=`${a(this,Is)[1]}%`},Uh=function(){v(this,Rs,!a(this,Rs)),a(this,Rs)?(E(this,Dt,$h).call(this),a(this,Wt).addEventListener("click",a(this,Na)),a(this,Wt).addEventListener("keydown",a(this,Oa))):(E(this,Dt,Ld).call(this),a(this,Wt).removeEventListener("click",a(this,Na)),a(this,Wt).removeEventListener("keydown",a(this,Oa)))},$h=function(){a(this,Ti)||this.render(),this.isVisible?a(this,Rs)&&a(this,Wt).classList.add("focused"):(E(this,Dt,gp).call(this),a(this,Wt).hidden=!1,a(this,Wt).style.zIndex=parseInt(a(this,Wt).style.zIndex)+1e3)},Ld=function(){a(this,Wt).classList.remove("focused"),!(a(this,Rs)||!this.isVisible)&&(a(this,Wt).hidden=!0,a(this,Wt).style.zIndex=parseInt(a(this,Wt).style.zIndex)-1e3)};class mp extends Kt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=yt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Nl;class tb extends Kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Nl,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:i,height:s}=xn(t.rect),n=this.svgFactory.create(i,s,!0),r=v(this,Nl,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Nl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Nl=new WeakMap;var Bl;class eb extends Kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Bl,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:i,height:s}=xn(t.rect),n=this.svgFactory.create(i,s,!0),r=t.borderStyle.width,o=v(this,Bl,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",r/2),o.setAttribute("y",r/2),o.setAttribute("width",i-r),o.setAttribute("height",s-r),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Bl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Bl=new WeakMap;var zl;class ib extends Kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,zl,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:i,height:s}=xn(t.rect),n=this.svgFactory.create(i,s,!0),r=t.borderStyle.width,o=v(this,zl,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",i/2),o.setAttribute("cy",s/2),o.setAttribute("rx",i/2-r/2),o.setAttribute("ry",s/2-r/2),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,zl)}addHighlightArea(){this.container.classList.add("highlightArea")}}zl=new WeakMap;var Hl;class bp extends Kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Hl,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:i,borderStyle:s,popupRef:n}}=this;if(!i)return this.container;const{width:r,height:o}=xn(t),l=this.svgFactory.create(r,o,!0);let h=[];for(let d=0,u=i.length;d<u;d+=2){const p=i[d]-t[0],m=t[3]-i[d+1];h.push(`${p},${m}`)}h=h.join(" ");const c=v(this,Hl,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",h),c.setAttribute("stroke-width",s.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,Hl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Hl=new WeakMap;class sb extends bp{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class nb extends Kt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Ul,vr,$l,Md;class yu extends Kt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,$l);S(this,Ul,null);S(this,vr,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?yt.HIGHLIGHT:yt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:i,inkLists:s,borderStyle:n,popupRef:r}}=this,{transform:o,width:l,height:h}=E(this,$l,Md).call(this,i,t),c=this.svgFactory.create(l,h,!0),d=v(this,Ul,this.svgFactory.createElement("svg:g"));c.append(d),d.setAttribute("stroke-width",n.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",o);for(let u=0,p=s.length;u<p;u++){const m=this.svgFactory.createElement(this.svgElementName);a(this,vr).push(m),m.setAttribute("points",s[u].join(",")),d.append(m)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:i,points:s,rect:n}=t,r=a(this,Ul);if(i>=0&&r.setAttribute("stroke-width",i||1),s)for(let o=0,l=a(this,vr).length;o<l;o++)a(this,vr)[o].setAttribute("points",s[o].join(","));if(n){const{transform:o,width:l,height:h}=E(this,$l,Md).call(this,this.data.rotation,n);r.parentElement.setAttribute("viewBox",`0 0 ${l} ${h}`),r.setAttribute("transform",o)}}getElementsToTriggerPopup(){return a(this,vr)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ul=new WeakMap,vr=new WeakMap,$l=new WeakSet,Md=function(t,i){switch(t){case 90:return{transform:`rotate(90) translate(${-i[0]},${i[1]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};case 180:return{transform:`rotate(180) translate(${-i[2]},${i[1]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]};case 270:return{transform:`rotate(270) translate(${-i[2]},${i[3]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};default:return{transform:`translate(${-i[0]},${i[3]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]}}};class yp extends Kt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=yt.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class rb extends Kt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class ab extends Kt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class ob extends Kt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class vp extends Kt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=yt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var jl,Gl,Dd;class lb extends Kt{constructor(t){var s;super(t,{isRenderable:!0});S(this,Gl);S(this,jl,null);const{file:i}=this.data;this.filename=i.filename,this.content=i.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...i})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:i}=this;let s;i.hasAppearance||i.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(i.name)?"paperclip":"pushpin"}.svg`,i.fillAlpha&&i.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(i.fillAlpha*100)}%);`)),s.addEventListener("dblclick",E(this,Gl,Dd).bind(this)),v(this,jl,s);const{isMac:n}=De.platform;return t.addEventListener("keydown",r=>{r.key==="Enter"&&(n?r.metaKey:r.ctrlKey)&&E(this,Gl,Dd).call(this)}),!i.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return a(this,jl)}addHighlightArea(){this.container.classList.add("highlightArea")}}jl=new WeakMap,Gl=new WeakSet,Dd=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Wl,wr,_r,ql,jr,wp,Fd;class hb{constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:r,structTreeLayer:o}){S(this,jr);S(this,Wl,null);S(this,wr,null);S(this,_r,new Map);S(this,ql,null);this.div=e,v(this,Wl,t),v(this,wr,i),v(this,ql,o||null),this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return a(this,_r).size>0}async render(e){var r;const{annotations:t}=e,i=this.div;Hr(i,this.viewport);const s=new Map,n={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new bu,annotationStorage:e.annotationStorage||new gu,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const l=o.annotationType===ee.POPUP;if(l){const d=s.get(o.id);if(!d)continue;n.elements=d}else{const{width:d,height:u}=xn(o.rect);if(d<=0||u<=0)continue}n.data=o;const h=qm.create(n);if(!h.isRenderable)continue;if(!l&&o.popupRef){const d=s.get(o.popupRef);d?d.push(h):s.set(o.popupRef,[h])}const c=h.render();o.hidden&&(c.style.visibility="hidden"),await E(this,jr,wp).call(this,c,o.id),h._isEditable&&(a(this,_r).set(h.data.id,h),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(h))}E(this,jr,Fd).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Hr(t,{rotation:e.rotation}),E(this,jr,Fd).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(a(this,_r).values())}getEditableAnnotation(e){return a(this,_r).get(e)}}Wl=new WeakMap,wr=new WeakMap,_r=new WeakMap,ql=new WeakMap,jr=new WeakSet,wp=async function(e,t){var r,o;const i=e.firstChild||e,s=i.id=`${cu}${t}`,n=await((r=a(this,ql))==null?void 0:r.getAriaAttributes(s));if(n)for(const[l,h]of n)i.setAttribute(l,h);this.div.append(e),(o=a(this,Wl))==null||o.moveElementInDOM(this.div,e,i,!1)},Fd=function(){if(!a(this,wr))return;const e=this.div;for(const[t,i]of a(this,wr)){const s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;i.className="annotationContent";const{firstChild:n}=s;n?n.nodeName==="CANVAS"?n.replaceWith(i):n.classList.contains("annotationContent")?n.after(i):n.before(i):s.append(i)}a(this,wr).clear()};const Eh=/\r\n?|\n/g;var Pi,Xe,Vl,Ar,Ye,te,_p,Ap,Sp,jh,js,Gh,Wh,Ep,Nd,xp;const Nt=class Nt extends Gt{constructor(t){super({...t,name:"freeTextEditor"});S(this,te);S(this,Pi);S(this,Xe,"");S(this,Vl,`${this.id}-editor`);S(this,Ar,null);S(this,Ye);v(this,Pi,t.color||Nt._defaultColor||Gt._defaultLineColor),v(this,Ye,t.fontSize||Nt._defaultFontSize)}static get _keyboardManager(){const t=Nt.prototype,i=r=>r.isEmpty(),s=Ur.TRANSLATE_SMALL,n=Ur.TRANSLATE_BIG;return St(this,"_keyboardManager",new ph([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[n,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:i}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,n],checker:i}]]))}static initialize(t,i){Gt.initialize(t,i);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,i){switch(t){case Et.FREETEXT_SIZE:Nt._defaultFontSize=i;break;case Et.FREETEXT_COLOR:Nt._defaultColor=i;break}}updateParams(t,i){switch(t){case Et.FREETEXT_SIZE:E(this,te,_p).call(this,i);break;case Et.FREETEXT_COLOR:E(this,te,Ap).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[Et.FREETEXT_SIZE,Nt._defaultFontSize],[Et.FREETEXT_COLOR,Nt._defaultColor||Gt._defaultLineColor]]}get propertiesToUpdate(){return[[Et.FREETEXT_SIZE,a(this,Ye)],[Et.FREETEXT_COLOR,a(this,Pi)]]}_translateEmpty(t,i){this._uiManager.translateSelectedEditors(t,i,!0)}getInitialTranslation(){const t=this.parentScale;return[-Nt._internalPadding*t,-(Nt._internalPadding+a(this,Ye))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(yt.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),v(this,Ar,new AbortController);const t=this._uiManager.combinedSignal(a(this,Ar));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",a(this,Vl)),this._isDraggable=!0,(t=a(this,Ar))==null||t.abort(),v(this,Ar,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var i;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(i=this._initialOptions)!=null&&i.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=a(this,Xe),i=v(this,Xe,E(this,te,Sp).call(this).trimEnd());if(t===i)return;const s=n=>{if(v(this,Xe,n),!n){this.remove();return}E(this,te,Wh).call(this),this._uiManager.rebuild(this),E(this,te,jh).call(this)};this.addCommands({cmd:()=>{s(i)},undo:()=>{s(t)},mustExec:!1}),E(this,te,jh).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Nt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,i;this.width&&(t=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",a(this,Vl)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${a(this,Ye)}px * var(--scale-factor))`,s.color=a(this,Pi),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),ic(this,this.div,["dblclick","keydown"]),this.width){const[n,r]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);const[c,d]=this.pageDimensions,[u,p]=this.pageTranslation;let m,g;switch(this.rotation){case 0:m=t+(o[0]-u)/c,g=i+this.height-(o[1]-p)/d;break;case 90:m=t+(o[0]-u)/c,g=i-(o[1]-p)/d,[l,h]=[h,-l];break;case 180:m=t-this.width+(o[0]-u)/c,g=i-(o[1]-p)/d,[l,h]=[-l,-h];break;case 270:m=t+(o[0]-u-this.height*d)/c,g=i+(o[1]-p-this.width*c)/d,[l,h]=[-h,l];break}this.setAt(m*n,g*r,l,h)}else this.setAt(t*n,i*r,this.width*n,this.height*r);E(this,te,Wh).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var m,g,y;const i=t.clipboardData||window.clipboardData,{types:s}=i;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const n=E(m=Nt,js,Nd).call(m,i.getData("text")||"").replaceAll(Eh,`
`);if(!n)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const o=r.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:l,startOffset:h}=o,c=[],d=[];if(l.nodeType===Node.TEXT_NODE){const b=l.parentElement;if(d.push(l.nodeValue.slice(h).replaceAll(Eh,"")),b!==this.editorDiv){let _=c;for(const x of this.editorDiv.childNodes){if(x===b){_=d;continue}_.push(E(g=Nt,js,Gh).call(g,x))}}c.push(l.nodeValue.slice(0,h).replaceAll(Eh,""))}else if(l===this.editorDiv){let b=c,_=0;for(const x of this.editorDiv.childNodes)_++===h&&(b=d),b.push(E(y=Nt,js,Gh).call(y,x))}v(this,Xe,`${c.join(`
`)}${n}${d.join(`
`)}`),E(this,te,Wh).call(this);const u=new Range;let p=c.reduce((b,_)=>b+_.length,0);for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const _=b.nodeValue.length;if(p<=_){u.setStart(b,p),u.setEnd(b,p);break}p-=_}r.removeAllRanges(),r.addRange(u)}get contentDiv(){return this.editorDiv}static async deserialize(t,i,s){var o;let n=null;if(t instanceof mp){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:c,rotation:d,id:u,popupRef:p},textContent:m,textPosition:g,parent:{page:{pageNumber:y}}}=t;if(!m||m.length===0)return null;n=t={annotationType:yt.FREETEXT,color:Array.from(h),fontSize:l,value:m.join(`
`),position:g,pageIndex:y-1,rect:c.slice(0),rotation:d,id:u,deleted:!1,popupRef:p}}const r=await super.deserialize(t,i,s);return v(r,Ye,t.fontSize),v(r,Pi,ht.makeHexColor(...t.color)),v(r,Xe,E(o=Nt,js,Nd).call(o,t.value)),r.annotationElementId=t.id||null,r._initialData=n,r}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Nt._internalPadding*this.parentScale,s=this.getRect(i,i),n=Gt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:a(this,Pi)),r={annotationType:yt.FREETEXT,color:n,fontSize:a(this,Ye),value:E(this,te,Ep).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?r:this.annotationElementId&&!E(this,te,xp).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){const i=super.renderAnnotationElement(t);if(this.deleted)return i;const{style:s}=i;s.fontSize=`calc(${a(this,Ye)}px * var(--scale-factor))`,s.color=a(this,Pi),i.replaceChildren();for(const r of a(this,Xe).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),i.append(o)}const n=Nt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(n,n),popupContent:a(this,Xe)}),i}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Pi=new WeakMap,Xe=new WeakMap,Vl=new WeakMap,Ar=new WeakMap,Ye=new WeakMap,te=new WeakSet,_p=function(t){const i=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--scale-factor))`,this.translate(0,-(n-a(this,Ye))*this.parentScale),v(this,Ye,n),E(this,te,jh).call(this)},s=a(this,Ye);this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Et.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Ap=function(t){const i=n=>{v(this,Pi,this.editorDiv.style.color=n)},s=a(this,Pi);this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Et.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Sp=function(){var s;const t=[];this.editorDiv.normalize();let i=null;for(const n of this.editorDiv.childNodes)(i==null?void 0:i.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(E(s=Nt,js,Gh).call(s,n)),i=n);return t.join(`
`)},jh=function(){const[t,i]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:n,div:r}=this,o=r.style.display,l=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",n.div.append(this.div),s=r.getBoundingClientRect(),r.remove(),r.style.display=o,r.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/i):(this.width=s.height/t,this.height=s.width/i),this.fixAndSetPosition()},js=new WeakSet,Gh=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Eh,"")},Wh=function(){if(this.editorDiv.replaceChildren(),!!a(this,Xe))for(const t of a(this,Xe).split(`
`)){const i=document.createElement("div");i.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(i)}},Ep=function(){return a(this,Xe).replaceAll(""," ")},Nd=function(t){return t.replaceAll(" ","")},xp=function(t){const{value:i,fontSize:s,color:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||t.value!==i||t.fontSize!==s||t.color.some((o,l)=>o!==n[l])||t.pageIndex!==r},S(Nt,js),ut(Nt,"_freeTextDefaultContent",""),ut(Nt,"_internalPadding",0),ut(Nt,"_defaultColor",null),ut(Nt,"_defaultFontSize",10),ut(Nt,"_type","freetext"),ut(Nt,"_editorType",yt.FREETEXT);let Od=Nt;class rt{toSVGPath(){Ft("Abstract method `toSVGPath` must be implemented.")}get box(){Ft("Abstract getter `box` must be implemented.")}serialize(e,t){Ft("Abstract method `serialize` must be implemented.")}static _rescale(e,t,i,s,n,r){r||(r=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)r[o]=t+e[o]*s,r[o+1]=i+e[o+1]*n;return r}static _rescaleAndSwap(e,t,i,s,n,r){r||(r=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)r[o]=t+e[o+1]*s,r[o+1]=i+e[o]*n;return r}static _translate(e,t,i,s){s||(s=new Float32Array(e.length));for(let n=0,r=e.length;n<r;n+=2)s[n]=t+e[n],s[n+1]=i+e[n+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,i,s,n){switch(n){case 90:return[1-t/i,e/s];case 180:return[1-e/i,1-t/s];case 270:return[t/i,1-e/s];default:return[e/i,t/s]}}static _normalizePagePoint(e,t,i){switch(i){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,i,s,n,r){return[(e+5*i)/6,(t+5*s)/6,(5*i+n)/6,(5*s+r)/6,(i+n)/2,(s+r)/2]}}ut(rt,"PRECISION",1e-4);var Ke,Ri,Ha,Ua,es,At,Sr,Er,Xl,Yl,$a,ja,pn,Kl,Sc,Ec,re,To,Cp,kp,Tp,Pp,Rp,Ip;const ps=class ps{constructor({x:e,y:t},i,s,n,r,o=0){S(this,re);S(this,Ke);S(this,Ri,[]);S(this,Ha);S(this,Ua);S(this,es,[]);S(this,At,new Float32Array(18));S(this,Sr);S(this,Er);S(this,Xl);S(this,Yl);S(this,$a);S(this,ja);S(this,pn,[]);v(this,Ke,i),v(this,ja,n*s),v(this,Ua,r),a(this,At).set([NaN,NaN,NaN,NaN,e,t],6),v(this,Ha,o),v(this,Yl,a(ps,Kl)*s),v(this,Xl,a(ps,Ec)*s),v(this,$a,s),a(this,pn).push(e,t)}isEmpty(){return isNaN(a(this,At)[8])}add({x:e,y:t}){var D;v(this,Sr,e),v(this,Er,t);const[i,s,n,r]=a(this,Ke);let[o,l,h,c]=a(this,At).subarray(8,12);const d=e-h,u=t-c,p=Math.hypot(d,u);if(p<a(this,Xl))return!1;const m=p-a(this,Yl),g=m/p,y=g*d,b=g*u;let _=o,x=l;o=h,l=c,h+=y,c+=b,(D=a(this,pn))==null||D.push(e,t);const C=-b/m,k=y/m,M=C*a(this,ja),L=k*a(this,ja);return a(this,At).set(a(this,At).subarray(2,8),0),a(this,At).set([h+M,c+L],4),a(this,At).set(a(this,At).subarray(14,18),12),a(this,At).set([h-M,c-L],16),isNaN(a(this,At)[6])?(a(this,es).length===0&&(a(this,At).set([o+M,l+L],2),a(this,es).push(NaN,NaN,NaN,NaN,(o+M-i)/n,(l+L-s)/r),a(this,At).set([o-M,l-L],14),a(this,Ri).push(NaN,NaN,NaN,NaN,(o-M-i)/n,(l-L-s)/r)),a(this,At).set([_,x,o,l,h,c],6),!this.isEmpty()):(a(this,At).set([_,x,o,l,h,c],6),Math.abs(Math.atan2(x-l,_-o)-Math.atan2(b,y))<Math.PI/2?([o,l,h,c]=a(this,At).subarray(2,6),a(this,es).push(NaN,NaN,NaN,NaN,((o+h)/2-i)/n,((l+c)/2-s)/r),[o,l,_,x]=a(this,At).subarray(14,18),a(this,Ri).push(NaN,NaN,NaN,NaN,((_+o)/2-i)/n,((x+l)/2-s)/r),!0):([_,x,o,l,h,c]=a(this,At).subarray(0,6),a(this,es).push(((_+5*o)/6-i)/n,((x+5*l)/6-s)/r,((5*o+h)/6-i)/n,((5*l+c)/6-s)/r,((o+h)/2-i)/n,((l+c)/2-s)/r),[h,c,o,l,_,x]=a(this,At).subarray(12,18),a(this,Ri).push(((_+5*o)/6-i)/n,((x+5*l)/6-s)/r,((5*o+h)/6-i)/n,((5*l+c)/6-s)/r,((o+h)/2-i)/n,((l+c)/2-s)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const e=a(this,es),t=a(this,Ri);if(isNaN(a(this,At)[6])&&!this.isEmpty())return E(this,re,Cp).call(this);const i=[];i.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);E(this,re,Tp).call(this,i);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return E(this,re,kp).call(this,i),i.join(" ")}newFreeDrawOutline(e,t,i,s,n,r){return new Lp(e,t,i,s,n,r)}getOutlines(){var d;const e=a(this,es),t=a(this,Ri),i=a(this,At),[s,n,r,o]=a(this,Ke),l=new Float32Array((((d=a(this,pn))==null?void 0:d.length)??0)+2);for(let u=0,p=l.length-2;u<p;u+=2)l[u]=(a(this,pn)[u]-s)/r,l[u+1]=(a(this,pn)[u+1]-n)/o;if(l[l.length-2]=(a(this,Sr)-s)/r,l[l.length-1]=(a(this,Er)-n)/o,isNaN(i[6])&&!this.isEmpty())return E(this,re,Pp).call(this,l);const h=new Float32Array(a(this,es).length+24+a(this,Ri).length);let c=e.length;for(let u=0;u<c;u+=2){if(isNaN(e[u])){h[u]=h[u+1]=NaN;continue}h[u]=e[u],h[u+1]=e[u+1]}c=E(this,re,Ip).call(this,h,c);for(let u=t.length-6;u>=6;u-=6)for(let p=0;p<6;p+=2){if(isNaN(t[u+p])){h[c]=h[c+1]=NaN,c+=2;continue}h[c]=t[u+p],h[c+1]=t[u+p+1],c+=2}return E(this,re,Rp).call(this,h,c),this.newFreeDrawOutline(h,l,a(this,Ke),a(this,$a),a(this,Ha),a(this,Ua))}};Ke=new WeakMap,Ri=new WeakMap,Ha=new WeakMap,Ua=new WeakMap,es=new WeakMap,At=new WeakMap,Sr=new WeakMap,Er=new WeakMap,Xl=new WeakMap,Yl=new WeakMap,$a=new WeakMap,ja=new WeakMap,pn=new WeakMap,Kl=new WeakMap,Sc=new WeakMap,Ec=new WeakMap,re=new WeakSet,To=function(){const e=a(this,At).subarray(4,6),t=a(this,At).subarray(16,18),[i,s,n,r]=a(this,Ke);return[(a(this,Sr)+(e[0]-t[0])/2-i)/n,(a(this,Er)+(e[1]-t[1])/2-s)/r,(a(this,Sr)+(t[0]-e[0])/2-i)/n,(a(this,Er)+(t[1]-e[1])/2-s)/r]},Cp=function(){const[e,t,i,s]=a(this,Ke),[n,r,o,l]=E(this,re,To).call(this);return`M${(a(this,At)[2]-e)/i} ${(a(this,At)[3]-t)/s} L${(a(this,At)[4]-e)/i} ${(a(this,At)[5]-t)/s} L${n} ${r} L${o} ${l} L${(a(this,At)[16]-e)/i} ${(a(this,At)[17]-t)/s} L${(a(this,At)[14]-e)/i} ${(a(this,At)[15]-t)/s} Z`},kp=function(e){const t=a(this,Ri);e.push(`L${t[4]} ${t[5]} Z`)},Tp=function(e){const[t,i,s,n]=a(this,Ke),r=a(this,At).subarray(4,6),o=a(this,At).subarray(16,18),[l,h,c,d]=E(this,re,To).call(this);e.push(`L${(r[0]-t)/s} ${(r[1]-i)/n} L${l} ${h} L${c} ${d} L${(o[0]-t)/s} ${(o[1]-i)/n}`)},Pp=function(e){const t=a(this,At),[i,s,n,r]=a(this,Ke),[o,l,h,c]=E(this,re,To).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-i)/n,(t[3]-s)/r,NaN,NaN,NaN,NaN,(t[4]-i)/n,(t[5]-s)/r,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(t[16]-i)/n,(t[17]-s)/r,NaN,NaN,NaN,NaN,(t[14]-i)/n,(t[15]-s)/r],0),this.newFreeDrawOutline(d,e,a(this,Ke),a(this,$a),a(this,Ha),a(this,Ua))},Rp=function(e,t){const i=a(this,Ri);return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6},Ip=function(e,t){const i=a(this,At).subarray(4,6),s=a(this,At).subarray(16,18),[n,r,o,l]=a(this,Ke),[h,c,d,u]=E(this,re,To).call(this);return e.set([NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-r)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-r)/l],t),t+=24},S(ps,Kl,8),S(ps,Sc,2),S(ps,Ec,a(ps,Kl)+a(ps,Sc));let rc=ps;var Ga,xr,Ms,Zl,Ze,Ql,Yt,xc,Mp;class Lp extends rt{constructor(t,i,s,n,r,o){super();S(this,xc);S(this,Ga);S(this,xr,new Float32Array(4));S(this,Ms);S(this,Zl);S(this,Ze);S(this,Ql);S(this,Yt);v(this,Yt,t),v(this,Ze,i),v(this,Ga,s),v(this,Ql,n),v(this,Ms,r),v(this,Zl,o),this.lastPoint=[NaN,NaN],E(this,xc,Mp).call(this,o);const[l,h,c,d]=a(this,xr);for(let u=0,p=t.length;u<p;u+=2)t[u]=(t[u]-l)/c,t[u+1]=(t[u+1]-h)/d;for(let u=0,p=i.length;u<p;u+=2)i[u]=(i[u]-l)/c,i[u+1]=(i[u+1]-h)/d}toSVGPath(){const t=[`M${a(this,Yt)[4]} ${a(this,Yt)[5]}`];for(let i=6,s=a(this,Yt).length;i<s;i+=6){if(isNaN(a(this,Yt)[i])){t.push(`L${a(this,Yt)[i+4]} ${a(this,Yt)[i+5]}`);continue}t.push(`C${a(this,Yt)[i]} ${a(this,Yt)[i+1]} ${a(this,Yt)[i+2]} ${a(this,Yt)[i+3]} ${a(this,Yt)[i+4]} ${a(this,Yt)[i+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,i,s,n],r){const o=s-t,l=n-i;let h,c;switch(r){case 0:h=rt._rescale(a(this,Yt),t,n,o,-l),c=rt._rescale(a(this,Ze),t,n,o,-l);break;case 90:h=rt._rescaleAndSwap(a(this,Yt),t,i,o,l),c=rt._rescaleAndSwap(a(this,Ze),t,i,o,l);break;case 180:h=rt._rescale(a(this,Yt),s,i,-o,l),c=rt._rescale(a(this,Ze),s,i,-o,l);break;case 270:h=rt._rescaleAndSwap(a(this,Yt),s,n,-o,-l),c=rt._rescaleAndSwap(a(this,Ze),s,n,-o,-l);break}return{outline:Array.from(h),points:[Array.from(c)]}}get box(){return a(this,xr)}newOutliner(t,i,s,n,r,o=0){return new rc(t,i,s,n,r,o)}getNewOutline(t,i){const[s,n,r,o]=a(this,xr),[l,h,c,d]=a(this,Ga),u=r*c,p=o*d,m=s*c+l,g=n*d+h,y=this.newOutliner({x:a(this,Ze)[0]*u+m,y:a(this,Ze)[1]*p+g},a(this,Ga),a(this,Ql),t,a(this,Zl),i??a(this,Ms));for(let b=2;b<a(this,Ze).length;b+=2)y.add({x:a(this,Ze)[b]*u+m,y:a(this,Ze)[b+1]*p+g});return y.getOutlines()}}Ga=new WeakMap,xr=new WeakMap,Ms=new WeakMap,Zl=new WeakMap,Ze=new WeakMap,Ql=new WeakMap,Yt=new WeakMap,xc=new WeakSet,Mp=function(t){const i=a(this,Yt);let s=i[4],n=i[5],r=s,o=n,l=s,h=n,c=s,d=n;const u=t?Math.max:Math.min;for(let m=6,g=i.length;m<g;m+=6){if(isNaN(i[m]))r=Math.min(r,i[m+4]),o=Math.min(o,i[m+5]),l=Math.max(l,i[m+4]),h=Math.max(h,i[m+5]),d<i[m+5]?(c=i[m+4],d=i[m+5]):d===i[m+5]&&(c=u(c,i[m+4]));else{const y=ht.bezierBoundingBox(s,n,...i.slice(m,m+6));r=Math.min(r,y[0]),o=Math.min(o,y[1]),l=Math.max(l,y[2]),h=Math.max(h,y[3]),d<y[3]?(c=y[2],d=y[3]):d===y[3]&&(c=u(c,y[2]))}s=i[m+4],n=i[m+5]}const p=a(this,xr);p[0]=r-a(this,Ms),p[1]=o-a(this,Ms),p[2]=l-r+2*a(this,Ms),p[3]=h-o+2*a(this,Ms),this.lastPoint=[c,d]};var Jl,th,gn,Ii,Oe,Dp,qh,Fp,Op,zd;class Bd{constructor(e,t=0,i=0,s=!0){S(this,Oe);S(this,Jl);S(this,th);S(this,gn,[]);S(this,Ii,[]);let n=1/0,r=-1/0,o=1/0,l=-1/0;const h=10**-4;for(const{x:y,y:b,width:_,height:x}of e){const C=Math.floor((y-t)/h)*h,k=Math.ceil((y+_+t)/h)*h,M=Math.floor((b-t)/h)*h,L=Math.ceil((b+x+t)/h)*h,N=[C,M,L,!0],D=[k,M,L,!1];a(this,gn).push(N,D),n=Math.min(n,C),r=Math.max(r,k),o=Math.min(o,M),l=Math.max(l,L)}const c=r-n+2*i,d=l-o+2*i,u=n-i,p=o-i,m=a(this,gn).at(s?-1:-2),g=[m[0],m[2]];for(const y of a(this,gn)){const[b,_,x]=y;y[0]=(b-u)/c,y[1]=(_-p)/d,y[2]=(x-p)/d}v(this,Jl,new Float32Array([u,p,c,d])),v(this,th,g)}getOutlines(){a(this,gn).sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);const e=[];for(const t of a(this,gn))t[3]?(e.push(...E(this,Oe,zd).call(this,t)),E(this,Oe,Fp).call(this,t)):(E(this,Oe,Op).call(this,t),e.push(...E(this,Oe,zd).call(this,t)));return E(this,Oe,Dp).call(this,e)}}Jl=new WeakMap,th=new WeakMap,gn=new WeakMap,Ii=new WeakMap,Oe=new WeakSet,Dp=function(e){const t=[],i=new Set;for(const r of e){const[o,l,h]=r;t.push([o,l,r],[o,h,r])}t.sort((r,o)=>r[1]-o[1]||r[0]-o[0]);for(let r=0,o=t.length;r<o;r+=2){const l=t[r][2],h=t[r+1][2];l.push(h),h.push(l),i.add(l),i.add(h)}const s=[];let n;for(;i.size>0;){const r=i.values().next().value;let[o,l,h,c,d]=r;i.delete(r);let u=o,p=l;for(n=[o,h],s.push(n);;){let m;if(i.has(c))m=c;else if(i.has(d))m=d;else break;i.delete(m),[o,l,h,c,d]=m,u!==o&&(n.push(u,p,o,p===l?l:h),u=o),p=p===l?h:l}n.push(u,p)}return new cb(s,a(this,Jl),a(this,th))},qh=function(e){const t=a(this,Ii);let i=0,s=t.length-1;for(;i<=s;){const n=i+s>>1,r=t[n][0];if(r===e)return n;r<e?i=n+1:s=n-1}return s+1},Fp=function([,e,t]){const i=E(this,Oe,qh).call(this,e);a(this,Ii).splice(i,0,[e,t])},Op=function([,e,t]){const i=E(this,Oe,qh).call(this,e);for(let s=i;s<a(this,Ii).length;s++){const[n,r]=a(this,Ii)[s];if(n!==e)break;if(n===e&&r===t){a(this,Ii).splice(s,1);return}}for(let s=i-1;s>=0;s--){const[n,r]=a(this,Ii)[s];if(n!==e)break;if(n===e&&r===t){a(this,Ii).splice(s,1);return}}},zd=function(e){const[t,i,s]=e,n=[[t,i,s]],r=E(this,Oe,qh).call(this,s);for(let o=0;o<r;o++){const[l,h]=a(this,Ii)[o];for(let c=0,d=n.length;c<d;c++){const[,u,p]=n[c];if(!(h<=u||p<=l)){if(u>=l){if(p>h)n[c][1]=h;else{if(d===1)return[];n.splice(c,1),c--,d--}continue}n[c][2]=l,p>h&&n.push([t,h,p])}}}return n};var eh,Wa;class cb extends rt{constructor(t,i,s){super();S(this,eh);S(this,Wa);v(this,Wa,t),v(this,eh,i),this.lastPoint=s}toSVGPath(){const t=[];for(const i of a(this,Wa)){let[s,n]=i;t.push(`M${s} ${n}`);for(let r=2;r<i.length;r+=2){const o=i[r],l=i[r+1];o===s?(t.push(`V${l}`),n=l):l===n&&(t.push(`H${o}`),s=o)}t.push("Z")}return t.join(" ")}serialize([t,i,s,n],r){const o=[],l=s-t,h=n-i;for(const c of a(this,Wa)){const d=new Array(c.length);for(let u=0;u<c.length;u+=2)d[u]=t+c[u]*l,d[u+1]=n-c[u+1]*h;o.push(d)}return o}get box(){return a(this,eh)}get classNamesForOutlining(){return["highlightOutline"]}}eh=new WeakMap,Wa=new WeakMap;class Hd extends rc{newFreeDrawOutline(e,t,i,s,n,r){return new db(e,t,i,s,n,r)}}class db extends Lp{newOutliner(e,t,i,s,n,r=0){return new Hd(e,t,i,s,n,r)}}var Li,Cr,qa,ne,ih,Va,sh,nh,mn,Mi,Xa,rh,Mt,Ud,$d,jd,Ln,Np,qs;const ze=class ze{constructor({editor:e=null,uiManager:t=null}){S(this,Mt);S(this,Li,null);S(this,Cr,null);S(this,qa);S(this,ne,null);S(this,ih,!1);S(this,Va,!1);S(this,sh,null);S(this,nh);S(this,mn,null);S(this,Mi,null);S(this,Xa);var i;e?(v(this,Va,!1),v(this,Xa,Et.HIGHLIGHT_COLOR),v(this,sh,e)):(v(this,Va,!0),v(this,Xa,Et.HIGHLIGHT_DEFAULT_COLOR)),v(this,Mi,(e==null?void 0:e._uiManager)||t),v(this,nh,a(this,Mi)._eventBus),v(this,qa,(e==null?void 0:e.color)||((i=a(this,Mi))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),a(ze,rh)||v(ze,rh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return St(this,"_keyboardManager",new ph([[["Escape","mac+Escape"],ze.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ze.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ze.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ze.prototype._moveToPrevious],[["Home","mac+Home"],ze.prototype._moveToBeginning],[["End","mac+End"],ze.prototype._moveToEnd]]))}renderButton(){const e=v(this,Li,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=a(this,Mi)._signal;e.addEventListener("click",E(this,Mt,Ln).bind(this),{signal:t}),e.addEventListener("keydown",E(this,Mt,jd).bind(this),{signal:t});const i=v(this,Cr,document.createElement("span"));return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=a(this,qa),e.append(i),e}renderMainDropdown(){const e=v(this,ne,E(this,Mt,Ud).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===a(this,Li)){E(this,Mt,Ln).call(this,e);return}const t=e.target.getAttribute("data-color");t&&E(this,Mt,$d).call(this,t,e)}_moveToNext(e){var t,i;if(!a(this,Mt,qs)){E(this,Mt,Ln).call(this,e);return}if(e.target===a(this,Li)){(t=a(this,ne).firstChild)==null||t.focus();return}(i=e.target.nextSibling)==null||i.focus()}_moveToPrevious(e){var t,i;if(e.target===((t=a(this,ne))==null?void 0:t.firstChild)||e.target===a(this,Li)){a(this,Mt,qs)&&this._hideDropdownFromKeyboard();return}a(this,Mt,qs)||E(this,Mt,Ln).call(this,e),(i=e.target.previousSibling)==null||i.focus()}_moveToBeginning(e){var t;if(!a(this,Mt,qs)){E(this,Mt,Ln).call(this,e);return}(t=a(this,ne).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!a(this,Mt,qs)){E(this,Mt,Ln).call(this,e);return}(t=a(this,ne).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=a(this,ne))==null||e.classList.add("hidden"),(t=a(this,mn))==null||t.abort(),v(this,mn,null)}_hideDropdownFromKeyboard(){var e;if(!a(this,Va)){if(!a(this,Mt,qs)){(e=a(this,sh))==null||e.unselect();return}this.hideDropdown(),a(this,Li).focus({preventScroll:!0,focusVisible:a(this,ih)})}}updateColor(e){if(a(this,Cr)&&(a(this,Cr).style.backgroundColor=e),!a(this,ne))return;const t=a(this,Mi).highlightColors.values();for(const i of a(this,ne).children)i.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=a(this,Li))==null||e.remove(),v(this,Li,null),v(this,Cr,null),(t=a(this,ne))==null||t.remove(),v(this,ne,null)}};Li=new WeakMap,Cr=new WeakMap,qa=new WeakMap,ne=new WeakMap,ih=new WeakMap,Va=new WeakMap,sh=new WeakMap,nh=new WeakMap,mn=new WeakMap,Mi=new WeakMap,Xa=new WeakMap,rh=new WeakMap,Mt=new WeakSet,Ud=function(){const e=document.createElement("div"),t=a(this,Mi)._signal;e.addEventListener("contextmenu",Bi,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[i,s]of a(this,Mi).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",a(ze,rh)[i]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=s,n.setAttribute("aria-selected",s===a(this,qa)),n.addEventListener("click",E(this,Mt,$d).bind(this,s),{signal:t}),e.append(n)}return e.addEventListener("keydown",E(this,Mt,jd).bind(this),{signal:t}),e},$d=function(e,t){t.stopPropagation(),a(this,nh).dispatch("switchannotationeditorparams",{source:this,type:a(this,Xa),value:e})},jd=function(e){ze._keyboardManager.exec(this,e)},Ln=function(e){if(a(this,Mt,qs)){this.hideDropdown();return}if(v(this,ih,e.detail===0),a(this,mn)||(v(this,mn,new AbortController),window.addEventListener("pointerdown",E(this,Mt,Np).bind(this),{signal:a(this,Mi).combinedSignal(a(this,mn))})),a(this,ne)){a(this,ne).classList.remove("hidden");return}const t=v(this,ne,E(this,Mt,Ud).call(this));a(this,Li).append(t)},Np=function(e){var t;(t=a(this,ne))!=null&&t.contains(e.target)||this.hideDropdown()},qs=function(){return a(this,ne)&&!a(this,ne).classList.contains("hidden")},S(ze,rh,null);let ac=ze;var Ya,ah,Ds,kr,Ka,$e,oh,lh,Tr,di,Qe,pe,Za,Fs,Se,Qa,ui,hh,gt,Gd,Vh,Bp,zp,Hp,Wd,Mn,mi,Zr,Up,Xh,Po,$p,jp,Gp,Wp,qp;const Pt=class Pt extends Gt{constructor(t){super({...t,name:"highlightEditor"});S(this,gt);S(this,Ya,null);S(this,ah,0);S(this,Ds);S(this,kr,null);S(this,Ka,null);S(this,$e,null);S(this,oh,null);S(this,lh,0);S(this,Tr,null);S(this,di,null);S(this,Qe,null);S(this,pe,!1);S(this,Za,null);S(this,Fs);S(this,Se,null);S(this,Qa,"");S(this,ui);S(this,hh,"");this.color=t.color||Pt._defaultColor,v(this,ui,t.thickness||Pt._defaultThickness),v(this,Fs,t.opacity||Pt._defaultOpacity),v(this,Ds,t.boxes||null),v(this,hh,t.methodOfCreation||""),v(this,Qa,t.text||""),this._isDraggable=!1,t.highlightId>-1?(v(this,pe,!0),E(this,gt,Vh).call(this,t),E(this,gt,Mn).call(this)):a(this,Ds)&&(v(this,Ya,t.anchorNode),v(this,ah,t.anchorOffset),v(this,oh,t.focusNode),v(this,lh,t.focusOffset),E(this,gt,Gd).call(this),E(this,gt,Mn).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=Pt.prototype;return St(this,"_keyboardManager",new ph([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:a(this,pe)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:a(this,ui),methodOfCreation:a(this,hh)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,i){var s;Gt.initialize(t,i),Pt._defaultColor||(Pt._defaultColor=((s=i.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(t,i){switch(t){case Et.HIGHLIGHT_DEFAULT_COLOR:Pt._defaultColor=i;break;case Et.HIGHLIGHT_THICKNESS:Pt._defaultThickness=i;break}}translateInPage(t,i){}get toolbarPosition(){return a(this,Za)}updateParams(t,i){switch(t){case Et.HIGHLIGHT_COLOR:E(this,gt,Bp).call(this,i);break;case Et.HIGHLIGHT_THICKNESS:E(this,gt,zp).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[Et.HIGHLIGHT_DEFAULT_COLOR,Pt._defaultColor],[Et.HIGHLIGHT_THICKNESS,Pt._defaultThickness]]}get propertiesToUpdate(){return[[Et.HIGHLIGHT_COLOR,this.color||Pt._defaultColor],[Et.HIGHLIGHT_THICKNESS,a(this,ui)||Pt._defaultThickness],[Et.HIGHLIGHT_FREE,a(this,pe)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(v(this,Ka,new ac({editor:this})),t.addColorPicker(a(this,Ka))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(E(this,gt,Po).call(this))}getBaseTranslation(){return[0,0]}getRect(t,i){return super.getRect(t,i,E(this,gt,Po).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){E(this,gt,Wd).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,gt,Mn).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let i=!1;this.parent&&!t?E(this,gt,Wd).call(this):t&&(E(this,gt,Mn).call(this,t),i=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),i&&this.select()}rotate(t){var n,r,o;const{drawLayer:i}=this.parent;let s;a(this,pe)?(t=(t-this.rotation+360)%360,s=E(n=Pt,mi,Zr).call(n,a(this,di).box,t)):s=E(r=Pt,mi,Zr).call(r,[this.x,this.y,this.width,this.height],t),i.updateProperties(a(this,Qe),{bbox:s,root:{"data-main-rotation":t}}),i.updateProperties(a(this,Se),{bbox:E(o=Pt,mi,Zr).call(o,a(this,$e).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();a(this,Qa)&&(t.setAttribute("aria-label",a(this,Qa)),t.setAttribute("role","mark")),a(this,pe)?t.classList.add("free"):this.div.addEventListener("keydown",E(this,gt,Up).bind(this),{signal:this._uiManager._signal});const i=v(this,Tr,document.createElement("div"));t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=a(this,kr);const[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),ic(this,a(this,Tr),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,Se),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,Se),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:E(this,gt,Xh).call(this,!0);break;case 1:case 3:E(this,gt,Xh).call(this,!1);break}}select(){var t;super.select(),a(this,Se)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,Se),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),a(this,Se)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,Se),{rootClass:{selected:!1}}),a(this,pe)||E(this,gt,Xh).call(this,!1))}get _mustFixPosition(){return!a(this,pe)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(a(this,Qe),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(a(this,Se),{rootClass:{hidden:!t}}))}static startHighlighting(t,i,{target:s,x:n,y:r}){const{x:o,y:l,width:h,height:c}=s.getBoundingClientRect(),d=new AbortController,u=t.combinedSignal(d),p=m=>{d.abort(),E(this,mi,Wp).call(this,t,m)};window.addEventListener("blur",p,{signal:u}),window.addEventListener("pointerup",p,{signal:u}),window.addEventListener("pointerdown",ni,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",Bi,{signal:u}),s.addEventListener("pointermove",E(this,mi,Gp).bind(this,t),{signal:u}),this._freeHighlight=new Hd({x:n,y:r},[o,l,h,c],t.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,i,s){var g,y,b,_;let n=null;if(t instanceof yp){const{data:{quadPoints:x,rect:C,rotation:k,id:M,color:L,opacity:N,popupRef:D},parent:{page:{pageNumber:G}}}=t;n=t={annotationType:yt.HIGHLIGHT,color:Array.from(L),opacity:N,quadPoints:x,boxes:null,pageIndex:G-1,rect:C.slice(0),rotation:k,id:M,deleted:!1,popupRef:D}}else if(t instanceof yu){const{data:{inkLists:x,rect:C,rotation:k,id:M,color:L,borderStyle:{rawWidth:N},popupRef:D},parent:{page:{pageNumber:G}}}=t;n=t={annotationType:yt.HIGHLIGHT,color:Array.from(L),thickness:N,inkLists:x,boxes:null,pageIndex:G-1,rect:C.slice(0),rotation:k,id:M,deleted:!1,popupRef:D}}const{color:r,quadPoints:o,inkLists:l,opacity:h}=t,c=await super.deserialize(t,i,s);c.color=ht.makeHexColor(...r),v(c,Fs,h||1),l&&v(c,ui,t.thickness),c.annotationElementId=t.id||null,c._initialData=n;const[d,u]=c.pageDimensions,[p,m]=c.pageTranslation;if(o){const x=v(c,Ds,[]);for(let C=0;C<o.length;C+=8)x.push({x:(o[C]-p)/d,y:1-(o[C+1]-m)/u,width:(o[C+2]-o[C])/d,height:(o[C+1]-o[C+5])/u});E(g=c,gt,Gd).call(g),E(y=c,gt,Mn).call(y),c.rotate(c.rotation)}else if(l){v(c,pe,!0);const x=l[0],C={x:x[0]-p,y:u-(x[1]-m)},k=new Hd(C,[0,0,d,u],1,a(c,ui)/2,!0,.001);for(let N=0,D=x.length;N<D;N+=2)C.x=x[N]-p,C.y=u-(x[N+1]-m),k.add(C);const{id:M,clipPathId:L}=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:k.toSVGPath()}},!0,!0);E(b=c,gt,Vh).call(b,{highlightOutlines:k.getOutlines(),highlightId:M,clipPathId:L}),E(_=c,gt,Mn).call(_)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const i=this.getRect(0,0),s=Gt._colorManager.convert(this.color),n={annotationType:yt.HIGHLIGHT,color:s,opacity:a(this,Fs),thickness:a(this,ui),quadPoints:E(this,gt,$p).call(this),outlines:E(this,gt,jp).call(this,i),pageIndex:this.pageIndex,rect:i,rotation:E(this,gt,Po).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!E(this,gt,qp).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ya=new WeakMap,ah=new WeakMap,Ds=new WeakMap,kr=new WeakMap,Ka=new WeakMap,$e=new WeakMap,oh=new WeakMap,lh=new WeakMap,Tr=new WeakMap,di=new WeakMap,Qe=new WeakMap,pe=new WeakMap,Za=new WeakMap,Fs=new WeakMap,Se=new WeakMap,Qa=new WeakMap,ui=new WeakMap,hh=new WeakMap,gt=new WeakSet,Gd=function(){const t=new Bd(a(this,Ds),.001);v(this,di,t.getOutlines()),[this.x,this.y,this.width,this.height]=a(this,di).box;const i=new Bd(a(this,Ds),.0025,.001,this._uiManager.direction==="ltr");v(this,$e,i.getOutlines());const{lastPoint:s}=a(this,$e);v(this,Za,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},Vh=function({highlightOutlines:t,highlightId:i,clipPathId:s}){var d,u;if(v(this,di,t),v(this,$e,t.getNewOutline(a(this,ui)/2+1.5,.0025)),i>=0)v(this,Qe,i),v(this,kr,s),this.parent.drawLayer.finalizeDraw(i,{bbox:t.box,path:{d:t.toSVGPath()}}),v(this,Se,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:a(this,$e).box,path:{d:a(this,$e).toSVGPath()}},!0));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(a(this,Qe),{bbox:E(d=Pt,mi,Zr).call(d,a(this,di).box,(p-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(a(this,Se),{bbox:E(u=Pt,mi,Zr).call(u,a(this,$e).box,p),path:{d:a(this,$e).toSVGPath()}})}const[r,o,l,h]=t.box;switch(this.rotation){case 0:this.x=r,this.y=o,this.width=l,this.height=h;break;case 90:{const[p,m]=this.parentDimensions;this.x=o,this.y=1-r,this.width=l*m/p,this.height=h*p/m;break}case 180:this.x=1-r,this.y=1-o,this.width=l,this.height=h;break;case 270:{const[p,m]=this.parentDimensions;this.x=1-o,this.y=r,this.width=l*m/p,this.height=h*p/m;break}}const{lastPoint:c}=a(this,$e);v(this,Za,[(c[0]-r)/l,(c[1]-o)/h])},Bp=function(t){const i=(r,o)=>{var l,h;this.color=r,v(this,Fs,o),(l=this.parent)==null||l.drawLayer.updateProperties(a(this,Qe),{root:{fill:r,"fill-opacity":o}}),(h=a(this,Ka))==null||h.updateColor(r)},s=this.color,n=a(this,Fs);this.addCommands({cmd:i.bind(this,t,Pt._defaultOpacity),undo:i.bind(this,s,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Et.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},zp=function(t){const i=a(this,ui),s=n=>{v(this,ui,n),E(this,gt,Hp).call(this,n)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Et.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},Hp=function(t){if(!a(this,pe))return;E(this,gt,Vh).call(this,{highlightOutlines:a(this,di).getNewOutline(t/2)}),this.fixAndSetPosition();const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)},Wd=function(){a(this,Qe)===null||!this.parent||(this.parent.drawLayer.remove(a(this,Qe)),v(this,Qe,null),this.parent.drawLayer.remove(a(this,Se)),v(this,Se,null))},Mn=function(t=this.parent){a(this,Qe)===null&&({id:ke(this,Qe)._,clipPathId:ke(this,kr)._}=t.drawLayer.draw({bbox:a(this,di).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":a(this,Fs)},rootClass:{highlight:!0,free:a(this,pe)},path:{d:a(this,di).toSVGPath()}},!1,!0),v(this,Se,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:a(this,pe)},bbox:a(this,$e).box,path:{d:a(this,$e).toSVGPath()}},a(this,pe))),a(this,Tr)&&(a(this,Tr).style.clipPath=a(this,kr)))},mi=new WeakSet,Zr=function([t,i,s,n],r){switch(r){case 90:return[1-i-n,t,n,s];case 180:return[1-t-s,1-i-n,s,n];case 270:return[i,1-t-s,n,s]}return[t,i,s,n]},Up=function(t){Pt._keyboardManager.exec(this,t)},Xh=function(t){if(!a(this,Ya))return;const i=window.getSelection();t?i.setPosition(a(this,Ya),a(this,ah)):i.setPosition(a(this,oh),a(this,lh))},Po=function(){return a(this,pe)?this.rotation:0},$p=function(){if(a(this,pe))return null;const[t,i]=this.pageDimensions,[s,n]=this.pageTranslation,r=a(this,Ds),o=new Float32Array(r.length*8);let l=0;for(const{x:h,y:c,width:d,height:u}of r){const p=h*t+s,m=(1-c)*i+n;o[l]=o[l+4]=p,o[l+1]=o[l+3]=m,o[l+2]=o[l+6]=p+d*t,o[l+5]=o[l+7]=m-u*i,l+=8}return o},jp=function(t){return a(this,di).serialize(t,E(this,gt,Po).call(this))},Gp=function(t,i){this._freeHighlight.add(i)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Wp=function(t,i){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},qp=function(t){const{color:i}=this._initialData;return t.color.some((s,n)=>s!==i[n])},S(Pt,mi),ut(Pt,"_defaultColor",null),ut(Pt,"_defaultOpacity",1),ut(Pt,"_defaultThickness",12),ut(Pt,"_type","highlight"),ut(Pt,"_editorType",yt.HIGHLIGHT),ut(Pt,"_freeHighlightId",-1),ut(Pt,"_freeHighlight",null),ut(Pt,"_freeHighlightClipId","");let oc=Pt;var Pr;class ub{constructor(){S(this,Pr,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,i]of Object.entries(e))this.updateProperty(t,i)}updateSVGProperty(e,t){a(this,Pr)[e]=t}toSVGProperties(){const e=a(this,Pr);return v(this,Pr,Object.create(null)),{root:e}}reset(){v(this,Pr,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Ft("Not implemented")}}Pr=new WeakMap;var Je,Ja,he,Rr,Ir,bn,yn,vn,Lr,kt,Vd,Xd,Yd,Ro,Vp,Yh,Io,Qr;const at=class at extends Gt{constructor(t){super(t);S(this,kt);S(this,Je,null);S(this,Ja);ut(this,"_drawId",null);v(this,Ja,t.mustBeCommitted||!1),t.drawOutlines&&(E(this,kt,Vd).call(this,t),E(this,kt,Ro).call(this))}static _mergeSVGProperties(t,i){const s=new Set(Object.keys(t));for(const[n,r]of Object.entries(i))s.has(n)?Object.assign(t[n],r):t[n]=r;return t}static getDefaultDrawingOptions(t){Ft("Not implemented")}static get typesMap(){Ft("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,i){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,i),this._currentParent&&(a(at,he).updateProperty(s,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,i){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,i)}static get defaultPropertiesToUpdate(){const t=[],i=this._defaultDrawingOptions;for(const[s,n]of this.typesMap)t.push([s,i[n]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:i}=this;for(const[s,n]of this.constructor.typesMap)t.push([s,i[n]]);return t}_updateProperty(t,i,s){const n=this._drawingOptions,r=n[i],o=l=>{var c;n.updateProperty(i,l);const h=a(this,Je).updateProperty(i,l);h&&E(this,kt,Io).call(this,h),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:o.bind(this,s),undo:o.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,at._mergeSVGProperties(a(this,Je).getPathResizingSVGProperties(E(this,kt,Yh).call(this)),{bbox:E(this,kt,Qr).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,at._mergeSVGProperties(a(this,Je).getPathResizedSVGProperties(E(this,kt,Yh).call(this)),{bbox:E(this,kt,Qr).call(this)}))}_onTranslating(t,i){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:E(this,kt,Qr).call(this,t,i)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,at._mergeSVGProperties(a(this,Je).getPathTranslatedSVGProperties(E(this,kt,Yh).call(this),this.parentDimensions),{bbox:E(this,kt,Qr).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,a(this,Ja)&&(v(this,Ja,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){E(this,kt,Yd).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,kt,Ro).call(this),E(this,kt,Io).call(this,a(this,Je).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let i=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),E(this,kt,Yd).call(this)):t&&(this._uiManager.addShouldRescale(this),E(this,kt,Ro).call(this,t),i=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),i&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,at._mergeSVGProperties({bbox:E(this,kt,Qr).call(this)},a(this,Je).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&E(this,kt,Io).call(this,a(this,Je).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const i=document.createElement("div");t.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,i,s,n,r){Ft("Not implemented")}static startDrawing(t,i,s,n){var y;const{target:r,offsetX:o,offsetY:l,pointerId:h,pointerType:c}=n;if(a(at,yn)&&a(at,yn)!==c)return;const{viewport:{rotation:d}}=t,{width:u,height:p}=r.getBoundingClientRect(),m=v(at,Rr,new AbortController),g=t.combinedSignal(m);if(a(at,bn)||v(at,bn,h),a(at,yn)??v(at,yn,c),window.addEventListener("pointerup",b=>{var _;a(at,bn)===b.pointerId?this._endDraw(b):(_=a(at,vn))==null||_.delete(b.pointerId)},{signal:g}),window.addEventListener("pointercancel",b=>{var _;a(at,bn)===b.pointerId?this._currentParent.endDrawingSession():(_=a(at,vn))==null||_.delete(b.pointerId)},{signal:g}),window.addEventListener("pointerdown",b=>{a(at,yn)===b.pointerType&&((a(at,vn)||v(at,vn,new Set)).add(b.pointerId),a(at,he).isCancellable()&&(a(at,he).removeLastElement(),a(at,he).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",Bi,{signal:g}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),r.addEventListener("touchmove",b=>{b.timeStamp===a(at,Lr)&&ni(b)},{signal:g}),t.toggleDrawing(),(y=i._editorUndoBar)==null||y.hide(),a(at,he)){t.drawLayer.updateProperties(this._currentDrawId,a(at,he).startNew(o,l,u,p,d));return}i.updateUIForDefaultProperties(this),v(at,he,this.createDrawerInstance(o,l,u,p,d)),v(at,Ir,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(a(at,Ir).toSVGProperties(),a(at,he).defaultSVGProperties),!0,!1)}static _drawMove(t){var r;if(v(at,Lr,-1),!a(at,he))return;const{offsetX:i,offsetY:s,pointerId:n}=t;if(a(at,bn)===n){if(((r=a(at,vn))==null?void 0:r.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,a(at,he).add(i,s)),v(at,Lr,t.timeStamp),ni(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,v(at,he,null),v(at,Ir,null),v(at,yn,null),v(at,Lr,NaN)),a(at,Rr)&&(a(at,Rr).abort(),v(at,Rr,null),v(at,bn,NaN),v(at,vn,null))}static _endDraw(t){const i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),t&&i.drawLayer.updateProperties(this._currentDrawId,a(at,he).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=a(at,he),n=this._currentDrawId,r=s.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(n,s.setLastElement(r))},undo:()=>{i.drawLayer.updateProperties(n,s.removeLastElement())},mustExec:!1,type:Et.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(Et.DRAW_STEP),!a(at,he).isEmpty()){const{pageDimensions:[s,n],scale:r}=i,o=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:a(at,he).getOutlines(s*r,n*r,r,this._INNER_MARGIN),drawingOptions:a(at,Ir),mustBeCommitted:!t});return this._cleanup(!0),o}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,i,s,n,r,o){Ft("Not implemented")}static async deserialize(t,i,s){var d,u;const{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:l}}=i.viewport,h=this.deserializeDraw(o,l,n,r,this._INNER_MARGIN,t),c=await super.deserialize(t,i,s);return c.createDrawingOptions(t),E(d=c,kt,Vd).call(d,{drawOutlines:h}),E(u=c,kt,Ro).call(u),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[i,s]=this.pageTranslation,[n,r]=this.pageDimensions;return a(this,Je).serialize([i,s,n,r],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Je=new WeakMap,Ja=new WeakMap,he=new WeakMap,Rr=new WeakMap,Ir=new WeakMap,bn=new WeakMap,yn=new WeakMap,vn=new WeakMap,Lr=new WeakMap,kt=new WeakSet,Vd=function({drawOutlines:t,drawId:i,drawingOptions:s}){v(this,Je,t),this._drawingOptions||(this._drawingOptions=s),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,t.defaultProperties)):this._drawId=E(this,kt,Xd).call(this,t,this.parent),E(this,kt,Io).call(this,t.box)},Xd=function(t,i){const{id:s}=i.drawLayer.draw(at._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s},Yd=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Ro=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=E(this,kt,Xd).call(this,a(this,Je),t)}},Vp=function([t,i,s,n]){const{parentDimensions:[r,o],rotation:l}=this;switch(l){case 90:return[i,1-t,s*(o/r),n*(r/o)];case 180:return[1-t,1-i,s,n];case 270:return[1-i,t,s*(o/r),n*(r/o)];default:return[t,i,s,n]}},Yh=function(){const{x:t,y:i,width:s,height:n,parentDimensions:[r,o],rotation:l}=this;switch(l){case 90:return[1-i,t,s*(r/o),n*(o/r)];case 180:return[1-t,1-i,s,n];case 270:return[i,1-t,s*(r/o),n*(o/r)];default:return[t,i,s,n]}},Io=function(t){if([this.x,this.y,this.width,this.height]=E(this,kt,Vp).call(this,t),this.div){this.fixAndSetPosition();const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)}this._onResized()},Qr=function(){const{x:t,y:i,width:s,height:n,rotation:r,parentRotation:o,parentDimensions:[l,h]}=this;switch((r*4+o)/90){case 1:return[1-i-n,t,n,s];case 2:return[1-t-s,1-i-n,s,n];case 3:return[i,1-t-s,n,s];case 4:return[t,i-s*(l/h),n*(h/l),s*(l/h)];case 5:return[1-i,t,s*(l/h),n*(h/l)];case 6:return[1-t-n*(h/l),1-i,n*(h/l),s*(l/h)];case 7:return[i-s*(l/h),1-t-n*(h/l),s*(l/h),n*(h/l)];case 8:return[t-s,i-n,s,n];case 9:return[1-i,t-s,n,s];case 10:return[1-t,1-i,s,n];case 11:return[i-n,1-t,n,s];case 12:return[t-n*(h/l),i,n*(h/l),s*(l/h)];case 13:return[1-i-s*(l/h),t-n*(h/l),s*(l/h),n*(h/l)];case 14:return[1-t,1-i-s*(l/h),n*(h/l),s*(l/h)];case 15:return[i,1-t,s*(l/h),n*(h/l)];default:return[t,i,s,n]}},ut(at,"_currentDrawId",-1),ut(at,"_currentParent",null),S(at,he,null),S(at,Rr,null),S(at,Ir,null),S(at,bn,NaN),S(at,yn,null),S(at,vn,null),S(at,Lr,NaN),ut(at,"_INNER_MARGIN",3);let qd=at;var is,ce,de,Mr,to,Re,ge,fi,Dr,Fr,Or,eo,Kh;class fb{constructor(e,t,i,s,n,r){S(this,eo);S(this,is,new Float64Array(6));S(this,ce);S(this,de);S(this,Mr);S(this,to);S(this,Re);S(this,ge,"");S(this,fi,0);S(this,Dr,new lc);S(this,Fr);S(this,Or);v(this,Fr,i),v(this,Or,s),v(this,Mr,n),v(this,to,r),[e,t]=E(this,eo,Kh).call(this,e,t);const o=v(this,ce,[NaN,NaN,NaN,NaN,e,t]);v(this,Re,[e,t]),v(this,de,[{line:o,points:a(this,Re)}]),a(this,is).set(o,0)}updateProperty(e,t){e==="stroke-width"&&v(this,to,t)}isEmpty(){return!a(this,de)||a(this,de).length===0}isCancellable(){return a(this,Re).length<=10}add(e,t){[e,t]=E(this,eo,Kh).call(this,e,t);const[i,s,n,r]=a(this,is).subarray(2,6),o=e-n,l=t-r;return Math.hypot(a(this,Fr)*o,a(this,Or)*l)<=2?null:(a(this,Re).push(e,t),isNaN(i)?(a(this,is).set([n,r,e,t],2),a(this,ce).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(a(this,is)[0])&&a(this,ce).splice(6,6),a(this,is).set([i,s,n,r,e,t],0),a(this,ce).push(...rt.createBezierPoints(i,s,n,r,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const i=this.add(e,t);return i||(a(this,Re).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,s,n){v(this,Fr,i),v(this,Or,s),v(this,Mr,n),[e,t]=E(this,eo,Kh).call(this,e,t);const r=v(this,ce,[NaN,NaN,NaN,NaN,e,t]);v(this,Re,[e,t]);const o=a(this,de).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),a(this,de).push({line:r,points:a(this,Re)}),a(this,is).set(r,0),v(this,fi,0),this.toSVGPath(),null}getLastElement(){return a(this,de).at(-1)}setLastElement(e){return a(this,de)?(a(this,de).push(e),v(this,ce,e.line),v(this,Re,e.points),v(this,fi,0),{path:{d:this.toSVGPath()}}):a(this,Dr).setLastElement(e)}removeLastElement(){if(!a(this,de))return a(this,Dr).removeLastElement();a(this,de).pop(),v(this,ge,"");for(let e=0,t=a(this,de).length;e<t;e++){const{line:i,points:s}=a(this,de)[e];v(this,ce,i),v(this,Re,s),v(this,fi,0),this.toSVGPath()}return{path:{d:a(this,ge)}}}toSVGPath(){const e=rt.svgRound(a(this,ce)[4]),t=rt.svgRound(a(this,ce)[5]);if(a(this,Re).length===2)return v(this,ge,`${a(this,ge)} M ${e} ${t} Z`),a(this,ge);if(a(this,Re).length<=6){const s=a(this,ge).lastIndexOf("M");v(this,ge,`${a(this,ge).slice(0,s)} M ${e} ${t}`),v(this,fi,6)}if(a(this,Re).length===4){const s=rt.svgRound(a(this,ce)[10]),n=rt.svgRound(a(this,ce)[11]);return v(this,ge,`${a(this,ge)} L ${s} ${n}`),v(this,fi,12),a(this,ge)}const i=[];a(this,fi)===0&&(i.push(`M ${e} ${t}`),v(this,fi,6));for(let s=a(this,fi),n=a(this,ce).length;s<n;s+=6){const[r,o,l,h,c,d]=a(this,ce).slice(s,s+6).map(rt.svgRound);i.push(`C${r} ${o} ${l} ${h} ${c} ${d}`)}return v(this,ge,a(this,ge)+i.join(" ")),v(this,fi,a(this,ce).length),a(this,ge)}getOutlines(e,t,i,s){const n=a(this,de).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),a(this,Dr).build(a(this,de),e,t,i,a(this,Mr),a(this,to),s),v(this,is,null),v(this,ce,null),v(this,de,null),v(this,ge,null),a(this,Dr)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}is=new WeakMap,ce=new WeakMap,de=new WeakMap,Mr=new WeakMap,to=new WeakMap,Re=new WeakMap,ge=new WeakMap,fi=new WeakMap,Dr=new WeakMap,Fr=new WeakMap,Or=new WeakMap,eo=new WeakSet,Kh=function(e,t){return rt._normalizePoint(e,t,a(this,Fr),a(this,Or),a(this,Mr))};var Ie,ch,dh,ti,ss,ns,io,so,no,be,us,Xp,Yp,Kp;const xu=class xu extends rt{constructor(){super(...arguments);S(this,be);S(this,Ie);S(this,ch,0);S(this,dh);S(this,ti);S(this,ss);S(this,ns);S(this,io);S(this,so);S(this,no)}build(t,i,s,n,r,o,l){v(this,ss,i),v(this,ns,s),v(this,io,n),v(this,so,r),v(this,no,o),v(this,dh,l??0),v(this,ti,t),E(this,be,Yp).call(this)}setLastElement(t){return a(this,ti).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return a(this,ti).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:i}of a(this,ti)){if(t.push(`M${rt.svgRound(i[4])} ${rt.svgRound(i[5])}`),i.length===6){t.push("Z");continue}if(i.length===12){t.push(`L${rt.svgRound(i[10])} ${rt.svgRound(i[11])}`);continue}for(let s=6,n=i.length;s<n;s+=6){const[r,o,l,h,c,d]=i.subarray(s,s+6).map(rt.svgRound);t.push(`C${r} ${o} ${l} ${h} ${c} ${d}`)}}return t.join("")}serialize([t,i,s,n],r){const o=[],l=[],[h,c,d,u]=E(this,be,Xp).call(this);let p,m,g,y,b,_,x,C,k;switch(a(this,so)){case 0:k=rt._rescale,p=t,m=i+n,g=s,y=-n,b=t+h*s,_=i+(1-c-u)*n,x=t+(h+d)*s,C=i+(1-c)*n;break;case 90:k=rt._rescaleAndSwap,p=t,m=i,g=s,y=n,b=t+c*s,_=i+h*n,x=t+(c+u)*s,C=i+(h+d)*n;break;case 180:k=rt._rescale,p=t+s,m=i,g=-s,y=n,b=t+(1-h-d)*s,_=i+c*n,x=t+(1-h)*s,C=i+(c+u)*n;break;case 270:k=rt._rescaleAndSwap,p=t+s,m=i+n,g=-s,y=-n,b=t+(1-c-u)*s,_=i+(1-h-d)*n,x=t+(1-c)*s,C=i+(1-h)*n;break}for(const{line:M,points:L}of a(this,ti))o.push(k(M,p,m,g,y,r?new Array(M.length):null)),l.push(k(L,p,m,g,y,r?new Array(L.length):null));return{lines:o,points:l,rect:[b,_,x,C]}}static deserialize(t,i,s,n,r,{paths:{lines:o,points:l},rotation:h,thickness:c}){const d=[];let u,p,m,g,y;switch(h){case 0:y=rt._rescale,u=-t/s,p=i/n+1,m=1/s,g=-1/n;break;case 90:y=rt._rescaleAndSwap,u=-i/n,p=-t/s,m=1/n,g=1/s;break;case 180:y=rt._rescale,u=t/s+1,p=-i/n,m=-1/s,g=1/n;break;case 270:y=rt._rescaleAndSwap,u=i/n+1,p=t/s+1,m=-1/n,g=-1/s;break}if(!o){o=[];for(const _ of l){const x=_.length;if(x===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1]]));continue}if(x===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1],NaN,NaN,NaN,NaN,_[2],_[3]]));continue}const C=new Float32Array(3*(x-2));o.push(C);let[k,M,L,N]=_.subarray(0,4);C.set([NaN,NaN,NaN,NaN,k,M],0);for(let D=4;D<x;D+=2){const G=_[D],Z=_[D+1];C.set(rt.createBezierPoints(k,M,L,N,G,Z),(D-2)*3),[k,M,L,N]=[L,N,G,Z]}}}for(let _=0,x=o.length;_<x;_++)d.push({line:y(o[_].map(C=>C??NaN),u,p,m,g),points:y(l[_].map(C=>C??NaN),u,p,m,g)});const b=new xu;return b.build(d,s,n,1,h,c,r),b}get box(){return a(this,Ie)}updateProperty(t,i){return t==="stroke-width"?E(this,be,Kp).call(this,i):null}updateParentDimensions([t,i],s){const[n,r]=E(this,be,us).call(this);v(this,ss,t),v(this,ns,i),v(this,io,s);const[o,l]=E(this,be,us).call(this),h=o-n,c=l-r,d=a(this,Ie);return d[0]-=h,d[1]-=c,d[2]+=2*h,d[3]+=2*c,d}updateRotation(t){return v(this,ch,t),{path:{transform:this.rotationTransform}}}get viewBox(){return a(this,Ie).map(rt.svgRound).join(" ")}get defaultProperties(){const[t,i]=a(this,Ie);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${rt.svgRound(t)} ${rt.svgRound(i)}`}}}get rotationTransform(){const[,,t,i]=a(this,Ie);let s=0,n=0,r=0,o=0,l=0,h=0;switch(a(this,ch)){case 90:n=i/t,r=-t/i,l=t;break;case 180:s=-1,o=-1,l=t,h=i;break;case 270:n=-i/t,r=t/i,h=i;break;default:return""}return`matrix(${s} ${n} ${r} ${o} ${rt.svgRound(l)} ${rt.svgRound(h)})`}getPathResizingSVGProperties([t,i,s,n]){const[r,o]=E(this,be,us).call(this),[l,h,c,d]=a(this,Ie);if(Math.abs(c-r)<=rt.PRECISION||Math.abs(d-o)<=rt.PRECISION){const y=t+s/2-(l+c/2),b=i+n/2-(h+d/2);return{path:{"transform-origin":`${rt.svgRound(t)} ${rt.svgRound(i)}`,transform:`${this.rotationTransform} translate(${y} ${b})`}}}const u=(s-2*r)/(c-2*r),p=(n-2*o)/(d-2*o),m=c/s,g=d/n;return{path:{"transform-origin":`${rt.svgRound(l)} ${rt.svgRound(h)}`,transform:`${this.rotationTransform} scale(${m} ${g}) translate(${rt.svgRound(r)} ${rt.svgRound(o)}) scale(${u} ${p}) translate(${rt.svgRound(-r)} ${rt.svgRound(-o)})`}}}getPathResizedSVGProperties([t,i,s,n]){const[r,o]=E(this,be,us).call(this),l=a(this,Ie),[h,c,d,u]=l;if(l[0]=t,l[1]=i,l[2]=s,l[3]=n,Math.abs(d-r)<=rt.PRECISION||Math.abs(u-o)<=rt.PRECISION){const b=t+s/2-(h+d/2),_=i+n/2-(c+u/2);for(const{line:x,points:C}of a(this,ti))rt._translate(x,b,_,x),rt._translate(C,b,_,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${rt.svgRound(t)} ${rt.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(s-2*r)/(d-2*r),m=(n-2*o)/(u-2*o),g=-p*(h+r)+t+r,y=-m*(c+o)+i+o;if(p!==1||m!==1||g!==0||y!==0)for(const{line:b,points:_}of a(this,ti))rt._rescale(b,g,y,p,m,b),rt._rescale(_,g,y,p,m,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${rt.svgRound(t)} ${rt.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,i],s){const[n,r]=s,o=a(this,Ie),l=t-o[0],h=i-o[1];if(a(this,ss)===n&&a(this,ns)===r)for(const{line:c,points:d}of a(this,ti))rt._translate(c,l,h,c),rt._translate(d,l,h,d);else{const c=a(this,ss)/n,d=a(this,ns)/r;v(this,ss,n),v(this,ns,r);for(const{line:u,points:p}of a(this,ti))rt._rescale(u,l,h,c,d,u),rt._rescale(p,l,h,c,d,p);o[2]*=c,o[3]*=d}return o[0]=t,o[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${rt.svgRound(t)} ${rt.svgRound(i)}`}}}get defaultSVGProperties(){const t=a(this,Ie);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${rt.svgRound(t[0])} ${rt.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};Ie=new WeakMap,ch=new WeakMap,dh=new WeakMap,ti=new WeakMap,ss=new WeakMap,ns=new WeakMap,io=new WeakMap,so=new WeakMap,no=new WeakMap,be=new WeakSet,us=function(t=a(this,no)){const i=a(this,dh)+t/2*a(this,io);return a(this,so)%180===0?[i/a(this,ss),i/a(this,ns)]:[i/a(this,ns),i/a(this,ss)]},Xp=function(){const[t,i,s,n]=a(this,Ie),[r,o]=E(this,be,us).call(this,0);return[t+r,i+o,s-2*r,n-2*o]},Yp=function(){const t=v(this,Ie,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of a(this,ti)){if(n.length<=12){for(let l=4,h=n.length;l<h;l+=6){const[c,d]=n.subarray(l,l+2);t[0]=Math.min(t[0],c),t[1]=Math.min(t[1],d),t[2]=Math.max(t[2],c),t[3]=Math.max(t[3],d)}continue}let r=n[4],o=n[5];for(let l=6,h=n.length;l<h;l+=6){const[c,d,u,p,m,g]=n.subarray(l,l+6);ht.bezierBoundingBox(r,o,c,d,u,p,m,g,t),r=m,o=g}}const[i,s]=E(this,be,us).call(this);t[0]=Math.min(1,Math.max(0,t[0]-i)),t[1]=Math.min(1,Math.max(0,t[1]-s)),t[2]=Math.min(1,Math.max(0,t[2]+i)),t[3]=Math.min(1,Math.max(0,t[3]+s)),t[2]-=t[0],t[3]-=t[1]},Kp=function(t){const[i,s]=E(this,be,us).call(this);v(this,no,t);const[n,r]=E(this,be,us).call(this),[o,l]=[n-i,r-s],h=a(this,Ie);return h[0]-=o,h[1]-=l,h[2]+=2*o,h[3]+=2*l,h};let lc=xu;var ro;const Cu=class Cu extends ub{constructor(t){super();S(this,ro);v(this,ro,t),super.updateProperties({fill:"none",stroke:Gt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,i){t==="stroke-width"&&(i??(i=this["stroke-width"]),i*=a(this,ro).realScale),super.updateSVGProperty(t,i)}clone(){const t=new Cu(a(this,ro));return t.updateAll(this),t}};ro=new WeakMap;let Kd=Cu;var Cc,Zp;const ta=class ta extends qd{constructor(t){super({...t,name:"inkEditor"});S(this,Cc);this._willKeepAspectRatio=!0}static initialize(t,i){Gt.initialize(t,i),this._defaultDrawingOptions=new Kd(i.viewParameters)}static getDefaultDrawingOptions(t){const i=this._defaultDrawingOptions.clone();return i.updateProperties(t),i}static get supportMultipleDrawings(){return!0}static get typesMap(){return St(this,"typesMap",new Map([[Et.INK_THICKNESS,"stroke-width"],[Et.INK_COLOR,"stroke"],[Et.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,i,s,n,r){return new fb(t,i,s,n,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,i,s,n,r,o){return lc.deserialize(t,i,s,n,r,o)}static async deserialize(t,i,s){let n=null;if(t instanceof yu){const{data:{inkLists:o,rect:l,rotation:h,id:c,color:d,opacity:u,borderStyle:{rawWidth:p},popupRef:m},parent:{page:{pageNumber:g}}}=t;n=t={annotationType:yt.INK,color:Array.from(d),thickness:p,opacity:u,paths:{points:o},boxes:null,pageIndex:g-1,rect:l.slice(0),rotation:h,id:c,deleted:!1,popupRef:m}}const r=await super.deserialize(t,i,s);return r.annotationElementId=t.id||null,r._initialData=n,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:i,parent:s}=this;i.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,i.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:i,opacity:s}){this._drawingOptions=ta.getDefaultDrawingOptions({stroke:ht.makeHexColor(...t),"stroke-width":i,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:i,points:s,rect:n}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":l}}=this,h={annotationType:yt.INK,color:Gt._colorManager.convert(r),opacity:o,thickness:l,paths:{lines:i,points:s},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?h:this.annotationElementId&&!E(this,Cc,Zp).call(this,h)?null:(h.id=this.annotationElementId,h)}renderAnnotationElement(t){const{points:i,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:i}),null}};Cc=new WeakSet,Zp=function(t){const{color:i,thickness:s,opacity:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==i[l])||t.thickness!==s||t.opacity!==n||t.pageIndex!==r},ut(ta,"_type","ink"),ut(ta,"_editorType",yt.INK),ut(ta,"_defaultDrawingOptions",null);let Zd=ta;var jt,me,wn,Os,_n,ao,rs,as,ei,oo,Tt,Lo,Mo,Zh,Jd,Qh,tu,Jh,Qp;const Oo=class Oo extends Gt{constructor(t){super({...t,name:"stampEditor"});S(this,Tt);S(this,jt,null);S(this,me,null);S(this,wn,null);S(this,Os,null);S(this,_n,null);S(this,ao,"");S(this,rs,null);S(this,as,null);S(this,ei,!1);S(this,oo,!1);v(this,Os,t.bitmapUrl),v(this,_n,t.bitmapFile)}static initialize(t,i){Gt.initialize(t,i)}static get supportedTypes(){return St(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(i=>`image/${i}`))}static get supportedTypesStr(){return St(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,i){i.pasteEditor(yt.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const i=t.get("hasAltText");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}async mlGuessAltText(t=null,i=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:r,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await s.guess({name:"altText",request:{data:n,width:r,height:o,channels:n.length/(r*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return await this.setGuessedAltText(h),i&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;a(this,me)&&(v(this,jt,null),this._uiManager.imageManager.deleteId(a(this,me)),(t=a(this,rs))==null||t.remove(),v(this,rs,null),a(this,as)&&(clearTimeout(a(this,as)),v(this,as,null))),super.remove()}rebuild(){if(!this.parent){a(this,me)&&E(this,Tt,Zh).call(this);return}super.rebuild(),this.div!==null&&(a(this,me)&&a(this,rs)===null&&E(this,Tt,Zh).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(a(this,wn)||a(this,jt)||a(this,Os)||a(this,_n)||a(this,me))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,i;if(this.width&&(t=this.x,i=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),a(this,jt)?E(this,Tt,Jd).call(this):E(this,Tt,Zh).call(this),this.width&&!this.annotationElementId){const[s,n]=this.parentDimensions;this.setAt(t*s,i*n,this.width*s,this.height*n)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;a(this,as)!==null&&clearTimeout(a(this,as)),v(this,as,setTimeout(()=>{v(this,as,null),E(this,Tt,tu).call(this)},200))}copyCanvas(t,i,s=!1){var p;t||(t=224);const{width:n,height:r}=a(this,jt),o=new Kc;let l=a(this,jt),h=n,c=r,d=null;if(i){if(n>i||r>i){const N=Math.min(i/n,i/r);h=Math.floor(n*N),c=Math.floor(r*N)}d=document.createElement("canvas");const m=d.width=Math.ceil(h*o.sx),g=d.height=Math.ceil(c*o.sy);a(this,ei)||(l=E(this,Tt,Qh).call(this,m,g));const y=d.getContext("2d");y.filter=this._uiManager.hcmFilter;let b="white",_="#cfcfd8";this._uiManager.hcmFilter!=="none"?_="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(b="#8f8f9d",_="#42414d");const x=15,C=x*o.sx,k=x*o.sy,M=new OffscreenCanvas(C*2,k*2),L=M.getContext("2d");L.fillStyle=b,L.fillRect(0,0,C*2,k*2),L.fillStyle=_,L.fillRect(0,0,C,k),L.fillRect(C,k,C,k),y.fillStyle=y.createPattern(M,"repeat"),y.fillRect(0,0,m,g),y.drawImage(l,0,0,l.width,l.height,0,0,m,g)}let u=null;if(s){let m,g;if(o.symmetric&&l.width<t&&l.height<t)m=l.width,g=l.height;else if(l=a(this,jt),n>t||r>t){const _=Math.min(t/n,t/r);m=Math.floor(n*_),g=Math.floor(r*_),a(this,ei)||(l=E(this,Tt,Qh).call(this,m,g))}const b=new OffscreenCanvas(m,g).getContext("2d",{willReadFrequently:!0});b.drawImage(l,0,0,l.width,l.height,0,0,m,g),u={width:m,height:g,data:b.getImageData(0,0,m,g).data}}return{canvas:d,width:h,height:c,imageData:u}}getImageForAltText(){return a(this,rs)}static async deserialize(t,i,s){var g;let n=null;if(t instanceof vp){const{data:{rect:y,rotation:b,id:_,structParent:x,popupRef:C},container:k,parent:{page:{pageNumber:M}}}=t,L=k.querySelector("canvas"),N=s.imageManager.getFromCanvas(k.id,L);L.remove();const D=((g=await i._structTree.getAriaAttributes(`${cu}${_}`))==null?void 0:g.get("aria-label"))||"";n=t={annotationType:yt.STAMP,bitmapId:N.id,bitmap:N.bitmap,pageIndex:M-1,rect:y.slice(0),rotation:b,id:_,deleted:!1,accessibilityData:{decorative:!1,altText:D},isSvg:!1,structParent:x,popupRef:C}}const r=await super.deserialize(t,i,s),{rect:o,bitmap:l,bitmapUrl:h,bitmapId:c,isSvg:d,accessibilityData:u}=t;c&&s.imageManager.isValidId(c)?(v(r,me,c),l&&v(r,jt,l)):v(r,Os,h),v(r,ei,d);const[p,m]=r.pageDimensions;return r.width=(o[2]-o[0])/p,r.height=(o[3]-o[1])/m,r.annotationElementId=t.id||null,u&&(r.altTextData=u),r._initialData=n,v(r,oo,!!n),r}serialize(t=!1,i=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:yt.STAMP,bitmapId:a(this,me),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:a(this,ei),structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=E(this,Tt,Jh).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s;const{decorative:n,altText:r}=this.serializeAltText(!1);if(!n&&r&&(s.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const l=E(this,Tt,Qp).call(this,s);if(l.isSame)return null;l.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,i===null)return s;i.stamps||(i.stamps=new Map);const o=a(this,ei)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!i.stamps.has(a(this,me)))i.stamps.set(a(this,me),{area:o,serialized:s}),s.bitmap=E(this,Tt,Jh).call(this,!1);else if(a(this,ei)){const l=i.stamps.get(a(this,me));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=E(this,Tt,Jh).call(this,!1))}return s}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};jt=new WeakMap,me=new WeakMap,wn=new WeakMap,Os=new WeakMap,_n=new WeakMap,ao=new WeakMap,rs=new WeakMap,as=new WeakMap,ei=new WeakMap,oo=new WeakMap,Tt=new WeakSet,Lo=function(t,i=!1){if(!t){this.remove();return}v(this,jt,t.bitmap),i||(v(this,me,t.id),v(this,ei,t.isSvg)),t.file&&v(this,ao,t.file.name),E(this,Tt,Jd).call(this)},Mo=function(){if(v(this,wn,null),this._uiManager.enableWaiting(!1),!!a(this,rs)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,jt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,jt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Zh=function(){if(a(this,me)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(a(this,me)).then(s=>E(this,Tt,Lo).call(this,s,!0)).finally(()=>E(this,Tt,Mo).call(this));return}if(a(this,Os)){const s=a(this,Os);v(this,Os,null),this._uiManager.enableWaiting(!0),v(this,wn,this._uiManager.imageManager.getFromUrl(s).then(n=>E(this,Tt,Lo).call(this,n)).finally(()=>E(this,Tt,Mo).call(this)));return}if(a(this,_n)){const s=a(this,_n);v(this,_n,null),this._uiManager.enableWaiting(!0),v(this,wn,this._uiManager.imageManager.getFromFile(s).then(n=>E(this,Tt,Lo).call(this,n)).finally(()=>E(this,Tt,Mo).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Oo.supportedTypesStr;const i=this._uiManager._signal;v(this,wn,new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),E(this,Tt,Lo).call(this,n)}s()},{signal:i}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:i})}).finally(()=>E(this,Tt,Mo).call(this))),t.click()},Jd=function(){var d;const{div:t}=this;let{width:i,height:s}=a(this,jt);const[n,r]=this.pageDimensions,o=.75;if(this.width)i=this.width*n,s=this.height*r;else if(i>o*n||s>o*r){const u=Math.min(o*n/i,o*r/s);i*=u,s*=u}const[l,h]=this.parentDimensions;this.setDims(i*l/n,s*h/r),this._uiManager.enableWaiting(!1);const c=v(this,rs,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=i/n,this.height=s/r,(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),E(this,Tt,tu).call(this),a(this,oo)||(this.parent.addUndoableEditor(this),v(this,oo,!0)),this._reportTelemetry({action:"inserted_image"}),a(this,ao)&&c.setAttribute("aria-label",a(this,ao))},Qh=function(t,i){const{width:s,height:n}=a(this,jt);let r=s,o=n,l=a(this,jt);for(;r>2*t||o>2*i;){const h=r,c=o;r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),o>2*i&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const d=new OffscreenCanvas(r,o);d.getContext("2d").drawImage(l,0,0,h,c,0,0,r,o),l=d.transferToImageBitmap()}return l},tu=function(){const[t,i]=this.parentDimensions,{width:s,height:n}=this,r=new Kc,o=Math.ceil(s*t*r.sx),l=Math.ceil(n*i*r.sy),h=a(this,rs);if(!h||h.width===o&&h.height===l)return;h.width=o,h.height=l;const c=a(this,ei)?a(this,jt):E(this,Tt,Qh).call(this,o,l),d=h.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(c,0,0,c.width,c.height,0,0,o,l)},Jh=function(t){if(t){if(a(this,ei)){const n=this._uiManager.imageManager.getSvgUrl(a(this,me));if(n)return n}const i=document.createElement("canvas");return{width:i.width,height:i.height}=a(this,jt),i.getContext("2d").drawImage(a(this,jt),0,0),i.toDataURL()}if(a(this,ei)){const[i,s]=this.pageDimensions,n=Math.round(this.width*i*kn.PDF_TO_CSS_UNITS),r=Math.round(this.height*s*kn.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,r);return o.getContext("2d").drawImage(a(this,jt),0,0,a(this,jt).width,a(this,jt).height,0,0,n,r),o.transferToImageBitmap()}return structuredClone(a(this,jt))},Qp=function(t){var o;const{pageIndex:i,accessibilityData:{altText:s}}=this._initialData,n=t.pageIndex===i,r=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&n&&r,isSameAltText:r}},ut(Oo,"_type","stamp"),ut(Oo,"_editorType",yt.STAMP);let Qd=Oo;var Nr,lo,os,An,Ns,pi,Sn,ho,Br,Di,Bs,Ee,zs,lt,En,Ut,Jp,Gi,iu,su,tc;const Ai=class Ai{constructor({uiManager:e,pageIndex:t,div:i,structTreeLayer:s,accessibilityManager:n,annotationLayer:r,drawLayer:o,textLayer:l,viewport:h,l10n:c}){S(this,Ut);S(this,Nr);S(this,lo,!1);S(this,os,null);S(this,An,null);S(this,Ns,null);S(this,pi,new Map);S(this,Sn,!1);S(this,ho,!1);S(this,Br,!1);S(this,Di,null);S(this,Bs,null);S(this,Ee,null);S(this,zs,null);S(this,lt);const d=[...a(Ai,En).values()];if(!Ai._initialized){Ai._initialized=!0;for(const u of d)u.initialize(c,e)}e.registerEditorTypes(d),v(this,lt,e),this.pageIndex=t,this.div=i,v(this,Nr,n),v(this,os,r),this.viewport=h,v(this,Ee,l),this.drawLayer=o,this._structTree=s,a(this,lt).addLayer(this)}get isEmpty(){return a(this,pi).size===0}get isInvisible(){return this.isEmpty&&a(this,lt).getMode()===yt.NONE}updateToolbar(e){a(this,lt).updateToolbar(e)}updateMode(e=a(this,lt).getMode()){switch(E(this,Ut,tc).call(this),e){case yt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case yt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case yt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const i of a(Ai,En).values())t.toggle(`${i._type}Editing`,e===i._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=a(this,Ee))==null?void 0:t.div)}setEditingState(e){a(this,lt).setEditingState(e)}addCommands(e){a(this,lt).addCommands(e)}cleanUndoStack(e){a(this,lt).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=a(this,os))==null||t.div.classList.toggle("disabled",!e)}async enable(){v(this,Br,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const i of a(this,pi).values())i.enableEditing(),i.show(!0),i.annotationElementId&&(a(this,lt).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));if(!a(this,os)){v(this,Br,!1);return}const t=a(this,os).getEditableAnnotations();for(const i of t){if(i.hide(),a(this,lt).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const s=await this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}v(this,Br,!1)}disable(){var s;v(this,ho,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const n of a(this,pi).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){e.set(n.annotationElementId,n);continue}else t.set(n.annotationElementId,n);(s=this.getEditableAnnotation(n.annotationElementId))==null||s.show(),n.remove()}if(a(this,os)){const n=a(this,os).getEditableAnnotations();for(const r of n){const{id:o}=r.data;if(a(this,lt).isDeletedAnnotationElement(o))continue;let l=t.get(o);if(l){l.resetAnnotationElement(r),l.show(!1),r.show();continue}l=e.get(o),l&&(a(this,lt).addChangedExistingAnnotation(l),l.renderAnnotationElement(r)&&l.show(!1)),r.show()}}E(this,Ut,tc).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const n of a(Ai,En).values())i.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),v(this,ho,!1)}getEditableAnnotation(e){var t;return((t=a(this,os))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){a(this,lt).getActive()!==e&&a(this,lt).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=a(this,Ee))!=null&&e.div&&!a(this,zs)){v(this,zs,new AbortController);const t=a(this,lt).combinedSignal(a(this,zs));a(this,Ee).div.addEventListener("pointerdown",E(this,Ut,Jp).bind(this),{signal:t}),a(this,Ee).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=a(this,Ee))!=null&&e.div&&a(this,zs)&&(a(this,zs).abort(),v(this,zs,null),a(this,Ee).div.classList.remove("highlighting"))}enableClick(){if(a(this,An))return;v(this,An,new AbortController);const e=a(this,lt).combinedSignal(a(this,An));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=a(this,An))==null||e.abort(),v(this,An,null)}attach(e){a(this,pi).set(e.id,e);const{annotationElementId:t}=e;t&&a(this,lt).isDeletedAnnotationElement(t)&&a(this,lt).removeDeletedAnnotationElement(e)}detach(e){var t;a(this,pi).delete(e.id),(t=a(this,Nr))==null||t.removePointerInTextLayer(e.contentDiv),!a(this,ho)&&e.annotationElementId&&a(this,lt).addDeletedAnnotationElement(e)}remove(e){this.detach(e),a(this,lt).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(a(this,lt).addDeletedAnnotationElement(e.annotationElementId),Gt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),a(this,lt).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!a(this,Br)),a(this,lt).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var i;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!a(this,Ns)&&(e._focusEventsAllowed=!1,v(this,Ns,setTimeout(()=>{v(this,Ns,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:a(this,lt)._signal}),t.focus())},0))),e._structTreeParentId=(i=a(this,Nr))==null?void 0:i.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),i=()=>{e.remove()};this.addCommands({cmd:t,undo:i,mustExec:!1})}getNextId(){return a(this,lt).getId()}combinedSignal(e){return a(this,lt).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=a(this,Ut,Gi))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){a(this,lt).updateToolbar(e),a(this,lt).updateMode(e);const{offsetX:i,offsetY:s}=E(this,Ut,su).call(this),n=this.getNextId(),r=E(this,Ut,iu).call(this,{parent:this,id:n,x:i,y:s,uiManager:a(this,lt),isCentered:!0,...t});r&&this.add(r)}async deserialize(e){var t;return await((t=a(Ai,En).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,a(this,lt)))||null}createAndAddNewEditor(e,t,i={}){const s=this.getNextId(),n=E(this,Ut,iu).call(this,{parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:a(this,lt),isCentered:t,...i});return n&&this.add(n),n}addNewEditor(){this.createAndAddNewEditor(E(this,Ut,su).call(this),!0)}setSelected(e){a(this,lt).setSelected(e)}toggleSelected(e){a(this,lt).toggleSelected(e)}unselect(e){a(this,lt).unselect(e)}pointerup(e){var i;const{isMac:t}=De.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&a(this,Sn)&&(v(this,Sn,!1),!((i=a(this,Ut,Gi))!=null&&i.isDrawer&&a(this,Ut,Gi).supportMultipleDrawings))){if(!a(this,lo)){v(this,lo,!0);return}if(a(this,lt).getMode()===yt.STAMP){a(this,lt).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var s;if(a(this,lt).getMode()===yt.HIGHLIGHT&&this.enableTextSelection(),a(this,Sn)){v(this,Sn,!1);return}const{isMac:t}=De.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(v(this,Sn,!0),(s=a(this,Ut,Gi))!=null&&s.isDrawer){this.startDrawingSession(e);return}const i=a(this,lt).getActive();v(this,lo,!i||i.isEmpty())}startDrawingSession(e){if(this.div.focus(),a(this,Di)){a(this,Ut,Gi).startDrawing(this,a(this,lt),!1,e);return}a(this,lt).setCurrentDrawingSession(this),v(this,Di,new AbortController);const t=a(this,lt).combinedSignal(a(this,Di));this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(v(this,Bs,null),this.commitOrRemove())},{signal:t}),a(this,Ut,Gi).startDrawing(this,a(this,lt),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&v(this,Bs,t);return}a(this,Bs)&&setTimeout(()=>{var t;(t=a(this,Bs))==null||t.focus(),v(this,Bs,null)},0)}endDrawingSession(e=!1){return a(this,Di)?(a(this,lt).setCurrentDrawingSession(null),a(this,Di).abort(),v(this,Di,null),v(this,Bs,null),a(this,Ut,Gi).endDrawing(e)):null}findNewParent(e,t,i){const s=a(this,lt).findParent(t,i);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return a(this,Di)?(this.endDrawingSession(),!0):!1}onScaleChanging(){a(this,Di)&&a(this,Ut,Gi).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=a(this,lt).getActive())==null?void 0:e.parent)===this&&(a(this,lt).commitOrRemove(),a(this,lt).setActiveEditor(null)),a(this,Ns)&&(clearTimeout(a(this,Ns)),v(this,Ns,null));for(const i of a(this,pi).values())(t=a(this,Nr))==null||t.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove();this.div=null,a(this,pi).clear(),a(this,lt).removeLayer(this)}render({viewport:e}){this.viewport=e,Hr(this.div,e);for(const t of a(this,lt).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){a(this,lt).commitOrRemove(),E(this,Ut,tc).call(this);const t=this.viewport.rotation,i=e.rotation;if(this.viewport=e,Hr(this.div,{rotation:i}),t!==i)for(const s of a(this,pi).values())s.rotate(i)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return a(this,lt).viewParameters.realScale}};Nr=new WeakMap,lo=new WeakMap,os=new WeakMap,An=new WeakMap,Ns=new WeakMap,pi=new WeakMap,Sn=new WeakMap,ho=new WeakMap,Br=new WeakMap,Di=new WeakMap,Bs=new WeakMap,Ee=new WeakMap,zs=new WeakMap,lt=new WeakMap,En=new WeakMap,Ut=new WeakSet,Jp=function(e){a(this,lt).unselectAll();const{target:t}=e;if(t===a(this,Ee).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&a(this,Ee).div.contains(t)){const{isMac:i}=De.platform;if(e.button!==0||e.ctrlKey&&i)return;a(this,lt).showAllEditors("highlight",!0,!0),a(this,Ee).div.classList.add("free"),this.toggleDrawing(),oc.startHighlighting(this,a(this,lt).direction==="ltr",{target:a(this,Ee).div,x:e.x,y:e.y}),a(this,Ee).div.addEventListener("pointerup",()=>{a(this,Ee).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:a(this,lt)._signal}),e.preventDefault()}},Gi=function(){return a(Ai,En).get(a(this,lt).getMode())},iu=function(e){const t=a(this,Ut,Gi);return t?new t.prototype.constructor(e):null},su=function(){const{x:e,y:t,width:i,height:s}=this.div.getBoundingClientRect(),n=Math.max(0,e),r=Math.max(0,t),o=Math.min(window.innerWidth,e+i),l=Math.min(window.innerHeight,t+s),h=(n+o)/2-e,c=(r+l)/2-t,[d,u]=this.viewport.rotation%180===0?[h,c]:[c,h];return{offsetX:d,offsetY:u}},tc=function(){for(const e of a(this,pi).values())e.isEmpty()&&e.remove()},ut(Ai,"_initialized",!1),S(Ai,En,new Map([Od,Zd,Qd,oc].map(e=>[e._editorType,e])));let eu=Ai;var Fi,uh,Le,zr,kc,tg,ls,ru,eg,au;const we=class we{constructor({pageIndex:e}){S(this,ls);S(this,Fi,null);S(this,uh,0);S(this,Le,new Map);S(this,zr,new Map);this.pageIndex=e}setParent(e){if(!a(this,Fi)){v(this,Fi,e);return}if(a(this,Fi)!==e){if(a(this,Le).size>0)for(const t of a(this,Le).values())t.remove(),e.append(t);v(this,Fi,e)}}static get _svgFactory(){return St(this,"_svgFactory",new bu)}draw(e,t=!1,i=!1){const s=ke(this,uh)._++,n=E(this,ls,ru).call(this),r=we._svgFactory.createElement("defs");n.append(r);const o=we._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&a(this,zr).set(s,o);const h=i?E(this,ls,eg).call(this,r,l):null,c=we._svgFactory.createElement("use");return n.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(n,e),a(this,Le).set(s,n),{id:s,clipPathId:`url(#${h})`}}drawOutline(e,t){const i=ke(this,uh)._++,s=E(this,ls,ru).call(this),n=we._svgFactory.createElement("defs");s.append(n);const r=we._svgFactory.createElement("path");n.append(r);const o=`path_p${this.pageIndex}_${i}`;r.setAttribute("id",o),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const d=we._svgFactory.createElement("mask");n.append(d),l=`mask_p${this.pageIndex}_${i}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const u=we._svgFactory.createElement("rect");d.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");const p=we._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${o}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const h=we._svgFactory.createElement("use");s.append(h),h.setAttribute("href",`#${o}`),l&&h.setAttribute("mask",`url(#${l})`);const c=h.cloneNode();return s.append(c),h.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(s,e),a(this,Le).set(i,s),i}finalizeDraw(e,t){a(this,zr).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:i,bbox:s,rootClass:n,path:r}=t,o=typeof e=="number"?a(this,Le).get(e):e;if(o){if(i&&E(this,ls,au).call(this,o,i),s&&E(l=we,kc,tg).call(l,o,s),n){const{classList:h}=o;for(const[c,d]of Object.entries(n))h.toggle(c,d)}if(r){const c=o.firstChild.firstChild;E(this,ls,au).call(this,c,r)}}}updateParent(e,t){if(t===this)return;const i=a(this,Le).get(e);i&&(a(t,Fi).append(i),a(this,Le).delete(e),a(t,Le).set(e,i))}remove(e){a(this,zr).delete(e),a(this,Fi)!==null&&(a(this,Le).get(e).remove(),a(this,Le).delete(e))}destroy(){v(this,Fi,null);for(const e of a(this,Le).values())e.remove();a(this,Le).clear(),a(this,zr).clear()}};Fi=new WeakMap,uh=new WeakMap,Le=new WeakMap,zr=new WeakMap,kc=new WeakSet,tg=function(e,[t,i,s,n]){const{style:r}=e;r.top=`${100*i}%`,r.left=`${100*t}%`,r.width=`${100*s}%`,r.height=`${100*n}%`},ls=new WeakSet,ru=function(){const e=we._svgFactory.create(1,1,!0);return a(this,Fi).append(e),e.setAttribute("aria-hidden",!0),e},eg=function(e,t){const i=we._svgFactory.createElement("clipPath");e.append(i);const s=`clip_${t}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const n=we._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),s},au=function(e,t){for(const[i,s]of Object.entries(t))s===null?e.removeAttribute(i):e.setAttribute(i,s)},S(we,kc);let nu=we;globalThis.pdfjsTestingUtils={HighlightOutliner:Bd};pt.AbortException;pt.AnnotationEditorLayer;pt.AnnotationEditorParamsType;pt.AnnotationEditorType;pt.AnnotationEditorUIManager;pt.AnnotationLayer;pt.AnnotationMode;pt.ColorPicker;pt.DOMSVGFactory;pt.DrawLayer;pt.FeatureTest;var pb=pt.GlobalWorkerOptions;pt.ImageKind;pt.InvalidPDFException;pt.MissingPDFException;pt.OPS;pt.OutputScale;pt.PDFDataRangeTransport;pt.PDFDateString;pt.PDFWorker;pt.PasswordResponses;pt.PermissionFlag;pt.PixelsPerInch;pt.RenderingCancelledException;pt.TextLayer;pt.TouchManager;pt.UnexpectedResponseException;pt.Util;pt.VerbosityLevel;pt.XfaLayer;pt.build;pt.createValidAbsoluteUrl;pt.fetchData;var gb=pt.getDocument;pt.getFilenameFromUrl;pt.getPdfFilenameFromUrl;pt.getXfaPageViewport;pt.isDataScheme;pt.isPdfFile;pt.noContextMenu;pt.normalizeUnicode;pt.setLayerDimensions;pt.shadow;pt.stopEvent;pt.version;pb.workerSrc=new URL("/PDFTOJPGCURSOR/assets/pdf.worker.min-yatZIOMy.mjs",import.meta.url).toString();const mb=document.querySelector("#app"),ou=6*1024*1024,I={busy:!1,appMode:"pdf",file:null,pdfData:null,pdfDoc:null,pdfNameBase:"document",format:"jpg",mode:"individual",quality:.92,dpiScale:2,spacing:"small",compress:!0,maxSizeMB:6,fitUnderMax:!0,imgFiles:[],imgTargetKB:600,imgUscisPreset:!0,imgMinQuality:.55,pageCount:0,pageOrder:[],pages:[],combined:null,theme:"light"};function Me(f){return String(f).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e]||e)}function Oi(f,e,t){return Math.max(e,Math.min(t,f))}function Us(f){if(!Number.isFinite(f))return"";const e=f/(1024*1024);if(e>=1)return`${e.toFixed(e>=10?0:2)} MB`;const t=f/1024;return`${t.toFixed(t>=10?0:1)} KB`}function bb(){return Math.random().toString(16).slice(2)+Date.now().toString(16)}function yb(f){const e=((f==null?void 0:f.type)||"").toLowerCase(),t=((f==null?void 0:f.name)||"").toLowerCase();return e==="image/jpeg"||t.endsWith(".jpg")||t.endsWith(".jpeg")}function lu(f){const e=((f==null?void 0:f.type)||"").toLowerCase(),t=((f==null?void 0:f.name)||"").toLowerCase();return e==="image/png"||t.endsWith(".png")}function vb(f){return yb(f)||lu(f)}function Ku(f){I.theme=f,document.documentElement.setAttribute("data-theme",f),localStorage.setItem("pdf2img:theme",f);const e=document.querySelector("#darkToggle");e&&(e.checked=f==="dark")}function Rt(f,e="info"){const t=document.querySelector("#toastHost");if(!t)return;const i=document.createElement("div");i.className="toast";const s=e==="success"?"Success":e==="error"?"Error":e==="warn"?"Notice":"Info";i.innerHTML=`<div class="msg">${Me(f)}</div><div class="tag">${Me(s)}</div>`,t.appendChild(i),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateY(8px)",i.style.transition="opacity 240ms ease, transform 240ms ease",setTimeout(()=>i.remove(),260)},e==="error"?5200:3200)}function wi(f){I.busy=f,document.querySelectorAll("[data-disable-when-busy]").forEach(t=>{t.disabled=!!f});const e=document.querySelector("#dropzone");e&&e.setAttribute("aria-busy",f?"true":"false")}function bi(f,e){const t=document.querySelector("#progressWrap"),i=document.querySelector("#bar"),s=document.querySelector("#progressText");!t||!i||!s||(t.classList.add("show"),i.style.width=`${Oi(f,0,100).toFixed(1)}%`,s.textContent=e||"")}function Wr(){const f=document.querySelector("#progressWrap");f&&f.classList.remove("show")}function ig(){var f,e;for(const t of I.pages)URL.revokeObjectURL(t.url);if((f=I.combined)!=null&&f.url&&URL.revokeObjectURL(I.combined.url),(e=I.pdfDoc)!=null&&e.destroy)try{I.pdfDoc.destroy()}catch{}I.pages=[],I.combined=null,I.file=null,I.pdfData=null,I.pdfDoc=null,I.pdfNameBase="document",I.pageCount=0,I.pageOrder=[],Ho(),Uo(),sa(),Tn(),wu(),Wr()}function mh(f,e){const t=URL.createObjectURL(f),i=document.createElement("a");i.href=t,i.download=e,document.body.appendChild(i),i.click(),i.remove(),setTimeout(()=>URL.revokeObjectURL(t),1e3)}async function wb(f){const e=URL.createObjectURL(f);try{const t=await new Promise((i,s)=>{const n=new Image;n.onload=()=>i(n),n.onerror=()=>s(new Error("Failed to load image.")),n.src=e});return typeof createImageBitmap=="function"?await createImageBitmap(t):t}finally{URL.revokeObjectURL(e)}}async function _b(f){const e=await wb(f),t=e.width,i=e.height,s=document.createElement("canvas"),n=s.getContext("2d",{alpha:!1});return s.width=Math.floor(t),s.height=Math.floor(i),n.fillStyle="#ffffff",n.fillRect(0,0,s.width,s.height),n.drawImage(e,0,0),{canvas:s,width:s.width,height:s.height}}function Do(f,e){return new Promise((t,i)=>{f.toBlob(s=>s?t(s):i(new Error("Failed to export canvas to JPEG.")),"image/jpeg",e)})}async function sg(f,e){const t=(e==null?void 0:e.targetBytes)??null,i=Oi((e==null?void 0:e.baseQuality)??.85,.1,1),s=Oi((e==null?void 0:e.minQuality)??.55,.1,1);if(!t)return{blob:await Do(f,i),usedQuality:i,tried:1,pass:!0};{const c=await Do(f,i);if(c.size<=t)return{blob:c,usedQuality:i,tried:1,pass:!0}}let n=s,r=i,o=await Do(f,s),l=s,h=2;if(o.size>t)return{blob:o,usedQuality:s,tried:h,pass:!1};for(let c=0;c<10&&r-n>.02;c++){const d=(n+r)/2,u=await Do(f,d);h++,u.size<=t?(o=u,l=d,n=d):r=d}return{blob:o,usedQuality:l,tried:h,pass:!0}}async function Zu(f){const e=I.fitUnderMax?Math.floor(I.maxSizeMB*1024*1024):null,t=Oi(I.quality,.1,1);return I.compress?await sg(f,{targetBytes:e,baseQuality:t,minQuality:.55}):{blob:await Do(f,t),usedQuality:t,tried:1,pass:!0}}function Ab(){return I.spacing==="none"?0:I.spacing==="medium"?40:20}function ng(f){const e=Ab(),t=Math.max(...f.map(s=>s.width)),i=f.reduce((s,n)=>s+n.height,0)+e*Math.max(0,f.length-1);return{width:t,height:i,spacing:e}}function rg(f,e){if(f>16384||e>16384)return`Combined image is too large (${Math.round(f)}${Math.round(e)}). Try DPI 2x, reduce pages, or use Individual Pages.`;const i=f*e;return i>14e7?`Combined image is very large (~${Math.round(i/1e6)}MP). Try DPI 2x or Individual Pages.`:null}function vu(f){return(f||"document").replace(/\.[^.]+$/,"").replace(/[^\w\-]+/g,"_").replace(/^_+|_+$/g,"")||"document"}async function Qu(f){if(f&&!I.busy){if(f.type!=="application/pdf"&&!f.name.toLowerCase().endsWith(".pdf")){Rt("Please select a PDF file.","error");return}ig(),I.file=f,I.pdfNameBase=vu(f.name),wi(!0);try{bi(0,"Loading PDF"),I.pdfData=await f.arrayBuffer(),I.pdfDoc=await gb({data:I.pdfData}).promise;const e=I.pdfDoc.numPages;if(!e||e<1)throw new Error("No pages found in PDF.");I.pageCount=e,I.pageOrder=Array.from({length:e},(t,i)=>i+1),bi(100,`Loaded ${e} page${e===1?"":"s"}.`),Rt(`PDF loaded: ${e} page${e===1?"":"s"}.`,"success"),Tn(),wu(),na()}catch(e){console.error(e),Rt(e!=null&&e.message?String(e.message):"Conversion failed.","error"),Wr()}finally{wi(!1),yi()}}}function Ho(){const f=I.pages,e=document.querySelector("#grid");if(e){if(I.appMode!=="pdf"||I.mode!=="individual"){e.innerHTML="";return}if(!f.length){e.innerHTML="";return}e.innerHTML=f.map(t=>{const i=t.bytes>ou;return`
      <div class="card">
        <div class="thumb">
          <img src="${t.url}" alt="Page ${t.pageNumber} preview" loading="lazy" />
        </div>
        <div class="meta">
          <div class="name" title="${Me(t.filename)}">Page ${t.pageNumber}  ${Me(Us(t.bytes))}${i?"   > 6MB":""}</div>
          <button class="btn primary" data-download-page="${t.pageNumber}" data-disable-when-busy>Download</button>
        </div>
      </div>
    `}).join(""),e.querySelectorAll("[data-download-page]").forEach(t=>{t.addEventListener("click",()=>{const i=Number(t.getAttribute("data-download-page")),s=I.pages.find(n=>n.pageNumber===i);s&&(mh(s.blob,s.filename),Rt("Downloaded. Your images are ready for USCIS upload.","success"))})}),I.busy&&wi(!0)}}function yi(){const f=document.querySelector("#convertBtn"),e=document.querySelector("#downloadAll"),t=document.querySelector("#downloadCombined"),i=document.querySelector("#clearBtn"),s=document.querySelector("#imgCompressBtn"),n=document.querySelector("#imgDownloadZipBtn"),r=document.querySelector("#imgClearBtn");f&&(f.disabled=I.busy||!I.file||I.pageCount===0),e&&(e.disabled=I.busy||I.mode!=="individual"||I.pages.length===0),t&&(t.disabled=I.busy||I.mode!=="combined"||!I.combined),i&&(i.disabled=I.busy||I.pages.length===0&&!I.file),s&&(s.disabled=I.busy||I.imgFiles.length===0),n&&(n.disabled=I.busy||I.imgFiles.length===0||I.imgFiles.every(o=>{var l;return!((l=o.compressed)!=null&&l.blob)})),r&&(r.disabled=I.busy||I.imgFiles.length===0)}async function Sb(){if(!(!I.pages.length||I.busy)){wi(!0);try{bi(0,"Preparing ZIP");const f=new sf,e=f.folder(`${I.pdfNameBase}_${I.format.toUpperCase()}`)||f;I.pages.forEach(i=>{e.file(i.filename,i.blob)});const t=await f.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}},i=>{bi(i.percent||0,`Building ZIP ${Math.round(i.percent||0)}%`)});mh(t,`${I.pdfNameBase}_${I.format}.zip`),Rt("Downloaded ZIP. Your images are ready for USCIS upload.","success"),bi(100,"ZIP ready.")}catch(f){console.error(f),Rt(f!=null&&f.message?String(f.message):"Failed to create ZIP.","error")}finally{wi(!1),yi(),setTimeout(()=>Wr(),900)}}}function Eb(){I.imgFiles.forEach(f=>{var e;(e=f.compressed)!=null&&e.url&&URL.revokeObjectURL(f.compressed.url)}),I.imgFiles=[],Oc(),yi(),Tn()}function Oc(){const f=document.querySelector("#imgList"),e=document.querySelector("#imgSummary");if(!f||!e)return;if(Tn(),!I.imgFiles.length){f.innerHTML="",e.textContent="";return}const t=I.imgFiles.length,i=I.imgFiles.filter(d=>{var u;return(u=d.compressed)==null?void 0:u.blob}).length,s=I.imgFiles.filter(d=>{var u;return(u=d.compressed)==null?void 0:u.pass}).length,n=i-s,r=I.imgFiles.reduce((d,u)=>d+u.origBytes,0),o=I.imgFiles.filter(d=>{var u;return(u=d.compressed)==null?void 0:u.blob}).reduce((d,u)=>d+u.compressed.bytes,0),l=r>0&&o>0?Math.round((1-o/r)*100):0,h=I.imgFiles.filter(d=>d.wasPng).length;let c="";i?c=`Compressed ${i}/${t}  Total: ${Us(r)}  ${Us(o)} (${l}%)  Pass: ${s}  Fail: ${n}`:(c=`Loaded ${t} image${t===1?"":"s"}`,h>0&&(c+=` (${h} PNG  JPG)`),c+="."),e.textContent=c,f.innerHTML=I.imgFiles.map(d=>{const u=d.compressed,p=u?Us(u.bytes):"",m=u?`${Math.round(u.usedQuality*100)}%`:"",g=u?u.pass:null,y=g==null?"":g?'<span class="mini" style="color:var(--success);">PASS</span>':'<span class="mini" style="color:var(--danger);">FAIL</span>',b=u&&!u.pass?`<div class="mini" style="margin-top:6px;color:var(--muted);">Best clarity could not reach  ${I.imgTargetKB} KB without dropping below min quality. Output is ${Us(u.bytes)}.</div>`:"",_=d.wasPng?'<span class="mini" style="color:var(--accent);">PNGJPG</span>':"",x=d.width&&d.height?`${d.width}${d.height} (unchanged)`:"";return`
      <div class="card">
        <div class="thumb">
          ${u!=null&&u.url?`<img src="${u.url}" alt="Compressed preview" loading="lazy" />`:'<div class="mini">Not compressed yet</div>'}
        </div>
        <div class="meta" style="flex-direction:column; align-items:stretch; gap:8px;">
          <div style="display:flex; justify-content:space-between; gap:10px; width:100%;">
            <div class="name" title="${Me(d.file.name)}" style="flex:1;">${Me(d.file.name)}</div>
            ${_}
            ${y}
          </div>
          <div class="mini">Resolution: ${x}</div>
          <div class="mini">Before: ${Me(Us(d.origBytes))}  After: ${Me(p)}  Quality used: ${Me(m)}</div>
          <div style="display:flex; gap:10px; justify-content:space-between; width:100%;">
            <button class="btn primary" data-img-download="${Me(d.id)}" ${u!=null&&u.blob?"":"disabled"}>Download</button>
            <button class="btn" data-img-retry="${Me(d.id)}" data-disable-when-busy ${I.busy?"disabled":""}>Recompress</button>
          </div>
          ${b}
        </div>
      </div>
    `}).join(""),f.querySelectorAll("[data-img-download]").forEach(d=>{d.addEventListener("click",()=>{var y;const u=d.getAttribute("data-img-download"),p=I.imgFiles.find(b=>b.id===u);if(!((y=p==null?void 0:p.compressed)!=null&&y.blob))return;const m=vu(p.file.name),g=I.format;mh(p.compressed.blob,`${m}-uscis.${g}`),Rt("Downloaded. Your images are ready for USCIS upload.","success")})}),f.querySelectorAll("[data-img-retry]").forEach(d=>{d.addEventListener("click",async()=>{const u=d.getAttribute("data-img-retry"),p=I.imgFiles.find(m=>m.id===u);p&&await ag([p])})})}async function Ju(f){const e=Array.from(f||[]).filter(i=>vb(i));if(!e.length){Rt("Please select JPG/JPEG/PNG files.","error");return}const t=e.filter(i=>lu(i)).length;for(const i of e){const s=bb();I.imgFiles.push({id:s,file:i,origBytes:i.size,width:0,height:0,wasPng:lu(i)})}t>0&&Rt(`${t} PNG file${t>1?"s":""} will be converted to JPG.`,"warn"),Oc(),yi()}async function ag(f){var n;const e=f||I.imgFiles;if(!e.length||I.busy)return;const t=I.imgUscisPreset?600*1024:Math.floor(I.imgTargetKB*1024),i=Oi(I.imgMinQuality,.1,1),s=Oi(I.quality,.1,1);wi(!0);try{const r=e.length;for(let o=0;o<r;o++){const l=e[o];bi((o+1)/r*100,`Compressing ${o+1} / ${r}`),(n=l.compressed)!=null&&n.url&&URL.revokeObjectURL(l.compressed.url);const{canvas:h,width:c,height:d}=await _b(l.file);l.width=c,l.height=d;const u=await sg(h,{targetBytes:t,baseQuality:s,minQuality:i});l.compressed={blob:u.blob,url:URL.createObjectURL(u.blob),bytes:u.blob.size,usedQuality:u.usedQuality,tried:u.tried,pass:u.blob.size<=t&&u.pass},Oc(),await new Promise(p=>setTimeout(p,0))}Rt("Compression complete. Review pass/fail before downloading.","success")}catch(r){console.error(r),Rt(r!=null&&r.message?String(r.message):"Image compression failed.","error")}finally{wi(!1),Wr(),yi()}}async function xb(){const f=I.imgFiles.filter(e=>{var t;return(t=e.compressed)==null?void 0:t.blob});if(!(!f.length||I.busy)){wi(!0);try{bi(0,"Preparing ZIP");const e=new sf,t=e.folder(`uscis_compressed_${I.format.toUpperCase()}`)||e;f.forEach(s=>{const n=vu(s.file.name),r=I.format;t.file(`${n}-uscis.${r}`,s.compressed.blob)});const i=await e.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}},s=>bi(s.percent||0,`Building ZIP ${Math.round(s.percent||0)}%`));mh(i,`uscis-compressed-${I.format}.zip`),Rt("Downloaded ZIP. Your images are ready for USCIS upload.","success")}finally{wi(!1),yi(),setTimeout(()=>Wr(),900)}}}function sa(){const f=document.querySelector("#sizeHost"),e=document.querySelector("#warnHost");if(!f||!e)return;let t="Convert to see file sizes",i="";if(I.mode==="individual"&&I.pages.length){const s=I.pages.reduce((r,o)=>r+o.bytes,0);t=`Estimated total download: ${Us(s)} (pages: ${I.pages.length})`;const n=I.pages.filter(r=>r.bytes>ou);n.length&&(i=`Warning: ${n.length} file${n.length===1?"":"s"} exceed 6MB (common USCIS limit). Try lowering quality, using DPI 2x, or splitting your document.`)}I.mode==="combined"&&I.combined&&(t=`Combined image: ${I.combined.width}${I.combined.height}  ${Us(I.combined.bytes)}`,I.combined.bytes>ou&&(i="Warning: combined output exceeds 6MB (common USCIS limit). Try lower quality, DPI 2x, or use Individual Pages.")),f.textContent=t,e.innerHTML=i?`<div class="warn">${Me(i)}</div>`:""}function Tn(){const f=document.querySelector("#step1"),e=document.querySelector("#step2"),t=document.querySelector("#step3"),i=document.querySelector("#step4");if(f&&e&&t&&i){const l=!!I.file&&I.pageCount>0,h=I.mode==="individual"&&I.pages.length>0||I.mode==="combined"&&!!I.combined;f.className=`step ${l?"done":"active"}`,e.className=`step ${l?"active":""} ${h?"done":""}`,t.className=`step ${l&&!h?"active":""} ${h?"done":""}`,i.className=`step ${h?"active":""} ${h?"done":""}`;const c=document.querySelector("#pageCountLabel");c&&(c.textContent=l?`${I.pageCount}`:"")}const s=document.querySelector("#imgStep1"),n=document.querySelector("#imgStep2"),r=document.querySelector("#imgStep3"),o=document.querySelector("#imgStep4");if(s&&n&&r&&o){const l=I.imgFiles.length>0,h=I.imgFiles.some(d=>{var u;return(u=d.compressed)==null?void 0:u.blob}),c=h&&I.imgFiles.every(d=>{var u;return(u=d.compressed)==null?void 0:u.pass});s.className=`step ${l?"done":"active"}`,n.className=`step ${l?"done":""}`,r.className=`step ${l&&!h?"active":""} ${h?"done":""}`,o.className=`step ${h?"active":""} ${c?"done":""}`}}function Uo(){var e;const f=document.querySelector("#combinedPreviewHost");if(f){if(I.appMode!=="pdf"||I.mode!=="combined"||!I.combined){f.innerHTML="";return}f.innerHTML=`
    <div class="previewSingle">
      <div class="top">
        <div class="mini">${Me(I.combined.filename)}  ${Me(Us(I.combined.bytes))}</div>
        <button id="downloadCombined" class="btn primary" type="button" data-disable-when-busy>Download JPG</button>
      </div>
      <div class="imgWrap">
        <img src="${I.combined.url}" alt="Combined document preview" />
      </div>
    </div>
  `,(e=f.querySelector("#downloadCombined"))==null||e.addEventListener("click",()=>{I.combined&&(mh(I.combined.blob,I.combined.filename),Rt("Downloaded. Your images are ready for USCIS upload.","success"))}),I.busy&&wi(!0),yi()}}let tf=0;async function na(){const f=document.querySelector("#combinedPlan");if(!f)return;if(!I.pdfDoc||I.pageCount<1||I.mode!=="combined"){f.textContent="";return}const e=++tf;f.textContent="Estimating combined dimensions";try{const t=I.dpiScale===3?3:2,i=I.pageOrder.length?I.pageOrder:Array.from({length:I.pageCount},(o,l)=>l+1),s=[];for(let o=0;o<i.length;o++){if(e!==tf)return;const h=(await I.pdfDoc.getPage(i[o])).getViewport({scale:t});s.push({width:Math.floor(h.width),height:Math.floor(h.height)})}const n=ng(s),r=rg(n.width,n.height);f.textContent=`Estimated combined: ${n.width}${n.height} (${i.length} pages, spacing ${n.spacing}px)${r?"  Too large (adjust settings)":""}`}catch{f.textContent=""}}function wu(){const f=document.querySelector("#reorderHost");if(!f)return;if(!I.pdfDoc||I.pageCount<2||I.mode!=="combined"){f.innerHTML="";return}const e=I.pageOrder.length?I.pageOrder:Array.from({length:I.pageCount},(s,n)=>n+1);f.innerHTML=`
    <div class="mini" style="margin-top:12px;">Reorder pages before combining (drag to reorder):</div>
    <div class="reorderList" id="reorderList">
      ${e.map(s=>`
        <div class="reorderItem" draggable="true" data-page="${s}">
          <div class="handle"> <span>Page ${s}</span></div>
          <div class="mini">Drag</div>
        </div>
      `).join("")}
    </div>
  `;const t=f.querySelector("#reorderList");let i=null;t.querySelectorAll(".reorderItem").forEach(s=>{s.addEventListener("dragstart",n=>{i=s,s.classList.add("dragging"),n.dataTransfer.effectAllowed="move"}),s.addEventListener("dragend",()=>{s.classList.remove("dragging"),i=null;const n=Array.from(t.querySelectorAll(".reorderItem")).map(r=>Number(r.getAttribute("data-page")));I.pageOrder=n,na()}),s.addEventListener("dragover",n=>{n.preventDefault();const r=s;if(!i||i===r)return;const o=r.getBoundingClientRect(),l=n.clientY>o.top+o.height/2;t.insertBefore(i,l?r.nextSibling:r)})})}async function Cb(){var f;if(!(!I.pdfDoc||!I.file||I.pageCount<1||I.busy)){I.pages.forEach(e=>URL.revokeObjectURL(e.url)),(f=I.combined)!=null&&f.url&&URL.revokeObjectURL(I.combined.url),I.pages=[],I.combined=null,Ho(),Uo(),sa(),Tn(),wi(!0);try{const e=I.dpiScale===3?3:2,t=I.pageOrder.length?I.pageOrder:Array.from({length:I.pageCount},(i,s)=>s+1);if(I.mode==="individual"){Rt("Converting pages to JPG","info");const i=[];for(let s=0;s<t.length;s++){const n=t[s],r=await I.pdfDoc.getPage(n),o=r.getViewport({scale:e}),l=document.createElement("canvas"),h=l.getContext("2d",{alpha:!1});l.width=Math.floor(o.width),l.height=Math.floor(o.height),await r.render({canvasContext:h,viewport:o}).promise;const{blob:c}=await Zu(l),d=I.format,u=`${I.pdfNameBase}-page${n}.${d}`,p=URL.createObjectURL(c);i.push({pageNumber:n,blob:c,url:p,filename:u,bytes:c.size,width:l.width,height:l.height}),I.pages=i,bi((s+1)/t.length*100,`Rendering page ${s+1} / ${t.length}`),Ho(),sa(),await new Promise(m=>setTimeout(m,0))}bi(100,"Done."),Rt("Conversion complete.","success")}else{Rt("Building combined JPG","info");const i=[];for(let u=0;u<t.length;u++){const m=(await I.pdfDoc.getPage(t[u])).getViewport({scale:e});i.push({pageNumber:t[u],width:Math.floor(m.width),height:Math.floor(m.height)})}const s=ng(i),n=rg(s.width,s.height);if(n)throw new Error(n);const r=document.createElement("canvas"),o=r.getContext("2d",{alpha:!1});r.width=s.width,r.height=s.height,o.fillStyle="#ffffff",o.fillRect(0,0,r.width,r.height);let l=0;for(let u=0;u<i.length;u++){const p=i[u].pageNumber,m=await I.pdfDoc.getPage(p),g=m.getViewport({scale:e}),y=document.createElement("canvas"),b=y.getContext("2d",{alpha:!1});y.width=Math.floor(g.width),y.height=Math.floor(g.height),await m.render({canvasContext:b,viewport:g}).promise,o.drawImage(y,0,l),l+=y.height+s.spacing,bi((u+1)/i.length*100,`Stacking page ${u+1} / ${i.length}`),await new Promise(_=>setTimeout(_,0))}const{blob:h}=await Zu(r),c=I.format,d=`${I.pdfNameBase}-combined.${c}`;I.combined={blob:h,url:URL.createObjectURL(h),filename:d,bytes:h.size,width:r.width,height:r.height},bi(100,"Done."),Uo(),sa(),Rt("Combined image ready.","success")}}catch(e){console.error(e),Rt(e!=null&&e.message?String(e.message):"Conversion failed.","error"),Wr()}finally{wi(!1),yi(),Tn(),I.mode==="combined"&&na()}}}function kb(){const f=localStorage.getItem("pdf2img:theme");Ku(f==="dark"?"dark":"light"),mb.innerHTML=`
    <div class="container">
      <div class="header">
        <div class="title">
          <h1>PDF to JPG Converter for USCIS</h1>
          <p>Convert your documents to USCIS-accepted format</p>
        </div>
        <div class="toolbar">
          <div class="badge" title="Your documents never leave your device">Local processing  No uploads</div>
          <label class="toggle" title="Toggle dark mode">
            <span style="font-size:12px;color:var(--muted);">Dark</span>
            <input id="darkToggle" type="checkbox" />
          </label>
        </div>
      </div>

      <div class="panel">
        <div class="control" style="margin-bottom:12px;">
          <label>
            <span>Tool</span>
            <span class="mini">PDF conversion or Image compression</span>
          </label>
          <div class="segmented" role="tablist" aria-label="Tool mode">
            <button id="toolPdf" type="button" class="active" data-disable-when-busy>PDF  JPG</button>
            <button id="toolImg" type="button" data-disable-when-busy>Image  Image</button>
          </div>
        </div>

        <div id="pdfSection">
        <div class="steps" aria-label="Steps">
          <div id="step1" class="step active">
            <div class="k">Step 1</div>
            <div class="v">Upload PDF</div>
          </div>
          <div id="step2" class="step">
            <div class="k">Step 2</div>
            <div class="v">Choose Mode</div>
          </div>
          <div id="step3" class="step">
            <div class="k">Step 3</div>
            <div class="v">Adjust Settings</div>
          </div>
          <div id="step4" class="step">
            <div class="k">Step 4</div>
            <div class="v">Preview & Download</div>
          </div>
        </div>

        <div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="Upload PDF">
          <div class="icon" aria-hidden="true">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
              <path d="M7 7.5V5a2 2 0 0 1 2-2h5l3 3v1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M7 17V7.5h10V21H9a2 2 0 0 1-2-2v-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M12 10v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M9.5 12.5 12 10l2.5 2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div>
            <div style="font-weight:650; letter-spacing:-0.01em;">Drop a PDF here</div>
            <div class="hint">Accepted: .pdf  Well show page count after upload</div>
          </div>
          <button class="btn primary" id="pickBtn" type="button" data-disable-when-busy>Choose PDF</button>
          <input id="fileInput" type="file" accept="application/pdf,.pdf" hidden />
        </div>

        <div class="controls">
          <div class="control">
            <label>
              <span>Mode</span>
              <span class="mini">Pages: <span id="pageCountLabel"></span></span>
            </label>
            <div class="segmented" role="tablist" aria-label="Conversion mode">
              <button id="modeIndividual" type="button" class="active" data-disable-when-busy>Individual Pages</button>
              <button id="modeCombined" type="button" data-disable-when-busy>Single Combined Image</button>
            </div>
          </div>

          <div class="control">
            <label>
              <span>Output format</span>
              <span id="formatLabel" style="font-variant-numeric: tabular-nums;">.${Me(I.format)}</span>
            </label>
            <select id="formatSelect" data-disable-when-busy>
              <option value="jpg">JPG</option>
              <option value="jpeg">JPEG</option>
            </select>
          </div>

          <div class="control">
            <label>
              <span>Quality (legibility)</span>
              <span id="qualityLabel" style="font-variant-numeric: tabular-nums;">${Math.round(I.quality*100)}%</span>
            </label>
            <input id="qualityRange" type="range" min="10" max="100" step="1" value="${Math.round(I.quality*100)}" data-disable-when-busy />
          </div>

          <div class="control">
            <label>
              <span>Clarity (DPI)</span>
              <span class="mini">2x recommended</span>
            </label>
            <select id="dpiSelect" data-disable-when-busy>
              <option value="2">2x</option>
              <option value="3">3x (sharper, larger)</option>
            </select>
          </div>

          <div class="control" id="spacingControl" style="display:none;">
            <label>
              <span>Page spacing (combined)</span>
              <span class="mini">Helps readability</span>
            </label>
            <select id="spacingSelect" data-disable-when-busy>
              <option value="none">None</option>
              <option value="small" selected>Small</option>
              <option value="medium">Medium</option>
            </select>
          </div>

          <div class="control">
            <label>
              <span>Estimate</span>
              <span class="mini">6MB USCIS check</span>
            </label>
            <div class="hint" id="sizeHost">Convert to see file sizes</div>
          </div>

          <div class="control">
            <label>
              <span>Smart Compression</span>
              <span class="mini">No resolution loss</span>
            </label>
            <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
              <label class="mini" style="display:flex; gap:8px; align-items:center;">
                <input id="compressToggle" type="checkbox" ${I.compress?"checked":""} data-disable-when-busy />
                Compress
              </label>
              <label class="mini" style="display:flex; gap:8px; align-items:center;">
                <input id="fitToggle" type="checkbox" ${I.fitUnderMax?"checked":""} data-disable-when-busy />
                Fit under
              </label>
              <input id="maxSizeInput" type="number" min="1" max="25" step="0.5" value="${I.maxSizeMB}" style="width:90px;" data-disable-when-busy />
              <span class="mini">MB</span>
            </div>
            <div class="hint mini">Advanced encoder flags (subsampling/progressive/metadata) are available via CLI.</div>
          </div>
        </div>

        <div id="combinedPlan" class="mini" style="margin-top:10px;"></div>
        <div id="reorderHost"></div>
        <div id="warnHost"></div>

        <div id="progressWrap" class="progressWrap">
          <div class="progress"><div id="bar" class="bar"></div></div>
          <div id="progressText" class="progressText"></div>
        </div>

        <div class="actions">
          <div class="left">
            <button id="convertBtn" class="btn primary" type="button" data-disable-when-busy disabled>
              Convert to JPG
            </button>
            <button id="downloadAll" class="btn" type="button" data-disable-when-busy disabled>
              Download All (ZIP)
            </button>
            <button id="clearBtn" class="btn danger" type="button" data-disable-when-busy disabled>
              Start Over
            </button>
          </div>
          <div class="right">
            <div class="hint" id="fileHint"></div>
          </div>
        </div>

        <div class="notice">
          <strong>Privacy:</strong> Your documents are processed locally in your browser. No files are uploaded to any server.
        </div>
        </div> <!-- /pdfSection -->

        <div id="imgSection" style="display:none;">
          <div class="steps" aria-label="Steps">
            <div id="imgStep1" class="step active">
              <div class="k">Step 1</div>
              <div class="v">Upload Images</div>
            </div>
            <div id="imgStep2" class="step">
              <div class="k">Step 2</div>
              <div class="v">USCIS-safe settings</div>
            </div>
            <div id="imgStep3" class="step">
              <div class="k">Step 3</div>
              <div class="v">Compress & download</div>
            </div>
            <div id="imgStep4" class="step">
              <div class="k">Step 4</div>
              <div class="v">Verify  600 KB</div>
            </div>
          </div>

          <div id="imgDropzone" class="dropzone" role="button" tabindex="0" aria-label="Upload JPG/JPEG/PNG">
            <div class="icon" aria-hidden="true">
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
                <path d="M4 7a2 2 0 0 1 2-2h5l2 2h5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M8 16l2-2 2 2 4-4 2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div>
              <div style="font-weight:650; letter-spacing:-0.01em;">Drop JPG/JPEG/PNG files here</div>
              <div class="hint">USCIS-safe compression ( 600 KB, no resize). PNG converts to JPG. Batch supported.</div>
            </div>
            <button class="btn primary" id="imgPickBtn" type="button" data-disable-when-busy>Choose Images</button>
            <input id="imgInput" type="file" accept="image/jpeg,image/png,.jpg,.jpeg,.png" multiple hidden />
          </div>

          <div class="controls">
            <div class="control">
              <label>
                <span>USCIS-safe compression ( 600 KB, no resize)</span>
                <span class="mini">Default</span>
              </label>
              <label class="mini" style="display:flex; gap:8px; align-items:center;">
                <input id="imgUscisPreset" type="checkbox" ${I.imgUscisPreset?"checked":""} data-disable-when-busy />
                Enable preset
              </label>
              <div class="hint mini">Preserves resolution. Encoder tuning is quality-only in browser; full encoder knobs are in CLI.</div>
            </div>

            <div class="control">
              <label>
                <span>Starting quality</span>
                <span id="imgQualityLabel" style="font-variant-numeric: tabular-nums;">${Math.round(I.quality*100)}%</span>
              </label>
              <input id="imgQualityRange" type="range" min="10" max="100" step="1" value="${Math.round(I.quality*100)}" data-disable-when-busy />
              <div class="hint mini">Initial quality before fit-under compression.</div>
            </div>

            <div class="control">
              <label>
                <span>Fit under</span>
                <span class="mini">editable</span>
              </label>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <input id="imgTargetKB" type="number" min="50" max="6000" step="10" value="${I.imgTargetKB}" style="width:110px;" data-disable-when-busy />
                <span class="mini">KB</span>
              </div>
              <div class="hint mini">Recommended: 600 KB for USCIS-style limits.</div>
            </div>

            <div class="control">
              <label>
                <span>Best-clarity safeguard</span>
                <span class="mini">min quality</span>
              </label>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <input id="imgMinQuality" type="number" min="0.1" max="0.95" step="0.05" value="${I.imgMinQuality}" style="width:110px;" data-disable-when-busy />
                <span class="mini">(0.10.95)</span>
              </div>
              <div class="hint mini">If target cant be met above this quality, we output best clarity and mark FAIL.</div>
            </div>
          </div>

          <div class="actions">
            <div class="left">
              <button id="imgCompressBtn" class="btn primary" type="button" data-disable-when-busy disabled>Compress Images</button>
              <button id="imgDownloadZipBtn" class="btn" type="button" data-disable-when-busy disabled>Download All (ZIP)</button>
              <button id="imgClearBtn" class="btn danger" type="button" data-disable-when-busy disabled>Clear Images</button>
            </div>
            <div class="right">
              <div class="hint" id="imgSummary"></div>
            </div>
          </div>

          <div id="imgList" class="grid"></div>

          <div class="notice">
            <strong>Privacy:</strong> Your images are processed locally in your browser. No files are uploaded to any server.
          </div>
        </div> <!-- /imgSection -->
      </div>

      <div id="grid" class="grid"></div>
      <div id="combinedPreviewHost"></div>
    </div>

    <div id="toastHost" class="toastHost" aria-live="polite" aria-atomic="true"></div>
  `;const e=document.querySelector("#dropzone"),t=document.querySelector("#pickBtn"),i=document.querySelector("#fileInput"),s=document.querySelector("#toolPdf"),n=document.querySelector("#toolImg"),r=document.querySelector("#pdfSection"),o=document.querySelector("#imgSection"),l=document.querySelector("#imgDropzone"),h=document.querySelector("#imgPickBtn"),c=document.querySelector("#imgInput"),d=document.querySelector("#imgUscisPreset"),u=document.querySelector("#imgQualityRange"),p=document.querySelector("#imgQualityLabel"),m=document.querySelector("#imgTargetKB"),g=document.querySelector("#imgMinQuality"),y=document.querySelector("#imgCompressBtn"),b=document.querySelector("#imgDownloadZipBtn"),_=document.querySelector("#imgClearBtn"),x=document.querySelector("#formatSelect"),C=document.querySelector("#formatLabel"),k=document.querySelector("#qualityRange"),M=document.querySelector("#qualityLabel"),L=document.querySelector("#dpiSelect"),N=document.querySelector("#spacingControl"),D=document.querySelector("#spacingSelect"),G=document.querySelector("#modeIndividual"),Z=document.querySelector("#modeCombined"),R=document.querySelector("#convertBtn"),U=document.querySelector("#compressToggle"),A=document.querySelector("#fitToggle"),j=document.querySelector("#maxSizeInput"),V=document.querySelector("#downloadAll"),H=document.querySelector("#clearBtn"),ct=document.querySelector("#fileHint"),Y=document.querySelector("#darkToggle");x.value=I.format,L.value=String(I.dpiScale),Y.checked=I.theme==="dark",Y.addEventListener("change",()=>Ku(Y.checked?"dark":"light"));function ot(W){I.appMode=W==="img"?"img":"pdf",s.classList.toggle("active",I.appMode==="pdf"),n.classList.toggle("active",I.appMode==="img"),r.style.display=I.appMode==="pdf"?"":"none",o.style.display=I.appMode==="img"?"":"none",Wr(),Ho(),Uo(),yi()}s.addEventListener("click",()=>ot("pdf")),n.addEventListener("click",()=>ot("img"));function B(W){if(!ct)return;if(!W){ct.textContent="";return}const K=(W.size/(1024*1024)).toFixed(2);ct.textContent=`${W.name}  ${K} MB`}t.addEventListener("click",()=>i.click()),e.addEventListener("click",W=>{W.target&&W.target.closest("button")||i.click()}),e.addEventListener("keydown",W=>{(W.key==="Enter"||W.key===" ")&&i.click()}),i.addEventListener("change",async()=>{var K;const W=(K=i.files)==null?void 0:K[0];W&&(B(W),await Qu(W))}),["dragenter","dragover"].forEach(W=>{e.addEventListener(W,K=>{K.preventDefault(),K.stopPropagation(),e.classList.add("hover")})}),["dragleave","drop"].forEach(W=>{e.addEventListener(W,K=>{K.preventDefault(),K.stopPropagation(),e.classList.remove("hover")})}),e.addEventListener("drop",async W=>{var _t;const K=W.dataTransfer,J=(_t=K==null?void 0:K.files)==null?void 0:_t[0];J&&(I.busy||(i.value="",B(J),await Qu(J)))}),x.addEventListener("change",()=>{I.format=x.value==="jpeg"?"jpeg":"jpg",C&&(C.textContent=`.${I.format}`),Rt(`Format set to .${I.format}`,"info")}),k.addEventListener("input",()=>{const W=Number(k.value)/100;I.quality=Oi(W,.1,1),M.textContent=`${Math.round(I.quality*100)}%`,u.value=String(Math.round(I.quality*100)),p.textContent=`${Math.round(I.quality*100)}%`}),k.addEventListener("change",()=>{Rt(`Quality set to ${Math.round(I.quality*100)}%`,"info")}),L.addEventListener("change",()=>{I.dpiScale=L.value==="3"?3:2,Rt(`Clarity set to ${I.dpiScale}x`,"info"),I.mode==="combined"&&na()}),D.addEventListener("change",()=>{I.spacing=["none","small","medium"].includes(D.value)?D.value:"small",Rt(`Spacing set to ${I.spacing}`,"info"),I.mode==="combined"&&na()}),U.addEventListener("change",()=>{I.compress=!!U.checked,Rt(I.compress?"Compression enabled (resolution preserved).":"Compression disabled.","info")}),A.addEventListener("change",()=>{I.fitUnderMax=!!A.checked,Rt(I.fitUnderMax?"Fit-under max size enabled.":"Fit-under max size disabled.","info")}),j.addEventListener("change",()=>{const W=Number(j.value);I.maxSizeMB=Oi(W,1,25),j.value=String(I.maxSizeMB),Rt(`Max size set to ${I.maxSizeMB} MB`,"info")});function O(W){var K;I.mode=W==="combined"?"combined":"individual",G.classList.toggle("active",I.mode==="individual"),Z.classList.toggle("active",I.mode==="combined"),N.style.display=I.mode==="combined"?"":"none",I.pages.forEach(J=>URL.revokeObjectURL(J.url)),(K=I.combined)!=null&&K.url&&URL.revokeObjectURL(I.combined.url),I.pages=[],I.combined=null,Ho(),Uo(),wu(),sa(),Tn(),yi(),I.mode==="combined"&&na()}G.addEventListener("click",()=>O("individual")),Z.addEventListener("click",()=>O("combined")),R.addEventListener("click",Cb),V.addEventListener("click",Sb),H.addEventListener("click",()=>{ig(),B(null),i.value="",yi(),Rt("Start over ready.","success")}),h.addEventListener("click",()=>c.click()),l.addEventListener("click",W=>{W.target&&W.target.closest("button")||c.click()}),l.addEventListener("keydown",W=>{(W.key==="Enter"||W.key===" ")&&c.click()}),c.addEventListener("change",async()=>{const W=c.files;W!=null&&W.length&&(await Ju(W),c.value="")}),["dragenter","dragover"].forEach(W=>{l.addEventListener(W,K=>{K.preventDefault(),K.stopPropagation(),l.classList.add("hover")})}),["dragleave","drop"].forEach(W=>{l.addEventListener(W,K=>{K.preventDefault(),K.stopPropagation(),l.classList.remove("hover")})}),l.addEventListener("drop",async W=>{var J;const K=W.dataTransfer;(J=K==null?void 0:K.files)!=null&&J.length&&(I.busy||await Ju(K.files))}),d.addEventListener("change",()=>{I.imgUscisPreset=!!d.checked,I.imgUscisPreset&&(I.imgTargetKB=600,m.value=String(I.imgTargetKB)),Rt(I.imgUscisPreset?"USCIS-safe preset enabled ( 600 KB).":"Preset disabled.","info")}),u.addEventListener("input",()=>{const W=Number(u.value)/100;I.quality=Oi(W,.1,1),p.textContent=`${Math.round(I.quality*100)}%`,k.value=String(Math.round(I.quality*100)),M.textContent=`${Math.round(I.quality*100)}%`}),u.addEventListener("change",()=>{Rt(`Quality set to ${Math.round(I.quality*100)}%`,"info")}),m.addEventListener("change",()=>{const W=Number(m.value);I.imgTargetKB=Oi(W,50,6e3),m.value=String(I.imgTargetKB),I.imgTargetKB!==600&&(I.imgUscisPreset=!1,d.checked=!1),Rt(`Target set to  ${I.imgTargetKB} KB`,"info")}),g.addEventListener("change",()=>{const W=Number(g.value);I.imgMinQuality=Oi(W,.1,.95),g.value=String(I.imgMinQuality),Rt(`Min quality safeguard: ${Math.round(I.imgMinQuality*100)}%`,"info")}),y.addEventListener("click",async()=>{await ag()}),b.addEventListener("click",xb),_.addEventListener("click",()=>{Eb(),Rt("Cleared images.","success")}),O("individual"),ot("pdf"),Tn(),sa(),Oc(),yi()}kb();
